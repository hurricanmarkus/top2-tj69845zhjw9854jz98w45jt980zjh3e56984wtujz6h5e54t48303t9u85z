<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOP 2 Smart Home</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="TOP 2 App">
    <meta name="apple-mobile-web-app-title" content="TOP 2">
    <meta name="theme-color" content="#4f46e5" />
    <meta name="msapplication-navbutton-color" content="#4f46e5">
    <meta name="apple-mobile-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/png" sizes="192x192" href="https://placehold.co/192x192/4f46e5/ffffff?text=T2">
    <link rel="apple-touch-icon" type="image/png" sizes="192x192"
        href="https://placehold.co/192x192/4f46e5/ffffff?text=T2">

    <link rel="manifest" href="app.webmanifest">

<link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="app-container">

        <header id="appHeader"
            class="flex-shrink-0 bg-gradient-to-r from-indigo-600 to-cyan-500 text-white border-b border-indigo-700 p-4 flex justify-center items-center shadow-md cursor-pointer">
            <h1 id="headerTitle" class="text-xl font-bold tracking-wider whitespace-nowrap px-2">TOP 2 - Markus <span
                    class="text-red-300">❤️</span> Jasiiinmin</h1>
        </header>

        <main class="main-content space-y-4">

            <div id="homeView" class="view active">

                <div id="homeActionButtons" class="flex justify-end mb-6 gap-2">
                    <button id="mainSettingsButton"
                        class="bg-gray-600 text-white text-xs font-bold py-1 px-3 rounded-lg shadow-lg hover:bg-gray-700 transition hidden z-10">
                        Einstellungen
                    </button>
                    <button id="mainAdminButton"
                        class="bg-red-600 text-white text-xs font-bold py-1 px-3 rounded-lg shadow-lg hover:bg-red-700 transition hidden z-10">
                        ADMIN
                    </button>
                </div>
                <div id="guestPrompt"
                    class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-lg hidden">
                    <p class="font-bold">Anmeldung erforderlich</p>
                    <p>Bitte melden Sie sich über den Modus-Bereich unten an, um die Steuerung zu verwenden.</p>
                </div>

                <div id="noPermissionPrompt"
                    class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg hidden">
                    <p class="font-bold">Keine Berechtigung</p>
                    <p>Ihrem Konto wurden keine Berechtigungen zugewiesen. Bitte kontaktieren Sie einen Administrator.
                    </p>
                </div>

                <div id="pushCard" data-permission="PUSHOVER"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 w-full border-t-4 border-red-500 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-red-500 flex-shrink-0">
                        <path fill-rule="evenodd"
                            d="M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25-2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 17.069v-5.814l4.138 3.551a.75.75 0 0 0 .972-.06l6.26-5.408 4.793 4.116-.167 4.567A.75.75 0 0 0 21 18H3a.75.75 0 0 0-.75.75v-1.681ZM21 6a.75.75 0 0 0-.75-.75H3.75a.75.75 0 0 0-.75.75v.524l8.36 7.199c.07.06.15.1.24.1s.17.04.24.1l8.37-7.21V6Z"
                            clip-rule="evenodd" />
                    </svg>
                    <div class="flex w-full items-center">
                        <div id="pushoverButton" class="flex-grow cursor-pointer pr-4">
                            <span class="text-xl font-bold text-red-500 block">Push-Benachrichtigung</span>
                            <span class="text-sm text-gray-500">Pushover Notifikationen senden.</span>
                        </div>
                        <div id="notrufSettingsButton"
                            class="flex-shrink-0 pl-4 ml-4 border-l border-gray-200 text-right cursor-pointer">
                            <span class="text-xl font-bold text-red-700 block">NOTRUF</span>
                            <span class="text-sm text-gray-500">Einstellungen</span>
                        </div>
                    </div>
                </div>
                <div id="entranceCard" data-permission="ENTRANCE"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-indigo-500 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="w-10 h-10 text-indigo-500 flex-shrink-0">
                        <rect x="4" y="4" width="16" height="18" rx="2" ry="2" />
                        <path d="M12 4h4" />
                        <path d="M14 13h.01" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-indigo-500 block">Haupteingang öffnen</span>
                        <span class="text-sm text-gray-500">Steuern Sie den Zugang zum Haupteingang.</span>
                    </div>
                </div>
                <div data-permission="CHECKLIST"
                    class="card bg-white rounded-xl shadow-lg w-full border-t-4 border-green-500 hidden">
                    <div class="p-4 flex items-center space-x-4">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            class="w-10 h-10 text-green-500 flex-shrink-0">
                            <path fill-rule="evenodd"
                                d="M19.5 21a3 3 0 0 0 3-3V6a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h15Zm-11.02-7.22L6.9 12.2c-.39-.39-1.02-.39-1.41 0a.996.996 0 0 0 0 1.41l2.38 2.38c.39.39 1.02.39 1.41 0l5.88-5.88a.996.996 0 1 0-1.41-1.41l-5.13 5.13Z"
                                clip-rule="evenodd" />
                        </svg>
                        <span class="text-xl font-bold text-green-500">Checkliste</span>
                    </div>
                    <div class="bg-gray-50 p-2 grid grid-cols-2 gap-2 rounded-b-xl border-t">
                        <div id="currentChecklistCard"
                            class="p-3 text-center rounded-lg hover:bg-green-100 cursor-pointer">
                            <span class="font-semibold text-green-800">Aktuelle Checkliste</span>
                            <span id="current-checklist-name-display"
                                class="text-sm font-bold text-gray-600 mt-1 block"></span>
                        </div>
                        <div id="checklistSettingsCard"
                            class="p-3 text-center rounded-lg hover:bg-gray-200 cursor-pointer flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-5 h-5 text-gray-600">
                                <path fill-rule="evenodd"
                                    d="M11.078 2.25c-.217 0-.424.034-.622.098l-6.07 1.916a.75.75 0 0 0-.58 1.154l4.335 6.191a.75.75 0 0 0 1.155-.582V4.243a.75.75 0 0 0-.413-.673l-1.38-.771a.75.75 0 0 0-.53-.162Zm-.022 8.355a.75.75 0 0 0-1.155.582v4.664l1.12.352a.75.75 0 0 0 .814-.431l1.632-3.263a.75.75 0 0 0-.25-1.022l-1.751-1.066Z"
                                    clip-rule="evenodd" />
                                <path
                                    d="M12.562 2.02a.75.75 0 0 1 .638.51l3.5 7a.75.75 0 0 1-.51.983l-7 3.5a.75.75 0 0 1-.983-.51l-3.5-7a.75.75 0 0 1 .51-.983l7-3.5a.75.75 0 0 1 .345-.083Zm-2.286 1.044-6.323 3.162 3.162 6.323 6.323-3.162-3.162-6.323Z" />
                            </svg>
                            <span class="font-semibold text-gray-700">Einstellungen</span>
                        </div>
                    </div>
                </div>
                <div id="essensberechnungCard" data-permission="ESSENSBERECHNUNG"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-orange-500 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-orange-500 flex-shrink-0">
                        <path
                            d="M12.75 1.5a.75.75 0 0 0-1.5 0v5.333A3.375 3.375 0 0 0 8.333 10H3a.75.75 0 0 0 0 1.5h5.333a3.375 3.375 0 0 0 2.917 3.167V22.5a.75.75 0 0 0 1.5 0v-7.833A3.375 3.375 0 0 0 15.667 11.5h5.333a.75.75 0 0 0 0-1.5h-5.333a3.375 3.375 0 0 0-2.917-3.167V1.5Z" />
                        <path
                            d="M14.013 7.857a24.417 24.417 0 0 0-4.025 0 .75.75 0 0 0 0 1.486 22.918 22.918 0 0 1 4.025 0 .75.75 0 0 0 0-1.486Z" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-orange-500 block">Essensberechnung</span>
                        <span class="text-sm text-gray-500">Mahlzeiten abwiegen und Portionen berechnen.</span>
                    </div>
                </div>

            </div>




            <div id="adminView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <h2 class="text-2xl font-bold text-gray-800 mb-4">Admin Einstellungen</h2>

                <div id="noAdminPermissionsPrompt"
                    class="bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4 rounded-lg hidden">
                    <p class="font-bold">Keine Berechtigungen</p>
                    <p>Für Ihr Admin-Konto sind keine Verwaltungs-Module freigeschaltet. Bitte kontaktieren Sie einen
                        Systemadministrator.</p>
                </div>

                <div id="adminRightsSection" class="hidden">
                    <div id="adminRightsToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-yellow-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">ADMIN - Rechteverwaltung</span>
                            <svg id="adminRightsToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                    <div id="adminRightsArea" class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                    </div>
                </div>

                <div id="roleManagementSection" class="hidden">
                    <div id="roleSettingsToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-purple-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">Rollenverwaltung</span>
                            <svg id="roleToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke-width="2.5" stroke="currentColor" class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                    <div id="roleManagementArea" class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                    </div>
                </div>

                <div id="passwordSection">
                    <div id="passwordSettingsToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-red-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">Passwörter</span>
                            <svg id="passwordToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                    <div id="passwordManagementArea"
                        class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                        <div id="userKeyList" class="space-y-4"></div>
                    </div>
                </div>

                <div id="userSection">
                    <div id="userManagementToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-blue-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">Benutzersteuerung</span>
                            <svg id="userManagementToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                    <div id="userManagementArea" class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                        <button id="showAddUserFormBtn"
                            class="w-full p-3 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-700 transition shadow-md">+
                            Benutzer anlegen</button>
                        <div id="addUserFormContainer" class="p-4 border rounded-xl bg-green-50 hidden">
                            <h4 class="font-bold text-lg text-green-800 mb-2">Neuen Benutzer anlegen</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                <input type="text" id="newUserName" class="p-2 border rounded-lg"
                                    placeholder="Nickname*">
                                <input type="text" id="newUserRealName" class="p-2 border rounded-lg"
                                    placeholder="Vollständiger Name (Optional)">
                                <div id="newUserKeyWrapper" class="sm:col-span-1">
                                    <input type="password" id="newUserKey" class="p-2 border rounded-lg w-full"
                                        placeholder="Passwort* (mind. 4 Zeichen)">
                                </div>
                                <select id="newUserPermissionType" class="p-2 border rounded-lg bg-white">
                                    <option value="role" selected>Rolle (Standard)</option>
                                    <option value="individual">Individuell</option>
                                    <option value="not_registered">Nicht registriert</option>
                                </select>
                                <select id="newUserRole" class="p-2 border rounded-lg bg-white sm:col-span-2">
                                </select>
                                <button id="saveNewUserButton"
                                    class="sm:col-span-2 p-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700">Erstellen</button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">* Pflichtfelder (außer bei "Nicht registriert")</p>
                        </div>

                        <div id="registeredUserList" class="space-y-3 pt-4 border-t mt-4">
                        </div>

                        <div class="mt-6 pt-4 border-t">
                            <button id="notRegisteredToggle"
                                class="w-full flex justify-between items-center p-3 bg-gray-100 hover:bg-gray-200 rounded-lg text-left font-semibold text-gray-700">
                                <span>Nicht registrierte Personen (<span id="notRegisteredCount">0</span>)</span>
                                <svg id="notRegisteredToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                    viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                    class="w-5 h-5 transform transition-transform">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                </svg>
                            </button>
                            <div id="notRegisteredList" class="hidden mt-2 space-y-2 pl-4 border-l-2 border-gray-200">
                                <p class="text-xs text-center text-gray-400">Keine nicht registrierten Personen
                                    vorhanden.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="mainFunctionsSection">
                    <div id="mainFunctionsToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-cyan-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">Adminfunktionen Hauptseite</span>
                            <svg id="mainFunctionsToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>


                    <div id="mainFunctionsArea" class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                        <div class="mb-4">
                            <h3 class="text-sm font-semibold text-gray-500 mb-1 px-1">Funktion auswählen</h3>
                            <div id="main-functions-tabs"
                                class="grid grid-cols-3 gap-1 border rounded-lg bg-gray-100 p-1">
                                <button data-target-card="card-main-push"
                                    class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600">Push</button>
                                <button data-target-card="card-main-entrance"
                                    class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600">Eingang</button>
                                <button data-target-card="card-main-checklist"
                                    class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600">Checkliste</button>
                            </div>
                        </div>

                        <div id="main-functions-content-area" class="space-y-4">

                            <div id="main-functions-prompt" class="text-center p-4 bg-gray-50 rounded-lg">
                                <p class="font-semibold text-gray-600">Bitte wählen Sie oben eine Funktion aus, um sie
                                    anzuzeigen.</p>
                            </div>

                            <div id="card-main-push" class="main-functions-card hidden">
                                <div class="p-4 bg-gray-50 rounded-lg text-center">
                                    <p class="font-semibold text-gray-600">Hier gibt es aktuell keinen Inhalt.</p>
                                    <p class="text-sm text-gray-500 mt-1">Die Funktion befindet sich auf der Hauptseite.
                                    </p>
                                </div>
                            </div>
                            <div id="card-main-entrance" class="main-functions-card hidden">
                                <div class="p-4 bg-gray-50 rounded-lg text-center">
                                    <p class="font-semibold text-gray-600">Hier gibt es aktuell keinen Inhalt.</p>
                                    <p class="text-sm text-gray-500 mt-1">Die Funktion befindet sich auf der Hauptseite.
                                    </p>
                                </div>
                            </div>
                            <div id="card-main-checklist" class="main-functions-card hidden">
                                <div class="p-4 bg-gray-50 rounded-lg">
                                    <button id="permanently-delete-items-btn"
                                        class="w-full py-2 px-4 bg-red-600 text-white font-bold rounded-lg shadow-md hover:bg-red-700 transition flex items-center justify-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                            class="w-5 h-5">
                                            <path fill-rule="evenodd"
                                                d="M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.58.22-2.365.468a.75.75 0 1 0 .23 1.482l.149-.022.841 10.518A2.75 2.75 0 0 0 7.596 19h4.807a2.75 2.75 0 0 0 2.742-2.53l.841-10.52.149.023a.75.75 0 0 0 .23-1.482A41.03 41.03 0 0 0 14 4.193v-.443A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 0 0-1.5.06l.3 7.5a.75.75 0 1 0 1.5-.06l-.3-7.5Zm4.34.06a.75.75 0 1 0-1.5-.06l-.3 7.5a.75.75 0 1 0 1.5.06l.3-7.5Z"
                                                clip-rule="evenodd"></path>
                                        </svg>
                                        Papierkorb endgültig leeren
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="approvalProcessSection">
                    <div id="approvalProcessToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-green-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">Genehmigungsprozess</span>
                            <svg id="approvalToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                    <div id="approvalProcessArea" class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                    </div>
                </div>

                <div id="protocolHistorySection">
                    <div id="protocolHistoryToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-gray-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">Protokoll History</span>
                            <svg id="protocolHistoryToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                    <div id="protocolHistoryArea" class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                    </div>
                </div>
            </div>



            <div id="userSettingsView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Eigene Einstellungen</h2>

                <div id="currentUserKeyDisplay"
                    class="bg-yellow-100 border-l-4 border-yellow-400 text-yellow-800 p-4 rounded-lg"
                    style="display: none;">
                </div>

                <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-blue-500">
                    <h3 id="userSettingsName" class="font-bold text-gray-800 mb-2">Passwort für ... ändern</h3>
                    <p class="text-sm text-gray-600 mb-4">Geben Sie ein neues Passwort ein, um Ihr altes zu
                        ersetzen.
                    </p>
                    <div class="flex space-x-2 mt-3">
                        <input type="password" id="userSettingsNewKeyInput"
                            class="flex-grow p-2 border border-blue-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Neuen Schlüssel eingeben (mind. 4 Zeichen)">
                        <button id="userSettingsSaveKeyButton"
                            class="py-2 px-3 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 transition">Speichern</button>
                    </div>
                </div>
            </div>

            <div id="entranceView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <h2 class="text-2xl font-bold text-gray-800 mb-4">Haupteingang Steuerung</h2>

                <button data-delay="0"
                    class="action-button w-full py-4 px-6 bg-indigo-700 text-white text-xl font-extrabold rounded-xl shadow-lg hover:bg-indigo-800 transition duration-200 flex items-center justify-center">
                    <span class="button-text">SOFORT ÖFFNEN</span>
                    <div class="loading-spinner"></div>
                </button>

                <div class="w-full grid grid-cols-3 gap-4">
                    <button data-delay="5"
                        class="action-button py-4 bg-gray-200 text-gray-800 font-semibold rounded-xl shadow-md hover:bg-gray-300 transition duration-200 flex items-center justify-center">
                        <span class="button-text">5 Sek</span>
                        <div class="loading-spinner"></div>
                    </button>
                    <button data-delay="10"
                        class="action-button py-4 bg-gray-200 text-gray-800 font-semibold rounded-xl shadow-md hover:bg-gray-300 transition duration-200 flex items-center justify-center">
                        <span class="button-text">10 Sek</span>
                        <div class="loading-spinner"></div>
                    </button>
                    <button data-delay="15"
                        class="action-button py-4 bg-gray-200 text-gray-800 font-semibold rounded-xl shadow-md hover:bg-gray-300 transition duration-200 flex items-center justify-center">
                        <span class="button-text">15 Sek</span>
                        <div class="loading-spinner"></div>
                    </button>
                </div>
            </div>

            <div id="pushoverView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <h2 class="text-2xl font-bold text-gray-800">Nachricht senden</h2>

                <div class="bg-white p-5 rounded-xl shadow-lg border border-gray-100">
                    <div class="mb-4">
                        <label for="pushoverTitle" class="block text-sm font-medium text-gray-700 mb-1">Titel</label>
                        <input type="text" id="pushoverTitle" placeholder="Info über TOP 2 APP"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                            value="Wichtig: TOP 2 Meldung">
                    </div>

                    <div class="mb-4">
                        <label for="pushoverMessage"
                            class="block text-sm font-medium text-gray-700 mb-1">Nachricht</label>
                        <textarea id="pushoverMessage" rows="3"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Ihre Nachricht..."></textarea>
                    </div>

                    <div class="mb-6">
                        <label for="pushoverRecipient"
                            class="block text-sm font-medium text-gray-700 mb-1">Empfänger</label>
                        <select id="pushoverRecipient"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-5900 bg-white">
                            <option value="Markus">Markus</option>
                            <option value="Jasmin">Jasmin</option>
                            <option value="ALLE">ALLE</option>
                        </select>
                    </div>

                    <button id="sendDynamicPostButton"
                        class="w-full py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition duration-200 flex items-center justify-center">
                        <span class="button-text">Nachricht senden</span>
                        <div class="loading-spinner"></div>
                    </button>
                </div>
            </div>

            <div id="checklistView" class="view">
            </div>

            <div id="checklistSettingsView" class="view">
            </div>

            <div id="essensberechnungView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Essensberechnung</h2>

                <div id="meal-composition-area" class="space-y-4">

                    <div class="card bg-white p-4 rounded-xl shadow-lg">
                        <label for="meal-name" class="block text-sm font-medium text-gray-700 mb-1">Name der
                            Mahlzeit</label>
                        <input type="text" id="meal-name" placeholder="z.B. Mittagessen Montag"
                            class="w-full p-2 border rounded-lg">
                    </div>

                    <div class="card bg-white p-4 rounded-xl shadow-lg">
                        <h3 class="font-bold text-gray-800 mb-2">Einzelne Produkte</h3>
                        <div class="flex gap-2">
                            <input type="text" id="single-product-name" class="flex-grow p-2 border rounded-lg"
                                placeholder="Produkt (z.B. Hähnchen)">
                            <input type="number" id="single-product-weight" class="w-24 p-2 border rounded-lg"
                                placeholder="Gewicht (g)">
                            <button id="add-single-product-btn"
                                class="py-2 px-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">+</button>
                        </div>
                        <div id="single-products-list" class="mt-3 space-y-1"></div>
                    </div>

                    <div class="card bg-white p-4 rounded-xl shadow-lg">
                        <h3 class="font-bold text-gray-800 mb-2">Rezepte</h3>
                        <div id="recipes-area" class="space-y-3">
                        </div>
                        <button id="add-recipe-btn"
                            class="w-full mt-3 py-2 text-sm text-blue-600 font-semibold hover:underline">+ Neues Rezept
                            hinzufügen</button>
                    </div>
                </div>

                <div id="portion-definition-form"
                    class="card bg-gray-50 p-4 rounded-xl space-y-4 transition-colors duration-300">
                    <h3 class="font-bold text-gray-800 mb-2">1. Portion definieren</h3>

                    <div class="p-3 border bg-white rounded-lg space-y-3">
                        <div class="flex items-center gap-2">
                            <select id="person-select" class="flex-grow p-2 border rounded-lg bg-white"></select>
                            <button id="rest-mode-btn"
                                class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition flex-shrink-0">Rest</button>
                        </div>
                        <input type="text" id="portion-name" class="w-full p-2 border rounded-lg"
                            placeholder="Name der Portion (z.B. Mittwoch)">

                        <div id="product-weights-for-person" class="space-y-2 pt-2 border-t">
                        </div>

                        <div id="recipe-weights-for-person" class="space-y-2 pt-2 border-t">
                        </div>

                        <div id="product-weights-for-person" class="space-y-2 pt-2 border-t">
                        </div>

                        <div class="flex items-center gap-2 pt-2 border-t">
                            <label for="portion-anzahl" class="text-sm font-semibold text-gray-700">Anzahl:</label>
                            <input type="number" id="portion-anzahl" class="w-24 p-2 border rounded-lg" value="1"
                                min="1">
                        </div>
                    </div>

                    <button id="add-portion-definition-btn"
                        class="w-full py-2 px-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700">
                        + Portion hinzufügen
                    </button>
                    <div class="flex gap-2">
                        <button id="update-portion-definition-btn"
                            class="w-full py-2 px-3 bg-yellow-500 text-black font-semibold rounded-lg hover:bg-yellow-600 hidden">
                            Änderung übernehmen
                        </button>
                        <button id="delete-portion-definition-btn"
                            class="w-full py-2 px-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 hidden">
                            Portion löschen
                        </button>
                    </div>
                </div>

                <div class="card bg-white p-4 rounded-xl shadow-lg">
                    <h3 class="font-bold text-gray-800 mb-2">2. Definierte Portionen</h3>
                    <div id="distribution-list" class="space-y-2">
                        <p class="text-sm text-center text-gray-400">Noch keine Portionen definiert.</p>
                    </div>
                </div>

                <div class="card bg-gray-50 p-4 rounded-xl mt-4">
                    <h3 class="font-bold text-gray-800 mb-2">3. Berechnung starten</h3>
                    <button id="run-calculation-btn"
                        class="w-full py-3 px-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700">
                        Finale Aufteilung berechnen
                    </button>
                </div>
                <div id="calculation-results-area" class="mt-6 pt-6 border-t-2 border-gray-200">
                    <h2 class="text-xl font-bold text-gray-700">Berechnungsergebnis</h2>

                    <div id="calculation-view-switcher" class="flex flex-wrap gap-2 my-4 p-2 bg-gray-100 rounded-lg">
                    </div>

                    <div id="results-table" class="mt-2">
                        <p class="text-sm text-gray-500 text-center">Bitte eine Ansicht (Gesamt, Rest oder eine Portion)
                            auswählen, um das Ergebnis anzuzeigen.</p>
                    </div>
                </div>
            </div>


            <div id="notrufSettingsView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <div class="mb-6">
                    <div id="notruf-settings-tabs" class="grid grid-cols-2 gap-1 border rounded-lg bg-gray-100 p-1">
                        <button data-target-card="card-flic-notruf"
                            class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600">
                            Flic-Notruf-Button
                        </button>
                        <button data-target-card="card-app-notruf"
                            class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600">
                            APP-Notruf
                        </button>
                    </div>
                </div>

                <div id="notruf-prompt" class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-lg">
                    <p class="font-bold">Bitte wählen Sie oben einen Menüpunkt aus, um die Einstellungen zu bearbeiten.
                    </p>
                </div>

                <div id="card-flic-notruf" class="notruf-settings-card hidden space-y-6">

                    <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-indigo-500 mb-6">
                        <div class="flex justify-between items-center mb-4 pb-3 border-b">
                            <h2 class="text-xl font-bold text-gray-800">Flic-Button Klick-Zuweisungen</h2>
                            <button id="notrufOpenModeEditor"
                                class="py-1 px-3 bg-blue-100 text-blue-600 text-sm font-semibold rounded-lg hover:bg-blue-200 transition">
                                Modi Verwalten
                            </button>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div data-klick-typ="einfach"
                                class="flic-column-block p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:border-indigo-300 transition-all duration-200">
                                <h4 class="text-sm font-bold text-gray-800 mb-2 border-b pb-1">Klick: EINFACH</h4>
                                <span class="text-xs font-semibold text-gray-500">Aktueller Modus:</span>
                                <span id="flicDisplayModeName-einfach"
                                    class="text-lg font-semibold text-indigo-700 block break-words"
                                    title="Kein Modus">Kein Modus</span>
                                <span id="flicDisplayModeDesc-einfach" class="text-xs text-gray-600 mt-1 block"></span>
                            </div>

                            <div data-klick-typ="doppel"
                                class="flic-column-block p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:border-indigo-300 transition-all duration-200">
                                <h4 class="text-sm font-bold text-gray-800 mb-2 border-b pb-1">Klick: DOPPEL</h4>
                                <span class="text-xs font-semibold text-gray-500">Aktueller Modus:</span>
                                <span id="flicDisplayModeName-doppel"
                                    class="text-lg font-semibold text-indigo-700 block break-words"
                                    title="Kein Modus">Kein Modus</span>
                                <span id="flicDisplayModeDesc-doppel" class="text-xs text-gray-600 mt-1 block"></span>
                            </div>

                            <div data-klick-typ="halten"
                                class="flic-column-block p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:border-indigo-300 transition-all duration-200">
                                <h4 class="text-sm font-bold text-gray-800 mb-2 border-b pb-1">Klick: HOLD</h4>
                                <span class="text-xs font-semibold text-gray-500">Aktueller Modus:</span>
                                <span id="flicDisplayModeName-halten"
                                    class="text-lg font-semibold text-indigo-700 block break-words"
                                    title="Kein Modus">Kein Modus</span>
                                <span id="flicDisplayModeDesc-halten" class="text-xs text-gray-600 mt-1 block"></span>
                            </div>
                        </div>
                    </div>

                    <div id="flic-details-editor-container" class="hidden mt-4 space-y-3">
                        <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-indigo-500">
                            <h3 id="flic-editor-title" class="text-lg font-bold text-gray-800 mb-3">Modus ändern</h3>

                            <select id="flic-editor-selector"
                                class="flic-assignment-selector w-full p-2 border rounded-lg bg-white">
                            </select>

                            <div id="flic-editor-details"
                                class="bg-blue-50 text-blue-900 text-xs p-3 rounded mt-3 min-h-[60px]">
                            </div>
                        </div>

                        <button id="saveFlicAssignmentsBtn"
                            class="w-full py-2 px-4 bg-green-600 text-white font-bold rounded-lg shadow-md hover:bg-green-700 transition flex items-center justify-center gap-2">
                            Zuweisungen Speichern
                            <div class="loading-spinner"></div>
                        </button>
                    </div>
                    <div id="modeEditorArea" class="hidden space-y-6">
                        <div class="flex justify-between items-center">
                            <h2 class="text-2xl font-bold text-gray-800">Flic-Button Notrufmodus Verwalten</h2>
                            <button id="notrufCloseModeEditor"
                                class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                        </div>
                        <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-gray-300">
                            <h3 class="font-bold text-gray-800 mb-3">Vorhandene Modi</h3>
                            <div id="existingModesList" class="space-y-2 mb-4 max-h-48 overflow-y-auto">
                            </div>
                            <button id="notrufAddNewModeButton"
                                class="w-full py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition">
                                + Neuen Modus anlegen
                            </button>
                        </div>

                        <div id="modeConfigFormContainer" class="hidden">
                            <h3 id="modeConfigFormTitle" class="text-xl font-bold text-gray-800 mb-4">Modus
                                Konfigurieren</h3>
                            <div id="notrufConfigArea"
                                class="bg-white rounded-xl shadow-lg p-4 flex flex-col gap-4 border-t-4 border-orange-500">
                                <input type="hidden" id="editingModeId">

                                <div>
                                    <label for="notrufModeTitle"
                                        class="block text-sm font-medium text-gray-700 mb-1">Titel des Modus</label>
                                    <input type="text" id="notrufModeTitle" class="w-full p-2 border rounded-lg"
                                        placeholder="z.B. Standard Notruf">
                                </div>
                                <div>
                                    <label for="notrufModeDescInput"
                                        class="block text-sm font-medium text-gray-700 mb-1">Kurzbeschreibung (für
                                        Flic-Button Übersicht)</label>
                                    <input type="text" id="notrufModeDescInput" class="w-full p-2 border rounded-lg"
                                        placeholder="z.B. Sendet an alle Kontakte">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">API-Token</label>
                                    <div class="flex gap-2 items-center">
                                        <div id="notrufApiTokenDisplay"
                                            class="flex-grow p-2 border rounded-lg bg-gray-100 min-h-[40px] text-sm text-gray-600 flex flex-wrap gap-1 items-center">
                                            <span class="text-gray-400 italic">Kein Token ausgewählt</span>
                                        </div>
                                        <button id="notrufOpenApiTokenBook"
                                            class="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition"
                                            title="API-Token auswählen/verwalten">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor" class="w-5 h-5">
                                                <path fill-rule="evenodd"
                                                    d="M11.986 4.31a3.75 3.75 0 0 0-7.344 1.294.75.75 0 0 1-1.48-.216A5.25 5.25 0 0 1 12.23 3.07a.75.75 0 0 1-.244 1.24Zm-1.46-1.54a.75.75 0 0 1 1.054-.09l3 2.5a.75.75 0 1 1-.968 1.148l-3-2.5a.75.75 0 0 1-.086-1.058ZM6 9a.75.75 0 0 1 .75-.75h1.59l1.11-2.22a.75.75 0 1 1 1.34.67l-1.1 2.2h.11A3.75 3.75 0 0 1 13 12.75V15a.75.75 0 0 1-1.5 0v-2.25a2.25 2.25 0 0 0-2.25-2.25H7.5A.75.75 0 0 1 6 9.75v-.75Zm7.78 6.09a.75.75 0 0 0-1.06-.08l-3 2.5a.75.75 0 1 0 .96 1.16l3-2.5a.75.75 0 0 0 .1-.98Zm1.22-.99-.002-.002A5.25 5.25 0 0 0 7.77 16.93a.75.75 0 1 0 .245 1.478A6.75 6.75 0 0 1 17.5 10.5a.75.75 0 0 0-1.5 0c0 .98-.198 1.906-.55 2.72l.001.002a.75.75 0 0 0 1.05 1.05Z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">User Key
                                        (Empfänger)</label>
                                    <div class="flex gap-2 items-center">
                                        <div id="notrufUserKeyDisplay"
                                            class="flex-grow p-2 border rounded-lg bg-gray-100 min-h-[40px] text-sm text-gray-600 flex flex-wrap gap-1">
                                        </div>
                                        <button id="notrufOpenContactBook"
                                            class="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition"
                                            title="Kontaktbuch öffnen">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor" class="w-5 h-5">
                                                <path
                                                    d="M3 4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H3Zm2 2h10v1a.75.75 0 0 1-1.5 0V6H6v.75a.75.75 0 0 1-1.5 0V6Zm11 6a.75.75 0 0 1-.75.75H4.75a.75.75 0 0 1 0-1.5h10.5a.75.75 0 0 1 .75.75Z" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <label for="notrufTitle" class="block text-sm font-medium text-gray-700 mb-1">Titel
                                        der Benachrichtigung</label>
                                    <input type="text" id="notrufTitle" class="w-full p-2 border rounded-lg"
                                        placeholder="z.B. Notfall bei Oma">
                                </div>

                                <div>
                                    <label for="notrufMessage"
                                        class="block text-sm font-medium text-gray-700 mb-1">Nachricht</label>
                                    <textarea id="notrufMessage" rows="3"
                                        class="w-full p-2 border rounded-lg"></textarea>
                                </div>

                                <div class="pt-3 border-t">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Sound</label>
                                    <div class="flex gap-2 items-center">
                                        <div id="notrufSoundDisplay"
                                            class="flex-grow p-2 border rounded-lg bg-gray-100 min-h-[40px] text-sm text-gray-600 flex flex-wrap gap-1 items-center">
                                            <span class="text-gray-400 italic">Standard (pushover)</span>
                                        </div>
                                        <button id="notrufOpenSoundBook"
                                            class="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition"
                                            title="Sound auswählen/verwalten">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor" class="w-5 h-5">
                                                <path
                                                    d="M12.016 4.39a.75.75 0 0 0-1.182.046l-4 6a.75.75 0 0 0 .586 1.137h1.498V13a.75.75 0 0 0 1.5 0v-1.427h1.498a.75.75 0 0 0 .586-1.137l-4-6ZM6.25 7.5A.75.75 0 0 1 7 8.25v3a.75.75 0 0 1-1.5 0v-3A.75.75 0 0 1 6.25 7.5Zm7.5 0a.75.75 0 0 1 .75.75v3a.75.75 0 0 1-1.5 0v-3a.75.75 0 0 1 .75-.75Z" />
                                                <path fill-rule="evenodd"
                                                    d="M10 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16ZM9 1a9 9 0 0 0-9 9 9 9 0 0 0 9 9 9 9 0 0 0 9-9 9 9 0 0 0-9-9Z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <div class="pt-3 border-t">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Priorität</label>
                                    <div id="priority-buttons-container"
                                        class="grid grid-cols-5 gap-1 p-1 bg-gray-100 rounded-lg">
                                        <button data-priority="-2"
                                            class="priority-btn p-2 text-xs font-semibold rounded-md text-gray-600 hover:bg-gray-200">
                                            -2<br><span class="font-normal">(Leise)</span>
                                        </button>
                                        <button data-priority="-1"
                                            class="priority-btn p-2 text-xs font-semibold rounded-md text-gray-600 hover:bg-gray-200">
                                            -1<br><span class="font-normal">(Wenig)</span>
                                        </button>
                                        <button data-priority="0"
                                            class="priority-btn p-2 text-xs font-semibold rounded-md text-gray-600 hover:bg-gray-200">
                                            0<br><span class="font-normal">(Normal)</span>
                                        </button>
                                        <button data-priority="1"
                                            class="priority-btn p-2 text-xs font-semibold rounded-md text-gray-600 hover:bg-gray-200">
                                            1<br><span class="font-normal">(Hoch)</span>
                                        </button>
                                        <button data-priority="2"
                                            class="priority-btn p-2 text-xs font-semibold rounded-md text-gray-600 hover:bg-gray-200">
                                            2<br><span class="font-normal">(Notfall)</span>
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Notfall (-2) erfordert Retry/Expire.</p>
                                </div>

                                <div class="pt-3 border-t">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Wiederholungsintervall
                                        (Retry - für Notfall-Prio)</label>
                                    <div class="flex items-center gap-3 mb-2">
                                        <input type="checkbox" id="retryDeaktiviert" class="h-4 w-4">
                                        <label for="retryDeaktiviert" class="text-sm">Deaktiviert</label>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <input type="number" id="retrySecondsInput" min="30" max="10800" step="1"
                                            value="30"
                                            class="w-24 p-2 border rounded-lg text-sm focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed">
                                        <span class="text-sm text-gray-600">Sekunden (Minimum: 30, Maximum:
                                            10800)</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Expire wird automatisch auf das Maximum
                                        (10800s / 3h) gesetzt.</p>
                                </div>

                                <div class="flex gap-2 mt-4">
                                    <button id="notrufCancelEditModeButton"
                                        class="w-1/2 py-3 bg-gray-300 text-black font-bold rounded-lg shadow-md hover:bg-gray-400 transition">
                                        Abbrechen
                                    </button>
                                    <button id="notrufSaveModeButton"
                                        class="w-1/2 py-3 bg-green-600 text-white font-bold rounded-lg shadow-md hover:bg-green-700 transition">
                                        Modus Speichern
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="card-app-notruf" class="notruf-settings-card hidden space-y-6">
                    <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-gray-400">
                        <h2 class="text-xl font-bold text-gray-800">APP-Notruf</h2>
                        <p class="mt-2 text-gray-600">Diese Funktion befindet sich derzeit im Aufbau.</p>
                    </div>
                </div>

            </div>
            <div id="userSelectionModal"
                class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-20">
                <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-xs">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">Benutzer auswählen</h3>
                    <p class="text-sm text-gray-600 mb-4">Wählen Sie den Modus, in dem Sie sich anmelden möchten.
                    </p>
                    <div id="modalUserButtons" class="space-y-3"></div>
                    <div class="flex justify-end mt-4">
                        <button id="cancelSelectionButton"
                            class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">Abbrechen</button>
                    </div>
                </div>
            </div>

            <div id="pinModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-20">
                <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-xs">
                    <div id="pinRegularContent">
                        <h3 id="pinModalTitle" class="text-xl font-bold mb-4 text-gray-800">Schlüssel eingeben</h3>
                        <p class="text-sm text-gray-600 mb-4">Geben Sie den Schlüssel für den gewählten Benutzer
                            ein.
                        </p>
                        <input type="password" id="adminPinInput"
                            class="w-full p-3 border-2 border-gray-300 rounded-lg text-center tracking-widest text-lg focus:ring-blue-500 focus:border-blue-500"
                            maxlength="20">
                        <div id="pinError" class="text-red-500 text-sm mt-2 hidden">Falscher Schlüssel!</div>
                        <div class="flex justify-between space-x-3 mt-6">
                            <button id="backToSelectionButton"
                                class="py-2 px-3 bg-gray-400 text-white font-medium rounded-lg hover:bg-gray-500 transition">Zurück</button>
                            <button id="submitAdminKeyButton"
                                class="py-2 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">Bestätigen</button>
                        </div>
                    </div>
                    <div id="pinLockedContent" class="hidden text-center">
                        <h3 class="text-xl font-bold mb-4 text-red-700">Zugriff verweigert</h3>
                        <p class="text-gray-600 mb-6">Dieser Benutzer ist gesperrt. Bitte kontaktieren Sie einen
                            Administrator.</p>
                        <button id="closeLockedModalButton"
                            class="w-full py-2 px-4 bg-gray-600 text-white font-medium rounded-lg hover:bg-gray-700 transition">Zurück
                            zur Auswahl</button>
                    </div>
                </div>
            </div>


            <div id="logoutConfirmModal"
                class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-20">
                <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-xs">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">Abmelden</h3>
                    <p class="text-sm text-gray-600 mb-6">Möchten Sie sich wirklich abmelden?</p>
                    <div class="flex justify-between space-x-3 mt-4">
                        <button id="confirmLogoutNo"
                            class="flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">NEIN</button>
                        <button id="confirmLogoutYes"
                            class="flex-1 py-2 px-4 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition">JA</button>
                    </div>
                </div>
            </div>

        </main>

        <footer id="appFooter"
            class="flex-shrink-0 bg-gray-700 text-white border-t border-gray-600 p-2 flex justify-between items-center text-sm shadow-inner">
            <div id="footerStatus" class="flex items-center text-xs sm:text-sm font-bold text-gray-500">
                Status: <span class="ml-1 text-green-500">OK</span>
            </div>
            <div id="footerUser" class="font-medium text-xs sm:text-sm text-center">
            </div>
            <div id="footerLogout" class="flex items-center justify-end text-xs sm:text-sm">
            </div>
        </footer>

        <div id="templateApplyModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-30">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">Container-Inhalt einfügen</h3>
                    <button id="closeTemplateModalBtn" class="text-gray-400 hover:text-red-600">&times;</button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">1. Quell-Typ wählen</label>
                        <div class="grid grid-cols-2 gap-2 p-1 bg-gray-200 rounded-lg">
                            <label class="relative flex items-center justify-center cursor-pointer">
                                <input type="radio" name="template-type" value="Container" class="peer sr-only" checked>
                                <span
                                    class="w-full text-center py-1.5 px-3 rounded-md text-sm font-semibold text-gray-700 peer-checked:bg-white peer-checked:shadow">Container</span>
                            </label>
                            <label class="relative flex items-center justify-center cursor-pointer">
                                <input type="radio" name="template-type" value="Schiff" class="peer sr-only">
                                <span
                                    class="w-full text-center py-1.5 px-3 rounded-md text-sm font-semibold text-gray-700 peer-checked:bg-white peer-checked:shadow">Schiff</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label for="template-select" class="block text-sm font-medium text-gray-700 mb-1">2. Quelle
                            auswählen</label>
                        <select id="template-select" class="w-full p-2 border rounded-lg bg-white">
                            <option value="">Bitte zuerst Typ wählen...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">3. Inhalte zum Einfügen
                            auswählen</label>
                        <div id="template-items-container"
                            class="max-h-48 overflow-y-auto p-3 border rounded-lg bg-gray-50 space-y-2">
                        </div>
                    </div>
                    <div id="template-mode-section" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">4. Einfüge-Methode</label>
                        <div class="flex gap-4 p-2 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="insert-mode" value="einfuegen" class="h-4 w-4" checked>
                                <span>Zur Liste hinzufügen</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="insert-mode" value="ersetzen" class="h-4 w-4">
                                <span>Liste komplett ersetzen</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end space-x-3 mt-6">
                    <button id="cancel-template-modal-btn"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">Abbrechen</button>
                    <button id="apply-template-btn"
                        class="py-2 px-4 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition">Anwenden</button>
                </div>
            </div>
        </div>
        <div id="deletedListsModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-20">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Gelöschte Checklisten</h3>
                <div id="deletedListsContainer" class="space-y-3 max-h-96 overflow-y-auto">
                </div>
                <div class="flex justify-end mt-6">
                    <button id="closeDeletedListsModal"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">Schließen</button>
                </div>
            </div>
        </div>

        <div id="archivedListsModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-20">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Archivierte Checklisten</h3>
                <div id="archivedListsContainer" class="space-y-3 max-h-96 overflow-y-auto">
                </div>
                <div class="flex justify-end mt-6">
                    <button id="closeArchivedListsModal"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">Schließen</button>
                </div>
            </div>
        </div>

        <div id="permanentDeleteModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-30">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg">
                <h3 class="text-xl font-bold mb-4 text-red-800">Papierkorb endgültig leeren</h3>
                <p class="text-sm text-gray-600 mb-4">Wählen Sie die Checklisten aus, die unwiderruflich gelöscht werden
                    sollen. Diese Aktion kann nicht rückgängig gemacht werden.</p>

                <div class="p-2 border-b mb-2">
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" id="permanent-delete-select-all"
                            class="h-5 w-5 rounded border-gray-400 text-indigo-600 focus:ring-indigo-500">
                        <span class="font-semibold text-gray-700">Alle auswählen / abwählen</span>
                    </label>
                </div>

                <div id="permanentDeleteListsContainer"
                    class="space-y-2 max-h-64 overflow-y-auto p-2 border rounded-lg bg-gray-50">
                </div>

                <div class="flex justify-between items-center space-x-3 mt-6">
                    <button id="cancelPermanentDeleteBtn"
                        class="flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">Abbrechen</button>
                    <button id="confirmPermanentDeleteBtn"
                        class="flex-1 py-2 px-4 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition">Auswahl
                        endgültig löschen</button>
                </div>
            </div>
        </div>

        <div id="contactBookModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-30">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg flex flex-col gap-4">
                <h3 class="text-xl font-bold text-gray-800">Kontaktbuch</h3>

                <div id="contactBookList" class="space-y-2 max-h-48 overflow-y-auto p-3 border rounded-lg bg-gray-50">
                    <p class="text-sm text-center text-gray-400">Keine Kontakte gefunden.</p>
                </div>

                <div class="p-4 border rounded-xl bg-green-50 space-y-2">
                    <h4 class="font-semibold text-green-800">Neuen Kontakt anlegen</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                        <select id="contactIsGroup" class="p-2 border rounded-lg bg-white">
                            <option value="User" selected>User</option>
                            <option value="Gruppe">Gruppe</option>
                        </select>
                        <input type="text" id="contactName" class="p-2 border rounded-lg" placeholder="Anzeigename">
                    </div>
                    <input type="text" id="contactUserKey" class="w-full p-2 border rounded-lg"
                        placeholder="User / Group Key">
                    <button id="contactAddButton"
                        class="w-full py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700">Hinzufügen</button>
                </div>
                <div class="flex justify-end space-x-3 mt-4">
                    <button id="contactBookCloseButton"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300">Schließen</button>
                    <button id="contactBookApplyButton"
                        class="py-2 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700">Auswahl
                        übernehmen</button>
                </div>
            </div>
        </div>

        <div id="apiTokenBookModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-40">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg flex flex-col gap-4">
                <h3 class="text-xl font-bold text-gray-800">API-Token Verwalten</h3>
                <div id="apiTokenBookList" class="space-y-2 max-h-48 overflow-y-auto p-3 border rounded-lg bg-gray-50">
                    <p class="text-sm text-center text-gray-400">Keine Tokens gefunden.</p>
                </div>
                <div class="p-4 border rounded-xl bg-green-50 space-y-2">
                    <h4 class="font-semibold text-green-800">Neuen Token anlegen</h4>
                    <input type="text" id="apiTokenName" class="w-full p-2 border rounded-lg"
                        placeholder="Bezeichnung (z.B. App Name)">
                    <input type="text" id="apiTokenKey" class="w-full p-2 border rounded-lg"
                        placeholder="API / Application Key">
                    <button id="apiTokenAddButton"
                        class="w-full py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700">Hinzufügen</button>
                </div>
                <div class="flex justify-end space-x-3 mt-4">
                    <button id="apiTokenBookCloseButton"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300">Schließen</button>
                    <button id="apiTokenBookApplyButton"
                        class="py-2 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700">Auswahl
                        übernehmen</button>
                </div>
            </div>
        </div>

        <div id="soundBookModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-40">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg flex flex-col gap-4">
                <h3 class="text-xl font-bold text-gray-800">Sounds Verwalten</h3>
                <div id="soundBookList" class="space-y-2 max-h-48 overflow-y-auto p-3 border rounded-lg bg-gray-50">
                    <div class="flex items-center justify-between p-2 hover:bg-gray-100 rounded-md">
                        <label class="flex items-center gap-3 cursor-pointer flex-grow">
                            <input type="radio" name="soundSelection" value="default" class="h-4 w-4 sound-radio">
                            <div>
                                <span class="font-semibold text-gray-800">Standard (pushover)</span>
                                <p class="text-xs text-gray-500 italic">Verwendet den in der Pushover-App eingestellten
                                    Ton</p>
                            </div>
                        </label>
                    </div>
                    <p id="sound-list-placeholder" class="text-sm text-center text-gray-400 hidden">Keine eigenen Sounds
                        gefunden.</p>
                </div>
                <div class="p-4 border rounded-xl bg-green-50 space-y-2">
                    <h4 class="font-semibold text-green-800">Neuen Sound anlegen</h4>
                    <input type="text" id="soundCode" class="w-full p-2 border rounded-lg"
                        placeholder="Soundcode (von Pushover)">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="soundUseCustomName" class="h-4 w-4">
                        <label for="soundUseCustomName" class="text-sm font-medium">Eigenen Anzeigenamen
                            verwenden</label>
                    </div>
                    <input type="text" id="soundCustomName" class="w-full p-2 border rounded-lg hidden"
                        placeholder="Eigener Anzeigename">
                    <button id="soundAddButton"
                        class="w-full py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700">Hinzufügen</button>
                </div>
                <div class="flex justify-end space-x-3 mt-4">
                    <button id="soundBookCloseButton"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300">Schließen</button>
                    <button id="soundBookApplyButton"
                        class="py-2 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700">Auswahl
                        übernehmen</button>
                </div>
            </div>
        </div>

<script type="module" src="haupteingang.js"></script>
<script type="module" src="log-InOut.js"></script>
<script type="module" src="admin_adminfunktionenHome.js"></script>
<script type="module" src="admin_benutzersteuerung.js"></script>
<script type="module" src="admin_genehmigungsprozess.js"></script>
<script type="module" src="admin_passwoerter.js"></script>
<script type="module" src="admin_protokollHistory.js"></script>
<script type="module" src="admin_rechteverwaltung.js"></script>
<script type="module" src="admin_rollenverwaltung.js"></script>
<script type="module" src="checklist.js"></script>
<script type="module" src="essensberechnung.js"></script>
<script type="module" src="notfall.js"></script>
<script type="module" src="pushbenachrichtigung.js"></script>

</body>

</html>