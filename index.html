<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOP 2 Smart Home</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    
    <script>
        // Mermaid initialisieren nach dem Laden
        window.addEventListener('load', function() {
            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({ startOnLoad: false, theme: 'default' });
            }
        });
    </script>

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="TOP 2 App">
    <meta name="apple-mobile-web-app-title" content="TOP 2">
    <meta name="theme-color" content="#4f46e5" />
    <meta name="msapplication-navbutton-color" content="#4f46e5">
    <meta name="apple-mobile-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/png" sizes="192x192" href="https://placehold.co/192x192/4f46e5/ffffff?text=T2">
    <link rel="apple-touch-icon" type="image/png" sizes="192x192"
        href="https://placehold.co/192x192/4f46e5/ffffff?text=T2">

    <link rel="manifest" href="manifest.json">

    <link rel="stylesheet" href="style.css">
    
    <script>
        // Service Worker für PWA-Installation registrieren
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker registriert:', reg.scope))
                    .catch(err => console.error('Service Worker Fehler:', err));
            });
        }
    </script>
</head>

<body>

    <div class="app-container">

        <header id="appHeader"
            class="flex-shrink-0 bg-gradient-to-r from-indigo-600 to-cyan-500 text-white border-b border-indigo-700 p-4 flex justify-center items-center shadow-md cursor-pointer">
            <h1 id="headerTitle" class="text-xl font-bold tracking-wider whitespace-nowrap px-2">TOP 2 - Markus <span
                    class="text-red-300">❤️</span> Jasmin</h1>
        </header>

        <main class="main-content space-y-4">

            <div id="homeView" class="view active">

                <div id="homeActionButtons" class="flex justify-between mb-3 gap-2 items-center min-h-[40px]">
                    <button id="pushmailCenterBar"
                        class="hidden bg-gray-600 text-white text-xs font-bold py-1 px-3 rounded-lg shadow-lg hover:bg-gray-700 transition z-10">
                        PUSHMAIL-Center
                    </button>
                    <div class="flex gap-2">
                        <button id="mainSettingsButton"
                            class="bg-gray-600 text-white text-xs font-bold py-1 px-3 rounded-lg shadow-lg hover:bg-gray-700 transition hidden z-10">
                            Einstellungen
                        </button>
                        <button id="mainAdminButton"
                            class="bg-red-600 text-white text-xs font-bold py-1 px-3 rounded-lg shadow-lg hover:bg-red-700 transition hidden z-10">
                            ADMIN
                        </button>
                    </div>
                </div>
                <div id="guestPrompt"
                    class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-lg hidden">
                    <p class="font-bold">Anmeldung erforderlich</p>
                    <p>Bitte melden Sie sich über den Modus-Bereich unten an, um die Steuerung zu verwenden.</p>
                </div>

                <div id="noPermissionPrompt"
                    class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg hidden">
                    <p class="font-bold">Keine Berechtigung</p>
                    <p>Ihrem Konto wurden keine Berechtigungen zugewiesen. Bitte kontaktieren Sie einen Administrator.
                    </p>
                </div>

                <div id="pushCard" data-permission="PUSHOVER"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 w-full border-t-4 border-red-500 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-red-500 flex-shrink-0">
                        <path fill-rule="evenodd"
                            d="M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25-2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 17.069v-5.814l4.138 3.551a.75.75 0 0 0 .972-.06l6.26-5.408 4.793 4.116-.167 4.567A.75.75 0 0 0 21 18H3a.75.75 0 0 0-.75.75v-1.681ZM21 6a.75.75 0 0 0-.75-.75H3.75a.75.75 0 0 0-.75.75v.524l8.36 7.199c.07.06.15.1.24.1s.17.04.24.1l8.37-7.21V6Z"
                            clip-rule="evenodd" />
                    </svg>
                    <div class="flex w-full items-center">
                        <div id="pushoverButton" class="flex-grow cursor-pointer pr-4">
                            <span class="text-xl font-bold text-red-500 block">Push-Benachrichtigung</span>
                            <span class="text-sm text-gray-500">Pushover Notifikationen senden.</span>
                        </div>
                        <div id="notrufSettingsButton"
                            class="flex-shrink-0 pl-4 ml-4 border-l border-gray-200 text-right cursor-pointer">
                            <span class="text-xl font-bold text-red-700 block">NOTRUF</span>
                            <span class="text-sm text-gray-500">Einstellungen</span>
                        </div>
                    </div>
                </div>
                <div id="entranceCard" data-permission="ENTRANCE"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-indigo-500 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="w-10 h-10 text-indigo-500 flex-shrink-0">
                        <rect x="4" y="4" width="16" height="18" rx="2" ry="2" />
                        <path d="M12 4h4" />
                        <path d="M14 13h.01" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-indigo-500 block">Haupteingang öffnen</span>
                        <span class="text-sm text-gray-500">Steuern Sie den Zugang zum Haupteingang.</span>
                    </div>
                </div>
                <div data-permission="CHECKLIST"
                    class="card bg-white rounded-xl shadow-lg w-full border-t-4 border-green-500 hidden">
                    <div class="p-4 flex items-center space-x-4">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            class="w-10 h-10 text-green-500 flex-shrink-0">
                            <path fill-rule="evenodd"
                                d="M19.5 21a3 3 0 0 0 3-3V6a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h15Zm-11.02-7.22L6.9 12.2c-.39-.39-1.02-.39-1.41 0a.996.996 0 0 0 0 1.41l2.38 2.38c.39.39 1.02.39 1.41 0l5.88-5.88a.996.996 0 1 0-1.41-1.41l-5.13 5.13Z"
                                clip-rule="evenodd" />
                        </svg>
                        <span class="text-xl font-bold text-green-500">Checkliste</span>
                    </div>
                    <div class="bg-gray-50 p-2 grid grid-cols-2 gap-2 rounded-b-xl border-t">
                        <div id="currentChecklistCard"
                            class="p-3 text-center rounded-lg hover:bg-green-100 cursor-pointer">
                            <span class="font-semibold text-green-800">Aktuelle Checkliste</span>
                            <span id="current-checklist-name-display"
                                class="text-sm font-bold text-gray-600 mt-1 block"></span>
                        </div>
                        <div id="checklistSettingsCard"
                            class="p-3 text-center rounded-lg hover:bg-gray-200 cursor-pointer flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-5 h-5 text-gray-600">
                                <path fill-rule="evenodd"
                                    d="M11.078 2.25c-.217 0-.424.034-.622.098l-6.07 1.916a.75.75 0 0 0-.58 1.154l4.335 6.191a.75.75 0 0 0 1.155-.582V4.243a.75.75 0 0 0-.413-.673l-1.38-.771a.75.75 0 0 0-.53-.162Zm-.022 8.355a.75.75 0 0 0-1.155.582v4.664l1.12.352a.75.75 0 0 0 .814-.431l1.632-3.263a.75.75 0 0 0-.25-1.022l-1.751-1.066Z"
                                    clip-rule="evenodd" />
                                <path
                                    d="M12.562 2.02a.75.75 0 0 1 .638.51l3.5 7a.75.75 0 0 1-.51.983l-7 3.5a.75.75 0 0 1-.983-.51l-3.5-7a.75.75 0 0 1 .51-.983l7-3.5a.75.75 0 0 1 .345-.083Zm-2.286 1.044-6.323 3.162 3.162 6.323 6.323-3.162-3.162-6.323Z" />
                            </svg>
                            <span class="font-semibold text-gray-700">Einstellungen</span>
                        </div>
                    </div>
                </div>

                <div id="terminplanerCard" data-permission="TERMINPLANER"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-cyan-500 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-cyan-500 flex-shrink-0">
                        <path fill-rule="evenodd"
                            d="M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75ZM5.25 6h13.5V7.5H5.25V6ZM4.5 9v11.25A1.5 1.5 0 0 0 5.25 21h13.5a1.5 1.5 0 0 0 1.5-1.5V9H4.5Z"
                            clip-rule="evenodd" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-cyan-500 block">Termin finden</span>
                        <span class="text-sm text-gray-500">Gruppenumfragen und Events planen.</span>
                    </div>
                </div>

                <div id="toolsCard" data-permission="TOOLS"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-slate-600 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-slate-600 flex-shrink-0">
                        <path fill-rule="evenodd"
                            d="M2.25 6a3 3 0 0 1 3-3h4.5a3 3 0 0 1 3 3v4.5a3 3 0 0 1-3 3h-4.5a3 3 0 0 1-3-3V6Zm9.75 0a3 3 0 0 1 3-3h4.5a3 3 0 0 1 3 3v4.5a3 3 0 0 1-3 3h-4.5a3 3 0 0 1-3-3V6Zm0 9.75a3 3 0 0 1 3-3h4.5a3 3 0 0 1 3 3v4.5a3 3 0 0 1-3 3h-4.5a3 3 0 0 1-3-3v-4.5Zm-9.75 0a3 3 0 0 1 3-3h4.5a3 3 0 0 1 3 3v4.5a3 3 0 0 1-3 3h-4.5a3 3 0 0 1-3-3v-4.5Z"
                            clip-rule="evenodd" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-slate-700 block">Tools</span>
                        <span class="text-sm text-gray-500">Schnelle Mini-Tools im App-Format.</span>
                    </div>
                </div>

                <div id="essensberechnungCard" data-permission="ESSENSBERECHNUNG"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-orange-500 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-orange-500 flex-shrink-0">
                        <path
                            d="M12.75 1.5a.75.75 0 0 0-1.5 0v5.333A3.375 3.375 0 0 0 8.333 10H3a.75.75 0 0 0 0 1.5h5.333a3.375 3.375 0 0 0 2.917 3.167V22.5a.75.75 0 0 0 1.5 0v-7.833A3.375 3.375 0 0 0 15.667 11.5h5.333a.75.75 0 0 0 0-1.5h-5.333a3.375 3.375 0 0 0-2.917-3.167V1.5Z" />
                        <path
                            d="M14.013 7.857a24.417 24.417 0 0 0-4.025 0 .75.75 0 0 0 0 1.486 22.918 22.918 0 0 1 4.025 0 .75.75 0 0 0 0-1.486Z" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-orange-500 block">Essensberechnung</span>
                        <span class="text-sm text-gray-500">Mahlzeiten abwiegen und Portionen berechnen.</span>
                    </div>
                </div>
                <div id="zahlungsverwaltungCard" data-permission="ZAHLUNGSVERWALTUNG"
                    class="card relative overflow-hidden bg-white p-4 rounded-xl shadow-lg flex items-center gap-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-emerald-600 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-emerald-600 flex-shrink-0">
                        <path
                            d="M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.314.156-.68.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z" />
                        <path fill-rule="evenodd"
                            d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z"
                            clip-rule="evenodd" />
                    </svg>
                    <div class="z-10"> <span class="text-xl font-bold text-emerald-600 block">Zahlungsverwaltung</span>
                        <span class="text-sm text-gray-500">Schulden verwalten, Finanzen tracken.</span>
                    </div>
                </div>

                <!-- Ticket Support Card -->
                <div id="ticketSupportCard" data-permission="TICKET_SUPPORT"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-purple-600 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-purple-600 flex-shrink-0">
                        <path fill-rule="evenodd"
                            d="M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6.905 9.97a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72V18a.75.75 0 0 0 1.5 0v-4.19l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z"
                            clip-rule="evenodd" />
                        <path
                            d="M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-purple-600 block">Ticket Support</span>
                        <span class="text-sm text-gray-500">Aufgaben erstellen und zuweisen.</span>
                    </div>
                </div>

                <!-- Notizen Card -->
                <div id="notizenCard" data-permission="NOTIZEN"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-amber-600 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-amber-600 flex-shrink-0">
                        <path d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625Z" />
                        <path d="M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-amber-600 block">Notizen</span>
                        <span class="text-sm text-gray-500">Notizen mit Kategorien verwalten.</span>
                    </div>
                </div>

                <div id="wertguthabenCard" data-permission="WERTGUTHABEN"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-emerald-600 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-emerald-600 flex-shrink-0">
                        <path d="M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.323.152-.691.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z" />
                        <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z" clip-rule="evenodd" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-emerald-600 block">Wertguthaben</span>
                        <span class="text-sm text-gray-500">Gutscheine & Guthaben verwalten.</span>
                    </div>
                </div>

                <div id="lizenzenCard" data-permission="LIZENZEN"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-yellow-600 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-yellow-600 flex-shrink-0">
                        <path fill-rule="evenodd" d="M15.75 5.25a3 3 0 0 1 3 3v.75a.75.75 0 0 1-1.5 0v-.75a1.5 1.5 0 0 0-3 0V9a.75.75 0 0 1-1.5 0v-.75a3 3 0 0 1 3-3Zm-9 1.5a.75.75 0 0 1 .75.75V9a.75.75 0 0 1-1.5 0V7.5a.75.75 0 0 1 .75-.75Zm0 4.5a.75.75 0 0 1 .75.75v4.5h9v-4.5a.75.75 0 0 1 1.5 0v5.25a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V12a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-yellow-600 block">Lizenzen</span>
                        <span class="text-sm text-gray-500">Lizenzcodes & Abos verwalten.</span>
                    </div>
                </div>

                <div id="vertragsverwaltungCard" data-permission="VERTRAGSVERWALTUNG"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-indigo-600 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-indigo-600 flex-shrink-0">
                        <path fill-rule="evenodd" d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625ZM7.5 15a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 7.5 15Zm.75 2.25a.75.75 0 0 0 0 1.5H12a.75.75 0 0 0 0-1.5H8.25Z" clip-rule="evenodd" />
                        <path d="M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-indigo-600 block">Vertragsverwaltung</span>
                        <span class="text-sm text-gray-500">Verträge, Abos & Kündigungen verwalten.</span>
                    </div>
                </div>

                <div id="sendungsverwaltungCard" data-permission="SENDUNGSVERWALTUNG"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-amber-500 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-amber-500 flex-shrink-0">
                        <path d="M3.375 4.5C2.339 4.5 1.5 5.34 1.5 6.375V13.5h12V6.375c0-1.036-.84-1.875-1.875-1.875h-8.25ZM13.5 15h-12v2.625c0 1.035.84 1.875 1.875 1.875h.375a3 3 0 1 1 6 0h3a.75.75 0 0 0 .75-.75V15Z" />
                        <path d="M8.25 19.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0ZM15.75 6.75a.75.75 0 0 0-.75.75v11.25c0 .087.015.17.042.248a3 3 0 0 1 5.958.464c.853-.175 1.522-.935 1.464-1.883a18.659 18.659 0 0 0-3.732-10.104 1.837 1.837 0 0 0-1.47-.725H15.75Z" />
                        <path d="M19.5 19.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-amber-500 block">Sendungsverwaltung</span>
                        <span class="text-sm text-gray-500">Pakete & Sendungen tracken & verwalten.</span>
                    </div>
                </div>

                <div id="rezepteCard" data-permission="REZEPTE"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-orange-500 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-orange-500 flex-shrink-0">
                        <path d="M12.75 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM7.5 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM8.25 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM9.75 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM10.5 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM12.75 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM14.25 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM15 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM15 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" />
                        <path fill-rule="evenodd" d="M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z" clip-rule="evenodd" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-orange-500 block">Rezepte</span>
                        <span class="text-sm text-gray-500">Rezeptsammlung verwalten & durchsuchen.</span>
                    </div>
                </div>

                <div id="haushaltszahlungenCard" data-permission="HAUSHALTSZAHLUNGEN"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-cyan-600 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-cyan-600 flex-shrink-0">
                        <path d="M11.47 3.841a.75.75 0 0 1 1.06 0l8.69 8.69a.75.75 0 1 0 1.06-1.061l-8.689-8.69a2.25 2.25 0 0 0-3.182 0l-8.69 8.69a.75.75 0 1 0 1.061 1.06l8.69-8.689Z" />
                        <path d="m12 5.432 8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 0 1-.75-.75v-4.5a.75.75 0 0 0-.75-.75h-3a.75.75 0 0 0-.75.75V21a.75.75 0 0 1-.75.75H5.625a1.875 1.875 0 0 1-1.875-1.875v-6.198a2.29 2.29 0 0 0 .091-.086L12 5.432Z" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-cyan-600 block">Haushaltszahlungen</span>
                        <span class="text-sm text-gray-500">Gemeinsame Kosten verwalten & aufteilen.</span>
                    </div>
                </div>

                <div id="geschenkemanagementCard" data-permission="GESCHENKEMANAGEMENT"
                    class="card bg-white p-4 rounded-xl shadow-lg flex items-center space-x-4 hover:shadow-xl transition duration-200 cursor-pointer w-full border-t-4 border-pink-600 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-pink-600 flex-shrink-0">
                        <path d="M9.375 3a1.875 1.875 0 0 0 0 3.75h1.875v4.5H3.375A1.875 1.875 0 0 1 1.5 9.375v-.75c0-1.036.84-1.875 1.875-1.875h3.193A3.375 3.375 0 0 1 12 2.753a3.375 3.375 0 0 1 5.432 3.997h3.193c1.035 0 1.875.84 1.875 1.875v.75c0 1.036-.84 1.875-1.875 1.875H12.75v-4.5h1.875a1.875 1.875 0 1 0-1.875-1.875V6.75h-1.5V4.875C11.25 3.839 10.41 3 9.375 3ZM11.25 12.75H3v6.75a2.25 2.25 0 0 0 2.25 2.25h6v-9ZM12.75 12.75v9h6.75a2.25 2.25 0 0 0 2.25-2.25v-6.75h-9Z" />
                    </svg>
                    <div>
                        <span class="text-xl font-bold text-pink-600 block">Geschenkemanagement</span>
                        <span class="text-sm text-gray-500">Geschenke für alle Anlässe planen & verwalten.</span>
                    </div>
                </div>
            </div>




            <div id="adminView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <h2 class="text-2xl font-bold text-gray-800 mb-4">Admin Einstellungen</h2>

                <div id="noAdminPermissionsPrompt"
                    class="bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4 rounded-lg hidden">
                    <p class="font-bold">Keine Berechtigungen</p>
                    <p>Für Ihr Admin-Konto sind keine Verwaltungs-Module freigeschaltet. Bitte kontaktieren Sie einen
                        Systemadministrator.</p>
                </div>

                <div id="adminRightsSection" class="hidden">
                    <div id="adminRightsToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-yellow-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">ADMIN - Rechteverwaltung</span>
                            <svg id="adminRightsToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                    <div id="adminRightsArea" class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                    </div>
                </div>

                <div id="roleManagementSection" class="hidden">
                    <div id="roleSettingsToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-purple-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">Rollenverwaltung</span>
                            <svg id="roleToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke-width="2.5" stroke="currentColor" class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                    <div id="roleManagementArea" class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                    </div>
                </div>

                <div id="passwordSection">
                    <div id="passwordSettingsToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-red-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">Passwörter</span>
                            <svg id="passwordToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                    <div id="passwordManagementArea"
                        class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                        <div id="userKeyList" class="space-y-4"></div>
                    </div>
                </div>

                <div id="userSection">
                    <div id="userManagementToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-blue-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">Benutzersteuerung</span>
                            <svg id="userManagementToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                    <div id="userManagementArea" class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                        <button id="showAddUserFormBtn"
                            class="w-full p-3 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-700 transition shadow-md">+
                            Benutzer anlegen</button>
                        <div id="addUserFormContainer" class="p-4 border rounded-xl bg-green-50 hidden">
                            <h4 class="font-bold text-lg text-green-800 mb-2">Neuen Benutzer anlegen</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                <input type="text" id="newUserName" class="p-2 border rounded-lg"
                                    placeholder="Nickname*">
                                <input type="text" id="newUserRealName" class="p-2 border rounded-lg"
                                    placeholder="Vorname & Nachname*">
                                <div id="newUserKeyWrapper" class="sm:col-span-1">
                                    <input type="password" id="newUserKey" class="p-2 border rounded-lg w-full"
                                        placeholder="Passwort* (mind. 4 Zeichen)">
                                </div>
                                <select id="newUserPermissionType" class="p-2 border rounded-lg bg-white">
                                    <option value="role" selected>Rolle (Standard)</option>
                                    <option value="individual">Individuell</option>
                                    <option value="not_registered">Nicht registriert</option>
                                </select>
                                <select id="newUserRole" class="p-2 border rounded-lg bg-white sm:col-span-2">
                                </select>
                                <button id="saveNewUserButton"
                                    class="sm:col-span-2 p-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700">Erstellen</button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">* Pflichtfelder (außer bei "Nicht registriert")</p>
                        </div>

                        <div id="registeredUserList" class="space-y-3 pt-4 border-t mt-4">
                        </div>

                        <div class="mt-6 pt-4 border-t">
                            <button id="notRegisteredToggle"
                                class="w-full flex justify-between items-center p-3 bg-gray-100 hover:bg-gray-200 rounded-lg text-left font-semibold text-gray-700">
                                <span>Nicht registrierte Personen (<span id="notRegisteredCount">0</span>)</span>
                                <svg id="notRegisteredToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                    viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                    class="w-5 h-5 transform transition-transform">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                </svg>
                            </button>
                            <div id="notRegisteredList" class="hidden mt-2 space-y-2 pl-4 border-l-2 border-gray-200">
                                <p class="text-xs text-center text-gray-400">Keine nicht registrierten Personen
                                    vorhanden.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="mainFunctionsSection">
                    <div id="mainFunctionsToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-cyan-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">Adminfunktionen Hauptseite</span>
                            <svg id="mainFunctionsToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>


                    <div id="mainFunctionsArea" class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                        <div class="mb-4">
                            <h3 class="text-sm font-semibold text-gray-500 mb-1 px-1">Funktion auswählen</h3>
                            <div id="main-functions-tabs"
                                class="grid grid-cols-3 gap-1 border rounded-lg bg-gray-100 p-1">
                                <button data-target-card="card-main-push"
                                    class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600">Push</button>
                                <button data-target-card="card-main-entrance"
                                    class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600">Eingang</button>
                                <button data-target-card="card-main-checklist"
                                    class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600">Checkliste</button>
                            </div>
                        </div>

                        <div id="main-functions-content-area" class="space-y-4">

                            <div id="main-functions-prompt" class="text-center p-4 bg-gray-50 rounded-lg">
                                <p class="font-semibold text-gray-600">Bitte wählen Sie oben eine Funktion aus, um sie
                                    anzuzeigen.</p>
                            </div>

                            <div id="card-main-push" class="main-functions-card hidden">
                                <div class="p-4 bg-gray-50 rounded-lg text-center">
                                    <p class="font-semibold text-gray-600">Hier gibt es aktuell keinen Inhalt.</p>
                                    <p class="text-sm text-gray-500 mt-1">Die Funktion befindet sich auf der Hauptseite.
                                    </p>
                                </div>
                            </div>
                            <div id="card-main-entrance" class="main-functions-card hidden">
                                <div class="p-4 bg-gray-50 rounded-lg text-center">
                                    <p class="font-semibold text-gray-600">Hier gibt es aktuell keinen Inhalt.</p>
                                    <p class="text-sm text-gray-500 mt-1">Die Funktion befindet sich auf der Hauptseite.
                                    </p>
                                </div>
                            </div>
                            <div id="card-main-checklist" class="main-functions-card hidden">
                                <div class="p-4 bg-gray-50 rounded-lg">
                                    <button id="permanently-delete-items-btn"
                                        class="w-full py-2 px-4 bg-red-600 text-white font-bold rounded-lg shadow-md hover:bg-red-700 transition flex items-center justify-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                            class="w-5 h-5">
                                            <path fill-rule="evenodd"
                                                d="M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.58.22-2.365.468a.75.75 0 1 0 .23 1.482l.149-.022.841 10.518A2.75 2.75 0 0 0 7.596 19h4.807a2.75 2.75 0 0 0 2.742-2.53l.841-10.52.149.023a.75.75 0 0 0 .23-1.482A41.03 41.03 0 0 0 14 4.193v-.443A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 0 0-1.5.06l.3 7.5a.75.75 0 1 0 1.5-.06l-.3-7.5Zm4.34.06a.75.75 0 1 0-1.5-.06l-.3 7.5a.75.75 0 1 0 1.5.06l.3-7.5Z"
                                                clip-rule="evenodd"></path>
                                        </svg>
                                        Papierkorb endgültig leeren
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="approvalProcessSection">
                    <div id="approvalProcessToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-green-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">Genehmigungsprozess</span>
                            <svg id="approvalToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                    <div id="approvalProcessArea" class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                    </div>
                </div>

                <div id="protocolHistorySection">
                    <div id="protocolHistoryToggle"
                        class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-gray-500 cursor-pointer hover:shadow-xl transition duration-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-gray-800">Protokoll History</span>
                            <svg id="protocolHistoryToggleIcon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
                                class="w-6 h-6 transform transition-transform">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                    <div id="protocolHistoryArea" class="bg-white rounded-xl shadow-lg mt-2 p-4 hidden flex-col gap-4">
                    </div>
                </div>
            </div>



            <div id="userSettingsView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Eigene Einstellungen</h2>

                <div id="currentUserKeyDisplay"
                    class="bg-yellow-100 border-l-4 border-yellow-400 text-yellow-800 p-4 rounded-lg"
                    style="display: none;">
                </div>

                <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-blue-500">
                    <h3 id="userSettingsName" class="font-bold text-gray-800 mb-2">Passwort für ... ändern</h3>
                    <p class="text-sm text-gray-600 mb-4">Geben Sie ein neues Passwort ein, um Ihr altes zu
                        ersetzen.
                    </p>
                    <div class="flex space-x-2 mt-3">
                        <input type="password" id="userSettingsNewKeyInput"
                            class="flex-grow p-2 border border-blue-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Neuen Schlüssel eingeben (mind. 4 Zeichen)">
                        <button id="userSettingsSaveKeyButton"
                            class="py-2 px-3 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 transition">Speichern</button>
                    </div>
                </div>
            </div>

            <div id="entranceView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <h2 class="text-2xl font-bold text-gray-800 mb-4">Haupteingang Steuerung</h2>

                <button data-delay="0"
                    class="action-button w-full py-4 px-6 bg-indigo-700 text-white text-xl font-extrabold rounded-xl shadow-lg hover:bg-indigo-800 transition duration-200 flex items-center justify-center">
                    <span class="button-text">SOFORT ÖFFNEN</span>
                    <div class="loading-spinner"></div>
                </button>

                <div class="w-full grid grid-cols-3 gap-4">
                    <button data-delay="5"
                        class="action-button py-4 bg-gray-200 text-gray-800 font-semibold rounded-xl shadow-md hover:bg-gray-300 transition duration-200 flex items-center justify-center">
                        <span class="button-text">5 Sek</span>
                        <div class="loading-spinner"></div>
                    </button>
                    <button data-delay="10"
                        class="action-button py-4 bg-gray-200 text-gray-800 font-semibold rounded-xl shadow-md hover:bg-gray-300 transition duration-200 flex items-center justify-center">
                        <span class="button-text">10 Sek</span>
                        <div class="loading-spinner"></div>
                    </button>
                    <button data-delay="15"
                        class="action-button py-4 bg-gray-200 text-gray-800 font-semibold rounded-xl shadow-md hover:bg-gray-300 transition duration-200 flex items-center justify-center">
                        <span class="button-text">15 Sek</span>
                        <div class="loading-spinner"></div>
                    </button>
                </div>
            </div>

            <div id="checklistView" class="view"></div>

            <div id="checklistSettingsView" class="view"></div>

            <div id="pushoverView" class="view">
                <div class="back-link-container w-full mb-2">
                    <div class="w-full flex items-center justify-between">
                        <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                            data-target="home">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                                class="w-5 h-5 mr-1">
                                <path d="m15 18-6-6 6-6" />
                            </svg>
                            <span class="text-sm font-semibold">zurück</span>
                        </button>
                        <button id="pushoverSettingsToggleButton"
                            class="py-2 px-4 bg-gray-200 text-gray-800 text-sm font-semibold rounded-lg shadow-md hover:bg-gray-300 transition">
                            Einstellungen
                        </button>
                    </div>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <div id="pushoverSendSection" class="space-y-4">
                    <h2 class="text-2xl font-bold text-gray-800">Nachricht senden</h2>

                    <div class="bg-white p-5 rounded-xl shadow-lg border border-gray-100">
                        <div class="mb-4">
                            <label for="pushoverRecipient" class="block text-sm font-medium text-gray-700 mb-1">Empfänger (berechtigt durch)</label>
                            <select id="pushoverRecipient"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-5900 bg-white">
                                <option value="" disabled selected>Bitte warten...</option>
                            </select>
                            <div id="pushoverGrantedBy" class="text-xs text-gray-500 mt-1"></div>
                        </div>

                        <div id="pushoverNoRecipientsNotice" class="hidden p-3 rounded-lg bg-gray-50 border border-gray-200 text-sm text-gray-700">
                            Du wurdest von niemandem berechtigt. Bitte lass dich von einer Person freischalten.
                        </div>

                        <div id="pushoverSendDetails" class="hidden">

                        <div class="mb-4 p-3 rounded-lg border border-gray-200 bg-gray-50 space-y-3">
                            <div>
                                <label for="pushoverTitlePreset" class="block text-sm font-medium text-gray-700 mb-1">Titel (Vorlage)</label>
                                <select id="pushoverTitlePreset"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-5900 bg-white">
                                    <option value="" disabled selected>Bitte warten...</option>
                                </select>
                            </div>

                            <div>
                                <label for="pushoverTitle" class="block text-sm font-medium text-gray-700 mb-1">Titel</label>
                                <input type="text" id="pushoverTitle" placeholder="Ihr Betreff..."
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    value="">
                            </div>
                        </div>

                        <div class="mb-4 p-3 rounded-lg border border-gray-200 bg-gray-50 space-y-3">
                            <div>
                                <label for="pushoverMessagePreset" class="block text-sm font-medium text-gray-700 mb-1">Nachricht (Vorlage)</label>
                                <select id="pushoverMessagePreset"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-5900 bg-white">
                                    <option value="" disabled selected>Bitte warten...</option>
                                </select>
                            </div>

                            <div>
                                <label for="pushoverMessage" class="block text-sm font-medium text-gray-700 mb-1">Nachricht</label>
                                <textarea id="pushoverMessage" rows="3"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Ihre Nachricht..."></textarea>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="pushoverPriority" class="block text-sm font-medium text-gray-700 mb-1">Priorität</label>
                            <select id="pushoverPriority"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-5900 bg-white">
                                <option value="-2">-2 (Ganz leise)</option>
                                <option value="-1">-1 (Leise)</option>
                                <option value="0" selected>0 (Normal)</option>
                                <option value="1">1 (Hoch)</option>
                                <option value="2">2 (Notfall / Wiederholen)</option>
                            </select>
                            <div class="text-xs text-gray-500 mt-1">-2/-1: weniger wichtig, 0: normal, 1: wichtiger, 2: Notfall (wiederholt bis bestätigt).</div>
                        </div>

                        <div id="pushoverEmergencyOptions" class="hidden mb-6">
                            <div class="p-3 rounded-lg bg-gray-50 border border-gray-200">
                                <div class="text-sm font-semibold text-gray-800 mb-2">Notfall-Einstellungen (nur bei Priorität 2)</div>

                                <div class="mb-3">
                                    <label for="pushoverRetryPreset" class="block text-sm font-medium text-gray-700 mb-1">Wiederholen alle (Sekunden)</label>
                                    <select id="pushoverRetryPreset"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-5900 bg-white">
                                        <option value="" disabled selected>Bitte warten...</option>
                                    </select>
                                    <input type="number" id="pushoverRetry" min="30" max="10800" value="60"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 mt-2"
                                        placeholder="z.B. 60">
                                    <div class="text-xs text-gray-500 mt-1">Mindestens 30 Sekunden.</div>
                                </div>

                                <div>
                                    <label for="pushoverExpirePreset" class="block text-sm font-medium text-gray-700 mb-1">Max. Dauer (Sekunden)</label>
                                    <select id="pushoverExpirePreset"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-5900 bg-white">
                                        <option value="" disabled selected>Bitte warten...</option>
                                    </select>
                                    <input type="number" id="pushoverExpire" min="30" max="10800" value="3600"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 mt-2"
                                        placeholder="z.B. 3600">
                                    <div class="text-xs text-gray-500 mt-1">Mindestens 30 Sekunden, maximal 10800 Sekunden.</div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-2">
                            <button id="sendDynamicPostButton"
                                class="w-full py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition duration-200 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                                <span class="button-text">Nachricht senden</span>
                                <div class="loading-spinner"></div>
                            </button>

                            <button id="clearPushoverFormButton"
                                class="w-full py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-300 transition duration-200">
                                Formular leeren
                            </button>
                        </div>
                        </div>
                    </div>
                </div>

                <div id="pushoverSettingsSection" class="hidden space-y-4">
                    <h2 class="text-2xl font-bold text-gray-800">Einstellungen</h2>

                    <div id="pushoverSettingsStatus" class="hidden p-3 rounded-lg bg-gray-100 border border-gray-200 text-sm text-gray-700"></div>

                    <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-red-500 space-y-4">
                        <div class="text-sm font-semibold text-gray-800">Berechtigungen pro Person (wer darf was an dich senden)</div>

                        <div id="pushoverGrantTilesArea">
                            <div id="pushoverSenderGrantTiles" class="grid grid-cols-2 gap-2"></div>
                        </div>

                        <div id="pushoverGrantEditor" class="hidden space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="text-sm font-semibold text-gray-800">Rechte bearbeiten</div>
                                <button id="closePushoverGrantEditorButton" type="button"
                                    class="px-3 py-1 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition">
                                    X
                                </button>
                            </div>

                            <div>
                                <label for="pushoverGrantSenderSelect" class="block text-sm font-medium text-gray-700 mb-1">Person</label>
                                <select id="pushoverGrantSenderSelect"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-5900 bg-white">
                                    <option value="" disabled selected>Bitte wählen...</option>
                                </select>
                            </div>

                            <div>
                                <label for="pushoverGrantAllowedTitles" class="block text-sm font-medium text-gray-700 mb-1">Erlaubte Titel (eine Zeile pro Titel)</label>
                                <textarea id="pushoverGrantAllowedTitles" rows="4"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Wichtig: TOP 2 Meldung\nInfo"></textarea>
                                <label class="flex items-center gap-2 text-sm text-gray-700 mt-2">
                                    <input type="checkbox" id="pushoverGrantAllowTitleFreeText" class="h-4 w-4">
                                    Freitext beim Titel erlauben
                                </label>
                            </div>

                            <div>
                                <label for="pushoverGrantAllowedMessages" class="block text-sm font-medium text-gray-700 mb-1">Erlaubte Nachrichten (eine Zeile pro Nachricht)</label>
                                <textarea id="pushoverGrantAllowedMessages" rows="5"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Hallo\nTest"></textarea>
                                <label class="flex items-center gap-2 text-sm text-gray-700 mt-2">
                                    <input type="checkbox" id="pushoverGrantAllowMessageFreeText" class="h-4 w-4">
                                    Freitext bei der Nachricht erlauben
                                </label>
                            </div>

                            <div>
                                <div class="text-sm font-semibold text-gray-800 mb-2">Erlaubte Priorität</div>
                                <div class="grid grid-cols-2 gap-2 text-sm text-gray-700">
                                    <label class="flex items-center gap-2"><input type="checkbox" id="pushoverGrantPriorityMinus2" class="h-4 w-4"> -2 (Ganz leise)</label>
                                    <label class="flex items-center gap-2"><input type="checkbox" id="pushoverGrantPriorityMinus1" class="h-4 w-4"> -1 (Leise)</label>
                                    <label class="flex items-center gap-2"><input type="checkbox" id="pushoverGrantPriority0" class="h-4 w-4" checked> 0 (Normal)</label>
                                    <label class="flex items-center gap-2"><input type="checkbox" id="pushoverGrantPriority1" class="h-4 w-4"> 1 (Hoch)</label>
                                    <label class="flex items-center gap-2"><input type="checkbox" id="pushoverGrantPriority2" class="h-4 w-4"> 2 (Notfall / Wiederholen)</label>
                                </div>
                                <div class="mt-3">
                                    <label for="pushoverGrantDefaultPriority" class="block text-sm font-medium text-gray-700 mb-1">Standard-Priorität</label>
                                    <select id="pushoverGrantDefaultPriority"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-5900 bg-white">
                                        <option value="-2">-2</option>
                                        <option value="-1">-1</option>
                                        <option value="0" selected>0</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <div class="text-sm font-semibold text-gray-800">Notfall (Priorität 2)</div>
                                <div class="text-xs text-gray-500">Eine Zahl pro Zeile (Sekunden). Mindestwert: 30. Max: 10800. Wenn du Presets einträgst, darf der Sender nur diese Werte nutzen.</div>

                                <div class="mt-3">
                                    <label for="pushoverGrantRetryPresets" class="block text-sm font-medium text-gray-700 mb-1">retry-Vorlagen (Wiederholen alle)</label>
                                    <textarea id="pushoverGrantRetryPresets" rows="3"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                        placeholder="30\n60\n120\n300"></textarea>
                                </div>

                                <div class="mt-3">
                                    <label for="pushoverGrantExpirePresets" class="block text-sm font-medium text-gray-700 mb-1">expire-Vorlagen (Max. Dauer)</label>
                                    <textarea id="pushoverGrantExpirePresets" rows="3"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                        placeholder="600\n1800\n3600\n7200"></textarea>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-2">
                                <button id="savePushoverSenderGrantButton"
                                    class="w-full py-3 bg-emerald-600 text-white font-semibold rounded-lg shadow-md hover:bg-emerald-700 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                                    Berechtigung speichern
                                </button>
                                <button id="deletePushoverSenderGrantButton" type="button"
                                    class="w-full py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition duration-200">
                                    Berechtigung löschen
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div id="pushmailCenterView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <h2 class="text-2xl font-bold text-gray-800 mb-4">PUSHMAIL-Center</h2>

                <div class="text-sm text-gray-600 mb-4">Zentrale Nachrichtenstelle für aktive Alarme aus diversen Programmen per Pushover an eigene Geräte.</div>

                <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-red-600">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-gray-800">Ausstehende Benachrichtigungen</h3>
                        <span id="pendingNotificationsCount" class="px-3 py-1 bg-red-600 text-white font-bold rounded-full text-sm">0</span>
                    </div>
                    
                    <div id="pushmailPendingNotificationsList" class="space-y-2">
                        <p class="text-sm text-gray-400 text-center py-4">Keine ausstehenden Benachrichtigungen</p>
                    </div>
                </div>

                <div id="pushmailPushoverSettingsCard" class="card bg-white rounded-xl shadow-lg border-t-4 border-fuchsia-600">
                    <div id="pushmailPushoverSettingsHeader" class="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50 transition rounded-t-xl">
                        <h3 class="text-lg font-bold text-gray-800">Pushover - Einstellungen</h3>
                        <svg id="pushmailPushoverSettingsChevron" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>

                    <div id="pushmailPushoverSettingsContent" class="p-4 pt-0 space-y-4">
                        <div>
                            <div class="text-sm text-gray-600">Hier verwaltest du zentral deine Benachrichtigungen und Kontakte.</div>
                            <div id="pushmailPushoverStatus" class="text-sm font-semibold text-gray-800 hidden"></div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div class="p-3 border rounded-lg bg-gray-50">
                                <div class="text-xs font-semibold text-gray-700">Pushover API Token</div>
                                <div id="pushmailPushoverApiTokenPreview" class="text-xs text-gray-500 font-mono mt-1">—</div>
                            </div>
                            <div class="p-3 border rounded-lg bg-gray-50">
                                <div class="text-xs font-semibold text-gray-700">Dein Pushover User-Key</div>
                                <div id="pushmailPushoverUserKeyPreview" class="text-xs text-gray-500 font-mono mt-1">—</div>
                            </div>
                        </div>

                        <div class="p-4 border rounded-xl bg-blue-50 space-y-2">
                            <div class="text-sm font-semibold text-blue-800">User-Key setzen / ändern</div>
                            <input type="password" id="pushmailPushoverUserKeyInput" class="w-full p-2 border rounded-lg"
                                placeholder="User-Key eingeben (wird nicht angezeigt)">
                            <div class="flex gap-2">
                                <button id="pushmailSavePushoverUserKeyButton"
                                    class="flex-1 py-2 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 transition">User-Key speichern</button>
                                <button id="pushmailRequestUserKeyChangeButton"
                                    class="flex-1 py-2 bg-orange-600 text-white text-sm font-semibold rounded-lg hover:bg-orange-700 transition hidden">Änderung beantragen</button>
                            </div>
                        </div>

                        <div class="border-t pt-3">
                            <div class="text-sm text-gray-600 mb-2">Adressbuch und Tokens werden aus den bestehenden Bereichen genutzt. Keys werden nur maskiert angezeigt.</div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                <button id="pushmailOpenNachrichtencenterContactBookButton"
                                    class="w-full py-2 bg-emerald-600 text-white text-sm font-semibold rounded-lg hover:bg-emerald-700 transition">Kontaktbuch öffnen (GLOBAL/Privat)</button>
                                <button id="pushmailOpenApiTokenBookButton"
                                    class="w-full py-2 bg-indigo-600 text-white text-sm font-semibold rounded-lg hover:bg-indigo-700 transition">API-Tokens verwalten</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-fuchsia-600 space-y-4">
                    <div class="flex items-start justify-between gap-3">
                        <div>
                            <div class="text-sm font-semibold text-gray-800">Programme & Automatische Benachrichtigungen</div>
                            <div class="text-sm text-gray-600">Programme verwalten und automatische Benachrichtigungen konfigurieren.</div>
                            <div id="pushmailAutoSettingsStatus" class="text-sm font-semibold text-gray-800 hidden"></div>
                        </div>
                        <div class="flex flex-col gap-2">
                            <button id="pushmailAutoResetButton"
                                class="py-2 px-3 bg-gray-100 text-gray-700 text-sm font-semibold rounded-lg hover:bg-gray-200 transition">
                                Standard
                            </button>
                            <button id="pushmailAutoSaveButton"
                                class="py-2 px-3 bg-fuchsia-600 text-white text-sm font-semibold rounded-lg hover:bg-fuchsia-700 transition">
                                Speichern
                            </button>
                        </div>
                    </div>

                    <div class="flex items-center justify-between p-3 rounded-lg bg-gray-50 border border-gray-200">
                        <span class="text-sm font-semibold text-gray-700">Global</span>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="pushmailAutoGlobalEnabled" class="h-4 w-4">
                            <span class="text-sm text-gray-700">AN</span>
                        </label>
                    </div>

                    <div id="pushmailAutoProgramsContainer" class="space-y-3">
                        <p class="text-sm text-center text-gray-400">Lade Einstellungen...</p>
                    </div>
                </div>
            </div>

            <div id="essensberechnungView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Essensberechnung</h2>

                <div class="mb-4 text-right">
                    <button id="new-meal-btn"
                        class="py-2 px-4 bg-red-600 text-white text-sm font-semibold rounded-lg hover:bg-red-700 transition shadow-md flex items-center gap-2 ml-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                            <path fill-rule="evenodd"
                                d="M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.58.22-2.365.468a.75.75 0 1 0 .23 1.482l.149-.022.841 10.518A2.75 2.75 0 0 0 7.596 19h4.807a2.75 2.75 0 0 0 2.742-2.53l.841-10.52.149.023a.75.75 0 0 0 .23-1.482A41.03 41.03 0 0 0 14 4.193v-.443A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 0 0-1.5.06l.3 7.5a.75.75 0 1 0 1.5-.06l-.3-7.5Zm4.34.06a.75.75 0 1 0-1.5-.06l-.3 7.5a.75.75 0 1 0 1.5.06l.3-7.5Z"
                                clip-rule="evenodd" />
                        </svg>
                        Neue Mahlzeit (Alles löschen)
                    </button>
                </div>


                <div id="meal-composition-area" class="space-y-4">

                    <div class="card bg-white p-4 rounded-xl shadow-lg">
                        <label for="meal-name" class="block text-sm font-medium text-gray-700 mb-1">Name der
                            Mahlzeit</label>
                        <input type="text" id="meal-name" placeholder="z.B. Mittagessen Montag"
                            class="w-full p-2 border rounded-lg">
                    </div>

                    <div class="card bg-white p-4 rounded-xl shadow-lg">
                        <h3 class="font-bold text-gray-800 mb-2">Einzelne Produkte</h3>
                        <div class="flex gap-2">
                            <input type="text" id="single-product-name" class="flex-grow p-2 border rounded-lg"
                                placeholder="Produkt (z.B. Hähnchen)">
                            <input type="number" id="single-product-weight" class="w-24 p-2 border rounded-lg"
                                placeholder="Gewicht (g)">
                            <button id="add-single-product-btn"
                                class="py-2 px-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">+</button>
                        </div>
                        <div id="single-products-list" class="mt-3 space-y-1"></div>
                    </div>

                    <div class="card bg-white p-4 rounded-xl shadow-lg">
                        <h3 class="font-bold text-gray-800 mb-2">Rezepte</h3>
                        <div id="recipes-area" class="space-y-3">
                        </div>
                        <button id="add-recipe-btn"
                            class="w-full mt-3 py-2 text-sm text-blue-600 font-semibold hover:underline">+ Neues Rezept
                            hinzufügen</button>
                    </div>
                </div>

                <div id="portion-definition-form"
                    class="card bg-gray-50 p-4 rounded-xl space-y-4 transition-colors duration-300">
                    <h3 class="font-bold text-gray-800 mb-2">1. Portion definieren</h3>

                    <div class="p-3 border bg-white rounded-lg space-y-3">
                        <div class="flex items-center gap-2">
                            <select id="person-select" class="flex-grow p-2 border rounded-lg bg-white"></select>
                            <button id="rest-mode-btn"
                                class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition flex-shrink-0">Rest</button>
                        </div>
                        <input type="text" id="portion-name" class="w-full p-2 border rounded-lg"
                            placeholder="Name der Portion (z.B. Mittwoch)">

                        <div id="product-weights-for-person" class="space-y-2 pt-2 border-t">
                        </div>

                        <div id="recipe-weights-for-person" class="space-y-2 pt-2 border-t">
                        </div>

                        <div id="product-weights-for-person" class="space-y-2 pt-2 border-t">
                        </div>

                        <div class="flex items-center gap-2 pt-2 border-t">
                            <label for="portion-anzahl" class="text-sm font-semibold text-gray-700">Anzahl:</label>
                            <input type="number" id="portion-anzahl" class="w-24 p-2 border rounded-lg" value="1"
                                min="1">
                        </div>
                    </div>

                    <button id="add-portion-definition-btn"
                        class="w-full py-2 px-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700">
                        + Portion hinzufügen
                    </button>
                    <div class="flex gap-2">
                        <button id="update-portion-definition-btn"
                            class="w-full py-2 px-3 bg-yellow-500 text-black font-semibold rounded-lg hover:bg-yellow-600 hidden">
                            Änderung übernehmen
                        </button>
                        <button id="delete-portion-definition-btn"
                            class="w-full py-2 px-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 hidden">
                            Portion löschen
                        </button>
                    </div>
                </div>

                <div class="card bg-white p-4 rounded-xl shadow-lg">
                    <h3 class="font-bold text-gray-800 mb-2">2. Definierte Portionen</h3>
                    <div id="distribution-list" class="space-y-2">
                        <p class="text-sm text-center text-gray-400">Noch keine Portionen definiert.</p>
                    </div>
                </div>

                <div class="card bg-gray-50 p-4 rounded-xl mt-4">
                    <h3 class="font-bold text-gray-800 mb-2">3. Berechnung starten</h3>
                    <button id="run-calculation-btn"
                        class="w-full py-3 px-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700">
                        Finale Aufteilung berechnen
                    </button>
                </div>
                <div id="calculation-results-area" class="mt-6 pt-6 border-t-2 border-gray-200">
                    <h2 class="text-xl font-bold text-gray-700">Berechnungsergebnis</h2>

                    <div id="calculation-view-switcher" class="flex flex-wrap gap-2 my-4 p-2 bg-gray-100 rounded-lg">
                    </div>

                    <div id="results-table" class="mt-2">
                        <p class="text-sm text-gray-500 text-center">Bitte eine Ansicht (Gesamt, Rest oder eine Portion)
                            auswählen, um das Ergebnis anzuzeigen.</p>
                    </div>
                </div>
            </div>

            <div id="toolsView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <h2 class="text-2xl font-bold text-gray-800 mb-2">Tools</h2>
                <p class="text-sm text-gray-500 mb-4">Schnellzugriff auf Mini-Apps</p>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                    <button id="maKarteToolCard"
                        class="card relative h-28 p-0 rounded-xl border-2 border-slate-300 overflow-hidden transition text-left shadow-sm hover:shadow-lg">
                        <img src="assets/ma-karte/rewe-mitarbeiterkarte.svg" alt="REWE Mitarbeiterkarte"
                            class="absolute inset-0 h-full w-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-r from-slate-900/75 via-slate-700/45 to-slate-600/20"></div>
                        <div class="relative z-10 h-full p-4 flex flex-col justify-between">
                            <span class="text-xs font-bold uppercase tracking-wide text-white/90">Tool</span>
                            <span class="text-lg font-black text-white">MA-Karte</span>
                        </div>
                    </button>

                    <div class="card h-28 p-4 rounded-xl border border-gray-200 bg-gray-50 text-gray-400 flex items-end">Reserviert</div>
                    <div class="card h-28 p-4 rounded-xl border border-gray-200 bg-gray-50 text-gray-400 flex items-end">Reserviert</div>
                    <div class="card h-28 p-4 rounded-xl border border-gray-200 bg-gray-50 text-gray-400 flex items-end">Reserviert</div>
                    <div class="card h-28 p-4 rounded-xl border border-gray-200 bg-gray-50 text-gray-400 flex items-end">Reserviert</div>
                    <div class="card h-28 p-4 rounded-xl border border-gray-200 bg-gray-50 text-gray-400 flex items-end">Reserviert</div>
                    <div class="card h-28 p-4 rounded-xl border border-gray-200 bg-gray-50 text-gray-400 flex items-end">Reserviert</div>
                    <div class="card h-28 p-4 rounded-xl border border-gray-200 bg-gray-50 text-gray-400 flex items-end">Reserviert</div>
                    <div class="card h-28 p-4 rounded-xl border border-gray-200 bg-gray-50 text-gray-400 flex items-end">Reserviert</div>
                    <div class="card h-28 p-4 rounded-xl border border-gray-200 bg-gray-50 text-gray-400 flex items-end">Reserviert</div>
                    <div class="card h-28 p-4 rounded-xl border border-gray-200 bg-gray-50 text-gray-400 flex items-end">Reserviert</div>
                    <div class="card h-28 p-4 rounded-xl border border-gray-200 bg-gray-50 text-gray-400 flex items-end">Reserviert</div>
                </div>
            </div>

            <div id="maKarteView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="tools">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <div class="relative rounded-2xl border border-slate-200 overflow-hidden mb-4 shadow-sm">
                    <img src="assets/ma-karte/rewe-mitarbeiterkarte.svg" alt="REWE Mitarbeiterkarte"
                        class="absolute inset-0 h-full w-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-r from-slate-900/70 via-slate-800/40 to-slate-700/20"></div>
                    <div class="relative z-10 p-4">
                        <div class="inline-block rounded-xl bg-black/35 px-4 py-3 shadow-md backdrop-blur-[1px]">
                            <h2 class="text-2xl font-black text-white tracking-tight">REWE Mitarbeiterkarte</h2>
                            <p class="text-sm text-slate-100 mt-1">Schneller Live-Status für Markus- und Jasmin-Karte (BILLA/BILLA PLUS, PENNY, BIPA).</p>
                        </div>
                    </div>
                </div>

                <div id="maKarteAppRoot" class="space-y-4">
                    <div class="rounded-xl border border-gray-200 bg-white p-4 text-sm text-gray-500">Lade Mitarbeiterkarten...</div>
                </div>
            </div>


            <div id="notrufSettingsView" class="view">
                <div class="back-link-container w-full mb-2">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <div class="mb-6">
                    <div id="notruf-settings-tabs" class="grid grid-cols-3 gap-1 border rounded-lg bg-gray-100 p-1">
                        <button data-target-card="card-flic-notruf"
                            class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600">
                            Flic-Notruf-Button
                        </button>
                        <button data-target-card="card-nachrichtencenter" class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600">
                            Nachrichtencenter
                        </button>
                        <button data-target-card="card-app-notruf"
                            class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600">
                            Alarm-Programme
                        </button>
                    </div>
                </div>

                <div id="notruf-prompt" class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-lg">
                    <p class="font-bold">Bitte wählen Sie oben einen Menüpunkt aus, um die Einstellungen zu bearbeiten.
                    </p>
                </div>

                <div id="card-flic-notruf" class="notruf-settings-card hidden space-y-6">

                    <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-indigo-500 mb-6">
                        <div class="flex justify-between items-center mb-4 pb-3 border-b">
                            <h2 class="text-xl font-bold text-gray-800">Flic-Button Klick-Zuweisungen</h2>
                            <button id="notrufOpenModeEditor"
                                class="py-1 px-3 bg-blue-100 text-blue-600 text-sm font-semibold rounded-lg hover:bg-blue-200 transition">
                                Modi Verwalten
                            </button>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div data-klick-typ="einfach"
                                class="flic-column-block p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:border-indigo-300 transition-all duration-200">
                                <h4 class="text-sm font-bold text-gray-800 mb-2 border-b pb-1">Klick: EINFACH</h4>
                                <span class="text-xs font-semibold text-gray-500">Aktueller Modus:</span>
                                <span id="flicDisplayModeName-einfach"
                                    class="text-lg font-semibold text-indigo-700 block break-words"
                                    title="Kein Modus">Kein Modus</span>
                                <span id="flicDisplayModeDesc-einfach" class="text-xs text-gray-600 mt-1 block"></span>
                            </div>

                            <div data-klick-typ="doppel"
                                class="flic-column-block p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:border-indigo-300 transition-all duration-200">
                                <h4 class="text-sm font-bold text-gray-800 mb-2 border-b pb-1">Klick: DOPPEL</h4>
                                <span class="text-xs font-semibold text-gray-500">Aktueller Modus:</span>
                                <span id="flicDisplayModeName-doppel"
                                    class="text-lg font-semibold text-indigo-700 block break-words"
                                    title="Kein Modus">Kein Modus</span>
                                <span id="flicDisplayModeDesc-doppel" class="text-xs text-gray-600 mt-1 block"></span>
                            </div>

                            <div data-klick-typ="halten"
                                class="flic-column-block p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:border-indigo-300 transition-all duration-200">
                                <h4 class="text-sm font-bold text-gray-800 mb-2 border-b pb-1">Klick: HOLD</h4>
                                <span class="text-xs font-semibold text-gray-500">Aktueller Modus:</span>
                                <span id="flicDisplayModeName-halten"
                                    class="text-lg font-semibold text-indigo-700 block break-words"
                                    title="Kein Modus">Kein Modus</span>
                                <span id="flicDisplayModeDesc-halten" class="text-xs text-gray-600 mt-1 block"></span>
                            </div>
                        </div>
                    </div>

                    <div id="flic-details-editor-container" class="hidden mt-4 space-y-3">
                        <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-indigo-500">
                            <h3 id="flic-editor-title" class="text-lg font-bold text-gray-800 mb-3">Modus ändern</h3>

                            <select id="flic-editor-selector"
                                class="flic-assignment-selector w-full p-2 border rounded-lg bg-white">
                            </select>

                            <div id="flic-editor-details"
                                class="bg-blue-50 text-blue-900 text-xs p-3 rounded mt-3 min-h-[60px]">
                            </div>
                        </div>

                        <button id="saveFlicAssignmentsBtn"
                            class="w-full py-2 px-4 bg-green-600 text-white font-bold rounded-lg shadow-md hover:bg-green-700 transition flex items-center justify-center gap-2">
                            Zuweisungen Speichern
                            <div class="loading-spinner"></div>
                        </button>
                    </div>
                    <div id="modeEditorArea" class="hidden space-y-6">
                        <div class="flex justify-between items-center">
                            <h2 class="text-2xl font-bold text-gray-800">Flic-Button Notrufmodus Verwalten</h2>
                            <button id="notrufCloseModeEditor"
                                class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                        </div>
                        <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-gray-300">
                            <h3 class="font-bold text-gray-800 mb-3">Vorhandene Modi</h3>
                            <div id="existingModesList" class="space-y-2 mb-4 max-h-48 overflow-y-auto">
                            </div>
                            <button id="notrufAddNewModeButton"
                                class="w-full py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition">
                                + Neuen Modus anlegen
                            </button>
                        </div>

                        <div id="modeConfigFormContainer" class="hidden">
                            <h3 id="modeConfigFormTitle" class="text-xl font-bold text-gray-800 mb-4">Modus
                                Konfigurieren</h3>
                            <div id="notrufConfigArea"
                                class="bg-white rounded-xl shadow-lg p-4 flex flex-col gap-4 border-t-4 border-orange-500">
                                <input type="hidden" id="editingModeId">

                                <div>
                                    <label for="notrufModeTitle"
                                        class="block text-sm font-medium text-gray-700 mb-1">Titel des Modus</label>
                                    <input type="text" id="notrufModeTitle" class="w-full p-2 border rounded-lg"
                                        placeholder="z.B. Standard Notruf">
                                </div>
                                <div>
                                    <label for="notrufModeDescInput"
                                        class="block text-sm font-medium text-gray-700 mb-1">Kurzbeschreibung (für
                                        Flic-Button Übersicht)</label>
                                    <input type="text" id="notrufModeDescInput" class="w-full p-2 border rounded-lg"
                                        placeholder="z.B. Sendet an alle Kontakte">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">API-Token</label>
                                    <div class="flex gap-2 items-center">
                                        <div id="notrufApiTokenDisplay"
                                            class="flex-grow p-2 border rounded-lg bg-gray-100 min-h-[40px] text-sm text-gray-600 flex flex-wrap gap-1 items-center">
                                            <span class="text-gray-400 italic">Kein Token ausgewählt</span>
                                        </div>
                                        <button id="notrufOpenApiTokenBook"
                                            class="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition"
                                            title="API-Token auswählen/verwalten">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor" class="w-5 h-5">
                                                <path fill-rule="evenodd"
                                                    d="M11.986 4.31a3.75 3.75 0 0 0-7.344 1.294.75.75 0 0 1-1.48-.216A5.25 5.25 0 0 1 12.23 3.07a.75.75 0 0 1-.244 1.24Zm-1.46-1.54a.75.75 0 0 1 1.054-.09l3 2.5a.75.75 0 1 1-.968 1.148l-3-2.5a.75.75 0 0 1-.086-1.058ZM6 9a.75.75 0 0 1 .75-.75h1.59l1.11-2.22a.75.75 0 1 1 1.34.67l-1.1 2.2h.11A3.75 3.75 0 0 1 13 12.75V15a.75.75 0 0 1-1.5 0v-2.25a2.25 2.25 0 0 0-2.25-2.25H7.5A.75.75 0 0 1 6 9.75v-.75Zm7.78 6.09a.75.75 0 0 0-1.06-.08l-3 2.5a.75.75 0 1 0 .96 1.16l3-2.5a.75.75 0 0 0 .1-.98Zm1.22-.99-.002-.002A5.25 5.25 0 0 0 7.77 16.93a.75.75 0 1 0 .245 1.478A6.75 6.75 0 0 1 17.5 10.5a.75.75 0 0 0-1.5 0c0 .98-.198 1.906-.55 2.72l.001.002a.75.75 0 0 0 1.05 1.05Z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">User Key
                                        (Empfänger)</label>
                                    <div class="flex gap-2 items-center">
                                        <div id="notrufUserKeyDisplay"
                                            class="flex-grow p-2 border rounded-lg bg-gray-100 min-h-[40px] text-sm text-gray-600 flex flex-wrap gap-1">
                                        </div>
                                        <button id="notrufOpenContactBook"
                                            class="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition"
                                            title="Kontaktbuch öffnen">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor" class="w-5 h-5">
                                                <path
                                                    d="M3 4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H3Zm2 2h10v1a.75.75 0 0 1-1.5 0V6H6v.75a.75.75 0 0 1-1.5 0V6Zm11 6a.75.75 0 0 1-.75.75H4.75a.75.75 0 0 1 0-1.5h10.5a.75.75 0 0 1 .75.75Z" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <label for="notrufTitle" class="block text-sm font-medium text-gray-700 mb-1">Titel
                                        der Benachrichtigung</label>
                                    <input type="text" id="notrufTitle" class="w-full p-2 border rounded-lg"
                                        placeholder="z.B. Notfall bei Oma">
                                </div>

                                <div>
                                    <label for="notrufMessage"
                                        class="block text-sm font-medium text-gray-700 mb-1">Nachricht</label>
                                    <textarea id="notrufMessage" rows="3"
                                        class="w-full p-2 border rounded-lg"></textarea>
                                </div>

                                <div class="pt-3 border-t">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Sound</label>
                                    <div class="flex gap-2 items-center">
                                        <div id="notrufSoundDisplay"
                                            class="flex-grow p-2 border rounded-lg bg-gray-100 min-h-[40px] text-sm text-gray-600 flex flex-wrap gap-1 items-center">
                                            <span class="text-gray-400 italic">Standard (pushover)</span>
                                        </div>
                                        <button id="notrufOpenSoundBook"
                                            class="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition"
                                            title="Sound auswählen/verwalten">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor" class="w-5 h-5">
                                                <path
                                                    d="M12.016 4.39a.75.75 0 0 0-1.182.046l-4 6a.75.75 0 0 0 .586 1.137h1.498V13a.75.75 0 0 0 1.5 0v-1.427h1.498a.75.75 0 0 0 .586-1.137l-4-6ZM6.25 7.5A.75.75 0 0 1 7 8.25v3a.75.75 0 0 1-1.5 0v-3A.75.75 0 0 1 6.25 7.5Zm7.5 0a.75.75 0 0 1 .75.75v3a.75.75 0 0 1-1.5 0v-3a.75.75 0 0 1 .75-.75Z" />
                                                <path fill-rule="evenodd"
                                                    d="M10 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16ZM9 1a9 9 0 0 0-9 9 9 9 0 0 0 9 9 9 9 0 0 0 9-9 9 9 0 0 0-9-9Z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <div class="pt-3 border-t">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Priorität</label>
                                    <div id="priority-buttons-container"
                                        class="grid grid-cols-5 gap-1 p-1 bg-gray-100 rounded-lg">
                                        <button data-priority="-2"
                                            class="priority-btn p-2 text-xs font-semibold rounded-md text-gray-600 hover:bg-gray-200">
                                            -2<br><span class="font-normal">(Leise)</span>
                                        </button>
                                        <button data-priority="-1"
                                            class="priority-btn p-2 text-xs font-semibold rounded-md text-gray-600 hover:bg-gray-200">
                                            -1<br><span class="font-normal">(Wenig)</span>
                                        </button>
                                        <button data-priority="0"
                                            class="priority-btn p-2 text-xs font-semibold rounded-md text-gray-600 hover:bg-gray-200">
                                            0<br><span class="font-normal">(Normal)</span>
                                        </button>
                                        <button data-priority="1"
                                            class="priority-btn p-2 text-xs font-semibold rounded-md text-gray-600 hover:bg-gray-200">
                                            1<br><span class="font-normal">(Hoch)</span>
                                        </button>
                                        <button data-priority="2"
                                            class="priority-btn p-2 text-xs font-semibold rounded-md text-gray-600 hover:bg-gray-200">
                                            2<br><span class="font-normal">(Notfall)</span>
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Notfall (-2) erfordert Retry/Expire.</p>
                                </div>

                                <div class="pt-3 border-t">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Wiederholungsintervall
                                        (Retry - für Notfall-Prio)</label>
                                    <div class="flex items-center gap-3 mb-2">
                                        <input type="checkbox" id="retryDeaktiviert" class="h-4 w-4">
                                        <label for="retryDeaktiviert" class="text-sm">Deaktiviert</label>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <input type="number" id="retrySecondsInput" min="30" max="10800" step="1"
                                            value="30"
                                            class="w-24 p-2 border rounded-lg text-sm focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed">
                                        <span class="text-sm text-gray-600">Sekunden (Minimum: 30, Maximum:
                                            10800)</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Expire wird automatisch auf das Maximum
                                        (10800s / 3h) gesetzt.</p>
                                </div>

                                <div class="flex gap-2 mt-4">
                                    <button id="notrufCancelEditModeButton"
                                        class="w-1/2 py-3 bg-gray-300 text-black font-bold rounded-lg shadow-md hover:bg-gray-400 transition">
                                        Abbrechen
                                    </button>
                                    <button id="notrufSaveModeButton"
                                        class="w-1/2 py-3 bg-green-600 text-white font-bold rounded-lg shadow-md hover:bg-green-700 transition">
                                        Modus Speichern
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="card-nachrichtencenter" class="notruf-settings-card hidden space-y-6">
                    <h2 class="text-2xl font-bold text-gray-800">Nachricht senden</h2>

                    <div class="bg-white p-5 rounded-xl shadow-lg border border-gray-100">
                        <div class="mb-4">
                            <label for="nachrichtencenterTitle" class="block text-sm font-medium text-gray-700 mb-1">Titel</label>
                            <input type="text" id="nachrichtencenterTitle" placeholder="Info über TOP 2 APP"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div class="mb-4">
                            <label for="nachrichtencenterMessage" class="block text-sm font-medium text-gray-700 mb-1">Nachricht</label>
                            <textarea id="nachrichtencenterMessage" rows="3"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                placeholder="Ihre Nachricht..."></textarea>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Empfänger</label>
                            <div class="flex gap-2 items-center">
                                <div id="nachrichtencenterRecipientDisplay"
                                    class="flex-grow p-2 border rounded-lg bg-gray-100 min-h-[44px] text-sm text-gray-600 flex flex-wrap gap-1 items-center">
                                    <span class="text-gray-400 italic">Kein Empfänger ausgewählt</span>
                                </div>
                                <input type="hidden" id="nachrichtencenterRecipientKey">
                                <input type="hidden" id="nachrichtencenterRecipientRef">
                                <button id="nachrichtencenterOpenContactBook"
                                    class="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition"
                                    title="Kontaktbuch öffnen">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                        <path d="M3 4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H3Zm2 2h10v1a.75.75 0 0 1-1.5 0V6H6v.75a.75.75 0 0 1-1.5 0V6Zm11 6a.75.75 0 0 1-.75.75H4.75a.75.75 0 0 1 0-1.5h10.5a.75.75 0 0 1 .75.75Z" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div class="mb-4">
                            <button id="nachrichtencenterExpertToggle" type="button"
                                class="text-xs text-gray-500 hover:text-gray-700 flex items-center gap-1">
                                <span id="nachrichtencenterExpertToggleIcon" class="text-sm">▸</span>
                                <span id="nachrichtencenterExpertToggleText">Expertenmodus anzeigen</span>
                            </button>
                        </div>

                        <div id="nachrichtencenterExpertPanel" class="hidden border-t pt-4 space-y-4">
                            <div>
                                <label for="nachrichtencenterPriority" class="block text-sm font-medium text-gray-700 mb-1">Priorität</label>
                                <select id="nachrichtencenterPriority"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 bg-white">
                                    <option value="-2">-2 (Ganz leise)</option>
                                    <option value="-1">-1 (Leise)</option>
                                    <option value="0" selected>0 (Normal)</option>
                                    <option value="1">1 (Wichtiger)</option>
                                    <option value="2">2 (Notfall)</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">Notfall (2) benötigt Retry + Ablauf.</p>
                            </div>

                            <div>
                                <label for="nachrichtencenterSound" class="block text-sm font-medium text-gray-700 mb-1">Sound</label>
                                <select id="nachrichtencenterSound"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 bg-white">
                                    <option value="" selected>Standard (pushover)</option>
                                </select>
                            </div>

                            <div id="nachrichtencenterEmergencyOptions" class="hidden p-3 rounded-lg bg-gray-50 border border-gray-200 space-y-3">
                                <div class="text-sm font-semibold text-gray-800">Notfall-Einstellungen (nur Priorität 2)</div>
                                <div>
                                    <label for="nachrichtencenterRetry" class="block text-sm font-medium text-gray-700 mb-1">Reply-Timer (Retry in Sekunden)</label>
                                    <input type="number" id="nachrichtencenterRetry" min="30" max="10800" value="30"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                    <p class="text-xs text-gray-500 mt-1">Mindestens 30 Sekunden.</p>
                                </div>
                                <div>
                                    <label for="nachrichtencenterExpire" class="block text-sm font-medium text-gray-700 mb-1">Ablauf (Expire in Sekunden)</label>
                                    <input type="number" id="nachrichtencenterExpire" min="30" max="10800" value="10800"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                    <p class="text-xs text-gray-500 mt-1">Maximal 10800 Sekunden (3 Stunden).</p>
                                </div>
                            </div>
                        </div>

                        <button id="sendNachrichtencenterButton"
                            class="w-full py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition duration-200 flex items-center justify-center">
                            <span class="button-text">Nachricht senden</span>
                            <div class="loading-spinner"></div>
                        </button>
                    </div>
                </div>

                <div id="card-app-notruf" class="notruf-settings-card hidden space-y-6">
                    <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-gray-400">
                        <h2 class="text-xl font-bold text-gray-800">Alarm-Programme</h2>
                        <p class="mt-2 text-gray-600">Diese Funktion befindet sich derzeit im Aufbau.</p>
                    </div>
                </div>

            </div>

            <!-- ========== TICKET SUPPORT VIEW (PROFESSIONELL) ========== -->
            <div id="ticketSupportView" class="view">
                <div class="back-link-container w-full mb-3">
                    <div class="flex justify-between items-center">
                        <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                            data-target="home">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                stroke-linejoin="round" class="w-6 h-6 mr-1">
                                <path d="m15 18-6-6 6-6" />
                            </svg>
                            <span class="text-base font-semibold">zurück</span>
                        </button>

                        <button id="btn-create-ticket" 
                            class="py-2 px-4 bg-gradient-to-r from-purple-600 to-pink-500 text-white font-bold rounded-lg hover:shadow-lg transition flex items-center gap-2 text-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                            </svg>
                            Neu
                        </button>
                    </div>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <!-- Dashboard Statistiken - Kompakt -->
                <div class="bg-gradient-to-r from-purple-600 to-pink-500 text-white p-4 rounded-xl shadow-md mb-3">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-xl font-bold">🎫 Ticket Support</h2>
                    </div>
                    <div class="grid grid-cols-5 gap-2 text-center">
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-open">0</p>
                            <p class="text-[10px] font-semibold leading-tight">📝 Offen</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-in-progress">0</p>
                            <p class="text-[10px] font-semibold leading-tight">⚙️ In Arbeit</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-paused">0</p>
                            <p class="text-[10px] font-semibold leading-tight">⏸️ Pausiert</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-done">0</p>
                            <p class="text-[10px] font-semibold leading-tight">✅ Erledigt</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-assigned-to-me">0</p>
                            <p class="text-[10px] font-semibold leading-tight">👤 Mir</p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center mb-2">
                    <button id="ts-toggle-filter-controls"
                        class="text-gray-500 hover:text-purple-700 transition flex items-center gap-1 text-xs font-bold py-1 px-4 rounded-full hover:bg-purple-50">
                        <span>Filter & Kategorien</span>
                        <svg id="ts-toggle-filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 transform transition-transform">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- Such- und Filterleiste -->
                <div id="ts-filter-controls-wrapper" class="hidden mb-4 space-y-3">
                    <div class="filterbox-panel">
                        <div class="filter-box-title">Filterbox</div>
                        <div class="flex flex-wrap gap-2 items-center">
                            <label class="flex items-center gap-1 px-3 py-2 bg-gray-100 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-red-50 hover:border-red-300 transition select-none">
                                <input type="checkbox" id="ts-filter-negate" class="h-4 w-4 accent-red-500">
                                <span class="text-red-600 font-bold text-sm">NICHT</span>
                            </label>
                            <select id="ts-search-join-mode" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm font-bold">
                                <option value="and" selected>AND</option>
                                <option value="or">OR</option>
                            </select>
                            <div class="relative flex-1 min-w-[200px]">
                                <input type="text" id="ts-search-input"
                                    class="w-full p-2.5 border-2 border-gray-300 rounded-lg focus:border-purple-500"
                                    placeholder="🔍 Suchbegriff eingeben...">
                                <div id="ts-search-suggestions-box" class="hidden absolute z-40 top-full left-0 right-0 mt-1 bg-white border-2 border-purple-300 rounded-lg shadow-xl max-h-72 overflow-y-auto">
                                    <ul id="ts-search-suggestions-list" class="text-sm"></ul>
                                </div>
                            </div>
                            <button id="ts-add-filter-btn" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-bold text-sm">+ Filter</button>
                            <button id="ts-reset-filters-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-bold text-sm">↺ Reset</button>
                        </div>
                        <div id="ts-active-filters" class="flex flex-wrap gap-1 mt-2"></div>
                    </div>

                    <div class="kategorienbox-panel">
                        <div class="kategorien-box-title">Kategorien-Box</div>
                        <div class="grid grid-cols-1 gap-2">
                            <select id="ts-filter-status" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm">
                                <option value="">Alle Status</option>
                                <option value="open">📝 Offen</option>
                                <option value="in_progress">⚙️ In Arbeit</option>
                                <option value="paused">⏸️ Pausiert</option>
                                <option value="done">✅ Erledigt</option>
                                <option value="reopened">🔄 Wiedergeöffnet</option>
                            </select>
                        </div>
                        <div class="flex gap-2 flex-wrap">
                            <select id="ts-filter-priority" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm">
                                <option value="">Alle Prioritäten</option>
                                <option value="urgent">🔴 Dringend</option>
                                <option value="high">🟠 Hoch</option>
                                <option value="normal">🟡 Normal</option>
                                <option value="low">🟢 Niedrig</option>
                            </select>
                            <select id="ts-filter-person" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm flex-1 min-w-[180px]">
                                <option value="">Alle Personen</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Tabs (Reihenfolge: Alle Tickets, Mir zugewiesen, Meine Tickets) -->
                <div class="flex gap-2 mb-3">
                    <button id="tab-all-tickets" class="flex-1 py-2 px-3 rounded-lg font-bold transition bg-purple-600 text-white text-sm">
                        Alle Tickets
                    </button>
                    <button id="tab-assigned-to-me" class="flex-1 py-2 px-3 rounded-lg font-bold transition bg-gray-200 text-gray-700 hover:bg-gray-300 text-sm">
                        Mir zugewiesen
                    </button>
                    <button id="tab-my-tickets" class="flex-1 py-2 px-3 rounded-lg font-bold transition bg-gray-200 text-gray-700 hover:bg-gray-300 text-sm">
                        Meine Tickets
                    </button>
                </div>

                <!-- Tickets Container -->
                <div id="tickets-list" class="space-y-3">
                    <p class="text-center text-gray-400 italic py-8">Keine Tickets vorhanden.</p>
                </div>
            </div>

            <!-- ========== NOTIZEN VIEW ========== -->
            <div id="notizenView" class="view">
                <div class="back-link-container w-full mb-3">
                    <div class="flex justify-between items-center">
                        <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                            data-target="home">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                stroke-linejoin="round" class="w-6 h-6 mr-1">
                                <path d="m15 18-6-6 6-6" />
                            </svg>
                            <span class="text-base font-semibold">zurück</span>
                        </button>
                        <div class="flex items-center gap-2">
                            <button id="btn-notizen-settings" 
                                class="p-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition" title="Kategorien verwalten">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                                    <path fill-rule="evenodd" d="M11.078 2.25c-.917 0-1.699.663-1.85 1.567L9.05 4.889c-.02.12-.115.26-.297.348a7.493 7.493 0 0 0-.986.57c-.166.115-.334.126-.45.083L6.3 5.508a1.875 1.875 0 0 0-2.282.819l-.922 1.597a1.875 1.875 0 0 0 .432 2.385l.84.692c.095.078.17.229.154.43a7.598 7.598 0 0 0 0 1.139c.015.2-.059.352-.153.43l-.841.692a1.875 1.875 0 0 0-.432 2.385l.922 1.597a1.875 1.875 0 0 0 2.282.818l1.019-.382c.115-.043.283-.031.45.082.312.214.641.405.985.57.182.088.277.228.297.35l.178 1.071c.151.904.933 1.567 1.85 1.567h1.844c.916 0 1.699-.663 1.85-1.567l.178-1.072c.02-.12.114-.26.297-.349.344-.165.673-.356.985-.57.167-.114.335-.125.45-.082l1.02.382a1.875 1.875 0 0 0 2.28-.819l.923-1.597a1.875 1.875 0 0 0-.432-2.385l-.84-.692c-.095-.078-.17-.229-.154-.43a7.614 7.614 0 0 0 0-1.139c-.016-.2.059-.352.153-.43l.84-.692c.708-.582.891-1.59.433-2.385l-.922-1.597a1.875 1.875 0 0 0-2.282-.818l-1.02.382c-.114.043-.282.031-.449-.083a7.49 7.49 0 0 0-.985-.57c-.183-.087-.277-.227-.297-.348l-.179-1.072a1.875 1.875 0 0 0-1.85-1.567h-1.843ZM12 15.75a3.75 3.75 0 1 0 0-7.5 3.75 3.75 0 0 0 0 7.5Z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <button id="btn-notizen-view-mode" 
                                class="p-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition" title="Ansicht wechseln (Liste/Kachel)">
                                📋
                            </button>
                            <button id="btn-notizen-einladungen" class="relative p-2 text-gray-500 hover:text-amber-600 transition rounded-lg hover:bg-amber-50" title="Einladungen">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path d="M3 4a2 2 0 0 0-2 2v1.161l8.441 4.221a1.25 1.25 0 0 0 1.118 0L19 7.162V6a2 2 0 0 0-2-2H3Z" />
                                    <path d="m19 8.839-7.77 3.885a2.75 2.75 0 0 1-2.46 0L1 8.839V14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.839Z" />
                                </svg>
                                <span id="notizen-einladungen-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">0</span>
                            </button>
                            <button id="btn-create-notiz" 
                                class="py-2 px-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-lg hover:shadow-lg transition flex items-center gap-2 text-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                </svg>
                                Neue Notiz
                            </button>
                        </div>
                    </div>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <!-- Dashboard Statistiken -->
                <div class="bg-gradient-to-r from-amber-500 to-orange-500 text-white p-4 rounded-xl shadow-md mb-3">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-xl font-bold">📝 Notizen</h2>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center">
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-notizen-total">0</p>
                            <p class="text-[10px] font-semibold leading-tight">📝 Gesamt</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-notizen-aktiv">0</p>
                            <p class="text-[10px] font-semibold leading-tight">⭕ Aktiv</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-notizen-erinnerung">0</p>
                            <p class="text-[10px] font-semibold leading-tight">🔔 Erinnerung</p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center mb-2">
                    <button id="notizen-toggle-filter-controls"
                        class="text-gray-500 hover:text-amber-700 transition flex items-center gap-1 text-xs font-bold py-1 px-4 rounded-full hover:bg-amber-50">
                        <span>Filter & Kategorien</span>
                        <svg id="notizen-toggle-filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 transform transition-transform">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- Such- und Filterleiste -->
                <div id="notizen-filter-controls-wrapper" class="hidden mb-4 space-y-3">
                    <div class="filterbox-panel">
                        <div class="filter-box-title">Filterbox</div>
                        <div class="flex gap-2 items-center flex-wrap">
                            <label id="negate-box" class="flex items-center gap-1 px-3 py-2 bg-gray-100 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-red-50 hover:border-red-300 transition select-none">
                                <input type="checkbox" id="filter-notizen-negate" class="h-4 w-4 accent-red-500">
                                <span class="text-red-600 font-bold text-sm">NICHT</span>
                            </label>
                            <select id="notizen-search-join-mode" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm font-bold">
                                <option value="and" selected>AND</option>
                                <option value="or">OR</option>
                            </select>
                            <div class="relative flex-1 min-w-[200px]">
                                <input type="text" id="search-notizen" 
                                    class="w-full p-2.5 border-2 border-gray-300 rounded-lg focus:border-amber-500" 
                                    placeholder="🔍 Suche in Notizen...">
                                <div id="notizen-search-suggestions-box" class="hidden absolute z-40 top-full left-0 right-0 mt-1 bg-white border-2 border-amber-300 rounded-lg shadow-xl max-h-72 overflow-y-auto">
                                    <ul id="notizen-search-suggestions-list" class="text-sm"></ul>
                                </div>
                            </div>
                            <button id="btn-add-notizen-filter" onclick="window.addNotizFilter()" class="px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 font-bold">
                                + Filter
                            </button>
                            <button id="reset-filters-notizen" onclick="window.resetNotizFilters()" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-bold text-sm">
                                ↺ Zurücksetzen
                            </button>
                        </div>
                        <!-- Aktive Filter -->
                        <div id="active-filters-notizen" class="flex flex-wrap gap-1 mt-2"></div>
                    </div>

                    <div class="kategorienbox-panel">
                        <div class="kategorien-box-title">Kategorien-Box</div>
                        <div class="flex gap-2 flex-wrap">
                            <select id="filter-notizen-kategorie" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm flex-1">
                                <option value="">Alle Kategorien</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Notizen Container -->
                <div id="notizen-list" class="space-y-3">
                    <p class="text-center text-gray-400 italic py-8">Keine Notizen vorhanden.</p>
                </div>
            </div>

            <!-- ========== WERTGUTHABEN VIEW ========== -->
            <div id="wertguthabenView" class="view">
                <div class="back-link-container w-full mb-3">
                    <div class="flex justify-between items-center">
                        <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                            data-target="home">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                stroke-linejoin="round" class="w-6 h-6 mr-1">
                                <path d="m15 18-6-6 6-6" />
                            </svg>
                            <span class="text-base font-semibold">zurück</span>
                        </button>

                        <div class="flex gap-2">
                            <button id="btn-wertguthaben-settings"
                                class="p-2 text-gray-500 hover:text-gray-800 transition rounded-full hover:bg-gray-200"
                                title="Standard-Warnungen einstellen">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                                    <path fill-rule="evenodd" d="M7.84 1.804A1 1 0 0 1 8.82 1h2.36a1 1 0 0 1 .98.804l.295 1.473c.497.144.971.342 1.416.587l1.25-.834a1 1 0 0 1 1.262.125l1.669 1.669a1 1 0 0 1 .125 1.262l-.834 1.25c.245.445.443.919.587 1.416l1.473.294a1 1 0 0 1 .804.98v2.361a1 1 0 0 1-.804.98l-1.473.295a6.95 6.95 0 0 1-.587 1.416l.834 1.25a1 1 0 0 1-.125 1.262l-1.669 1.669a1 1 0 0 1-1.262.125l-1.25-.834a6.953 6.953 0 0 1-1.416.587l-.294 1.473a1 1 0 0 1-.98.804H8.82a1 1 0 0 1-.98-.804l-.295-1.473a6.957 6.957 0 0 1-1.416-.587l-1.25.834a1 1 0 0 1-1.262-.125l-1.669-1.669a1 1 0 0 1-.125-1.262l.834-1.25a6.957 6.957 0 0 1-.587-1.416l-1.473-.294A1 1 0 0 1 1 11.18V8.82a1 1 0 0 1 .804-.98l1.473-.295c.144-.497.342-.971.587-1.416l-.834-1.25a1 1 0 0 1 .125-1.262l1.669-1.669a1 1 0 0 1 1.262-.125l1.25.834c.445-.245.919-.443 1.416-.587l.294-1.473ZM13 10a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <button id="btn-create-wertguthaben" 
                                class="py-2 px-4 bg-gradient-to-r from-emerald-600 to-teal-500 text-white font-bold rounded-lg hover:shadow-lg transition flex items-center gap-2 text-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                </svg>
                                Neu
                            </button>
                        </div>
                    </div>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <!-- Header mit Statistiken -->
                <div class="bg-gradient-to-r from-emerald-600 to-teal-500 text-white p-4 rounded-xl shadow-md mb-3">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-xl font-bold">💰 Wertguthaben</h2>
                    </div>
                    <div class="grid grid-cols-4 gap-2 text-center">
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-gutscheine">0</p>
                            <p class="text-[10px] font-semibold leading-tight">🎁 Gutscheine</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-guthaben">0</p>
                            <p class="text-[10px] font-semibold leading-tight">💳 Guthaben</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-wertguthaben">0</p>
                            <p class="text-[10px] font-semibold leading-tight">🏦 Wertguthaben</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-total-wert">0€</p>
                            <p class="text-[10px] font-semibold leading-tight">💎 Gesamt</p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center mb-2">
                    <button id="wg-toggle-filter-controls"
                        class="text-gray-500 hover:text-emerald-700 transition flex items-center gap-1 text-xs font-bold py-1 px-4 rounded-full hover:bg-emerald-50">
                        <span>Filter & Kategorien</span>
                        <svg id="wg-toggle-filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 transform transition-transform">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- Such- und Filterleiste -->
                <div id="wg-filter-controls-wrapper" class="hidden mb-3 space-y-3">
                    <div class="filterbox-panel">
                        <div class="filter-box-title">Filterbox</div>
                        <div class="flex flex-wrap gap-2 items-center">
                            <label class="flex items-center gap-1 px-3 py-2 bg-white border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-red-50 hover:border-red-300 transition select-none">
                                <input type="checkbox" id="wg-filter-negate" class="h-4 w-4 accent-red-500">
                                <span class="text-red-600 font-bold text-sm">NICHT</span>
                            </label>
                            <select id="wg-search-join-mode" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm font-bold">
                                <option value="and" selected>AND</option>
                                <option value="or">OR</option>
                            </select>
                            <div class="relative flex-1 min-w-[200px]">
                                <input type="text" id="search-wertguthaben" placeholder="🔍 Suchen... (Name, Code, Unternehmen)" 
                                    class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 text-sm">
                                <div id="wg-search-suggestions-box" class="hidden absolute z-40 top-full left-0 right-0 mt-1 bg-white border-2 border-emerald-300 rounded-lg shadow-xl max-h-72 overflow-y-auto">
                                    <ul id="wg-search-suggestions-list" class="text-sm"></ul>
                                </div>
                            </div>
                            <button id="wg-add-filter-btn" class="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-bold transition text-sm">+ Filter</button>
                            <button id="reset-filters-wertguthaben" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-bold transition text-sm">
                                ↺ Reset
                            </button>
                        </div>
                        <div id="wg-active-filters" class="flex flex-wrap gap-1 mt-2"></div>
                    </div>

                    <div class="kategorienbox-panel">
                        <div class="kategorien-box-title">Kategorien-Box</div>
                        <div class="flex flex-wrap gap-2">
                            <select id="filter-wg-typ" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm">
                                <option value="">Alle Typen</option>
                                <option value="gutschein">🎁 Gutschein</option>
                                <option value="guthaben">💳 Guthaben</option>
                                <option value="wertguthaben">🏦 Wertguthaben</option>
                                <option value="wertguthaben_gesetzlich">⚖️ Wertguthaben (gesetzlich)</option>
                                <option value="aktionscode">🏷️ Aktionscode</option>
                            </select>
                            
                            <select id="filter-wg-eigentuemer" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm flex-1 min-w-[150px]">
                                <option value="">Alle Eigentümer</option>
                            </select>

                            <select id="filter-wg-status" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm">
                                <option value="">Alle Status</option>
                                <option value="aktiv" selected>✅ Aktiv</option>
                                <option value="eingeloest">🎯 Eingelöst</option>
                                <option value="abgelaufen">⏰ Abgelaufen</option>
                                <option value="storniert">❌ Storniert</option>
                                <option value="verschenkt">🎁 Verschenkt</option>
                                <option value="verloren">❓ Verloren</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Wertguthaben-Tabelle -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-emerald-50 border-b-2 border-emerald-200">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-emerald-800 uppercase">Eigentümer</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-emerald-800 uppercase">Typ</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-emerald-800 uppercase">Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-emerald-800 uppercase">Unternehmen</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-emerald-800 uppercase">Wert</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-emerald-800 uppercase">Restzeit</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-emerald-800 uppercase">Status</th>
                                    <th class="px-4 py-3 text-center text-xs font-bold text-emerald-800 uppercase">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="wertguthaben-table-body" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="8" class="px-4 py-8 text-center text-gray-400 italic">
                                        Keine Wertguthaben vorhanden. Erstelle dein erstes Guthaben!
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="lizenzenView" class="view">
                <div class="back-link-container w-full mb-3">
                    <div class="flex justify-between items-center">
                        <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                            data-target="home">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                stroke-linejoin="round" class="w-6 h-6 mr-1">
                                <path d="m15 18-6-6 6-6" />
                            </svg>
                            <span class="text-base font-semibold">zurück</span>
                        </button>

                        <div class="flex gap-2">
                            <button id="btn-lizenzen-settings"
                                class="p-2 text-gray-500 hover:text-gray-800 transition rounded-full hover:bg-gray-200"
                                title="Kategorien & Produkte verwalten">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                                    <path fill-rule="evenodd" d="M7.84 1.804A1 1 0 0 1 8.82 1h2.36a1 1 0 0 1 .98.804l.295 1.473c.497.144.971.342 1.416.587l1.25-.834a1 1 0 0 1 1.262.125l1.669 1.669a1 1 0 0 1 .125 1.262l-.834 1.25c.245.445.443.919.587 1.416l1.473.294a1 1 0 0 1 .804.98v2.361a1 1 0 0 1-.804.98l-1.473.295a6.95 6.95 0 0 1-.587 1.416l.834 1.25a1 1 0 0 1-.125 1.262l-1.669 1.669a1 1 0 0 1-1.262.125l-1.25-.834a6.953 6.953 0 0 1-1.416.587l-.294 1.473a1 1 0 0 1-.98.804H8.82a1 1 0 0 1-.98-.804l-.295-1.473a6.957 6.957 0 0 1-1.416-.587l-1.25.834a1 1 0 0 1-1.262-.125l-1.669-1.669a1 1 0 0 1-.125-1.262l.834-1.25a6.957 6.957 0 0 1-.587-1.416l-1.473-.294A1 1 0 0 1 1 11.18V8.82a1 1 0 0 1 .804-.98l1.473-.295c.144-.497.342-.971.587-1.416l-.834-1.25a1 1 0 0 1 .125-1.262l1.669-1.669a1 1 0 0 1 1.262-.125l1.25.834c.445-.245.919-.443 1.416-.587l.294-1.473ZM13 10a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <button id="btn-create-lizenz"
                                class="py-2 px-4 bg-gradient-to-r from-yellow-600 to-orange-500 text-white font-bold rounded-lg hover:shadow-lg transition flex items-center gap-2 text-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                </svg>
                                Neu
                            </button>
                        </div>
                    </div>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <div class="bg-gradient-to-r from-yellow-600 to-orange-500 text-white p-4 rounded-xl shadow-md mb-3">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-xl font-bold">🔑 Lizenzen</h2>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center">
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-lizenzen-aktiv">0</p>
                            <p class="text-[10px] font-semibold leading-tight">✅ Aktiv</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-lizenzen-bald">0</p>
                            <p class="text-[10px] font-semibold leading-tight">⏰ Bald</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-lizenzen-abgelaufen">0</p>
                            <p class="text-[10px] font-semibold leading-tight">❌ Abgelaufen</p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center mb-2">
                    <button id="liz-toggle-filter-controls"
                        class="text-gray-500 hover:text-orange-700 transition flex items-center gap-1 text-xs font-bold py-1 px-4 rounded-full hover:bg-orange-50">
                        <span>Filter & Kategorien</span>
                        <svg id="liz-toggle-filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 transform transition-transform">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <div id="liz-filter-controls-wrapper" class="hidden mb-3 space-y-3">
                    <div class="filterbox-panel">
                        <div class="filter-box-title">Filterbox</div>
                        <div class="flex flex-wrap gap-2 items-center">
                            <label class="flex items-center gap-2 px-3 py-2 bg-white border-2 border-gray-300 rounded-lg text-sm font-semibold text-gray-700">
                                <input type="checkbox" id="liz-filter-exclude" class="w-4 h-4">
                                NICHT
                            </label>

                            <select id="liz-search-join-mode" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm font-bold">
                                <option value="and" selected>AND</option>
                                <option value="or">OR</option>
                            </select>

                            <div class="relative flex-1 min-w-[200px]">
                                <input type="text" id="liz-filter-input" placeholder="🔍 Filter eingeben... (Enter)"
                                    class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 text-sm">
                                <div id="liz-search-suggestions-box" class="hidden absolute z-40 top-full left-0 right-0 mt-1 bg-white border-2 border-orange-300 rounded-lg shadow-xl max-h-72 overflow-y-auto">
                                    <ul id="liz-search-suggestions-list" class="text-sm"></ul>
                                </div>
                            </div>

                            <button id="btn-add-liz-filter" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-bold transition text-sm">
                                + Filter
                            </button>

                            <button id="reset-filters-lizenzen" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-bold transition text-sm">
                                ↺ Reset
                            </button>
                        </div>

                        <div id="active-liz-search-tags" class="flex flex-wrap gap-1 mt-2"></div>
                    </div>

                    <div class="kategorienbox-panel">
                        <div class="kategorien-box-title">Kategorien-Box</div>
                        <div class="flex flex-wrap gap-2 items-center">
                            <select id="filter-liz-status" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm">
                                <option value="">Alle Status</option>
                                <option value="aktiv" selected>✅ Aktiv</option>
                                <option value="deaktiviert">⏸️ Deaktiviert</option>
                                <option value="abgelaufen">❌ Abgelaufen</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-yellow-50 border-b-2 border-yellow-200">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-yellow-800 uppercase">Status</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-yellow-800 uppercase">Kategorie</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-yellow-800 uppercase">Restzeit</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-yellow-800 uppercase">Produkt</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-yellow-800 uppercase">Titel</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-yellow-800 uppercase">Version</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-yellow-800 uppercase">Aktiviert auf</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-yellow-800 uppercase">Ablauf</th>
                                    <th class="px-4 py-3 text-center text-xs font-bold text-yellow-800 uppercase">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="lizenzen-table-body" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="9" class="px-4 py-8 text-center text-gray-400 italic">
                                        Keine Lizenzen vorhanden. Erstelle deine erste Lizenz!
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ========== VERTRAGSVERWALTUNG VIEW ========== -->
            <div id="vertragsverwaltungView" class="view">
                <div class="back-link-container w-full mb-3">
                    <div class="flex justify-between items-center flex-wrap gap-2">
                        <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                            data-target="home">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                stroke-linejoin="round" class="w-6 h-6 mr-1">
                                <path d="m15 18-6-6 6-6" />
                            </svg>
                            <span class="text-base font-semibold">zurück</span>
                        </button>
                        
                        <!-- Thema-Dropdown -->
                        <select id="vv-thema-dropdown" class="flex-1 min-w-[150px] max-w-[300px] p-2 border-2 border-indigo-500 rounded-lg bg-white text-sm font-bold text-indigo-700 focus:ring-2 focus:ring-indigo-300">
                            <option value="">Thema wählen...</option>
                        </select>
                        
                        <div class="flex gap-2">
                            <!-- Einladungen Button mit Badge -->
                            <button id="btn-vv-einladungen" class="relative p-2 text-gray-500 hover:text-purple-600 transition rounded-full hover:bg-purple-100" title="Einladungen">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                                    <path d="M3 4a2 2 0 0 0-2 2v1.161l8.441 4.221a1.25 1.25 0 0 0 1.118 0L19 7.162V6a2 2 0 0 0-2-2H3Z" />
                                    <path d="m19 8.839-7.77 3.885a2.75 2.75 0 0 1-2.46 0L1 8.839V14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.839Z" />
                                </svg>
                                <span id="vv-einladungen-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">0</span>
                            </button>
                            <!-- Einstellungen Button -->
                            <button id="btn-vertraege-settings" class="p-2 text-gray-500 hover:text-gray-800 transition rounded-full hover:bg-gray-200" title="Themen-Einstellungen">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                                    <path fill-rule="evenodd" d="M7.84 1.804A1 1 0 0 1 8.82 1h2.36a1 1 0 0 1 .98.804l.295 1.473c.497.144.971.342 1.416.587l1.25-.834a1 1 0 0 1 1.262.125l1.669 1.669a1 1 0 0 1 .125 1.262l-.834 1.25c.245.445.443.919.587 1.416l1.473.294a1 1 0 0 1 .804.98v2.361a1 1 0 0 1-.804.98l-1.473.295a6.95 6.95 0 0 1-.587 1.416l.834 1.25a1 1 0 0 1-.125 1.262l-1.669 1.669a1 1 0 0 1-1.262.125l-1.25-.834a6.953 6.953 0 0 1-1.416.587l-.294 1.473a1 1 0 0 1-.98.804H8.82a1 1 0 0 1-.98-.804l-.295-1.473a6.957 6.957 0 0 1-1.416-.587l-1.25.834a1 1 0 0 1-1.262-.125l-1.669-1.669a1 1 0 0 1-.125-1.262l.834-1.25a6.957 6.957 0 0 1-.587-1.416l-1.473-.294A1 1 0 0 1 1 11.18V8.82a1 1 0 0 1 .804-.98l1.473-.295c.144-.497.342-.971.587-1.416l-.834-1.25a1 1 0 0 1 .125-1.262l1.669-1.669a1 1 0 0 1 1.262-.125l1.25.834c.445-.245.919-.443 1.416-.587l.294-1.473ZM13 10a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <!-- Neuer Vertrag Button -->
                            <button id="btn-create-vertrag" 
                                class="py-2 px-4 bg-gradient-to-r from-indigo-600 to-purple-500 text-white font-bold rounded-lg hover:shadow-lg transition flex items-center gap-2 text-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                </svg>
                                Neu
                            </button>
                        </div>
                    </div>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <!-- Header mit Statistiken -->
                <div class="bg-gradient-to-r from-indigo-600 to-purple-500 text-white p-4 rounded-xl shadow-md mb-3">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-xl font-bold">📋 Vertragsverwaltung</h2>
                    </div>
                    <div class="grid grid-cols-4 gap-2 text-center">
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-vertraege-aktiv">0</p>
                            <p class="text-[10px] font-semibold leading-tight">Aktive Verträge</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-monatliche-kosten">0€</p>
                            <p class="text-[10px] font-semibold leading-tight">Monatlich</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-jaehrliche-kosten">0€</p>
                            <p class="text-[10px] font-semibold leading-tight">Jährlich</p>
                        </div>
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="stat-kuendigungen-bald">0</p>
                            <p class="text-[10px] font-semibold leading-tight">Kündigungen bald</p>
                        </div>
                    </div>
                </div>

                <!-- Kündigungs-Warnungen -->
                <div id="kuendigungs-warnungen" class="hidden mb-3">
                    <!-- Wird dynamisch gefüllt -->
                </div>

                <div class="flex justify-center mb-2">
                    <button id="vv-toggle-filter-controls"
                        class="text-gray-500 hover:text-indigo-700 transition flex items-center gap-1 text-xs font-bold py-1 px-4 rounded-full hover:bg-indigo-50">
                        <span>Filter & Kategorien</span>
                        <svg id="vv-toggle-filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 transform transition-transform">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- Such- und Filterleiste -->
                <div id="vv-filter-controls-wrapper" class="hidden mb-3 space-y-3">
                    <div class="filterbox-panel">
                        <div class="filter-box-title">Filterbox</div>
                        <div class="flex flex-wrap gap-2 items-center">
                            <label class="flex items-center gap-1 px-3 py-2 bg-white border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-red-50 hover:border-red-300 transition select-none">
                                <input type="checkbox" id="vv-filter-negate" class="h-4 w-4 accent-red-500">
                                <span class="text-red-600 font-bold text-sm">NICHT</span>
                            </label>
                            <select id="vv-search-join-mode" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm font-bold">
                                <option value="and" selected>AND</option>
                                <option value="or">OR</option>
                            </select>
                            <div class="relative flex-1 min-w-[180px]">
                                <input type="text" id="vv-search-vertraege" placeholder="🔍 Suchen... (Name, Anbieter)"
                                    class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-sm">
                                <div id="vv-search-suggestions-box" class="hidden absolute z-40 top-full left-0 right-0 mt-1 bg-white border-2 border-indigo-300 rounded-lg shadow-xl max-h-72 overflow-y-auto">
                                    <ul id="vv-search-suggestions-list" class="text-sm"></ul>
                                </div>
                            </div>
                            <button id="vv-add-filter-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-bold transition text-sm">+ Filter</button>
                            <button id="vv-reset-filters-vertraege" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-bold transition text-sm">↺ Reset</button>
                        </div>
                        <div id="vv-active-search-tags" class="flex flex-wrap gap-1 mt-2"></div>
                    </div>

                    <div class="kategorienbox-panel">
                        <div class="kategorien-box-title">Kategorien-Box</div>
                        <div class="grid grid-cols-1 gap-2">
                            <select id="vv-filter-zahlungsrhythmus" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm">
                                <option value="">Alle Rhythmen</option>
                                <option value="taeglich">Täglich</option>
                                <option value="woechentlich">Wöchentlich</option>
                                <option value="monatlich">Monatlich</option>
                                <option value="quartalsweise">Quartalsweise</option>
                                <option value="halbjaehrlich">Halbjährlich</option>
                                <option value="jaehrlich">Jährlich</option>
                            </select>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <select id="vv-filter-kategorie" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm">
                                <option value="">Alle Kategorien</option>
                                <!-- Wird dynamisch gefüllt -->
                            </select>

                            <select id="vv-filter-unterkategorie" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm">
                                <option value="">Alle Unterkategorien</option>
                                <!-- Wird dynamisch gefüllt -->
                            </select>

                            <select id="vv-filter-kuendigungsabsicht" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm">
                                <option value="">Alle Absichten</option>
                                <option value="behalten">Behalten</option>
                                <option value="ueberlege">Überlege zu kündigen</option>
                                <option value="kuendigen">Will kündigen</option>
                                <option value="dringend">Dringend kündigen</option>
                            </select>

                            <select id="vv-filter-vertragsstatus" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm">
                                <option value="aktiv" selected>Nur Aktive</option>
                                <option value="">Alle Status</option>
                                <option value="zukuenftig">Zukünftig</option>
                                <option value="abgelaufen">Abgelaufen</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Verträge-Tabelle -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-indigo-50 border-b-2 border-indigo-200">
                                <tr>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-indigo-800 uppercase">Name</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-indigo-800 uppercase">Anbieter</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-indigo-800 uppercase">Kategorie</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-indigo-800 uppercase">Betrag</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-indigo-800 uppercase">Rhythmus</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-indigo-800 uppercase">Status</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-indigo-800 uppercase">Absicht</th>
                                    <th class="px-3 py-3 text-center text-xs font-bold text-indigo-800 uppercase">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="vertraege-table-body" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="8" class="px-4 py-8 text-center text-gray-400 italic">
                                        Keine Verträge vorhanden. Erstelle deinen ersten Vertrag!
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ========== VERTRAG MODAL ========== -->
            <div id="vertragModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 id="vertragModalTitle" class="text-xl font-bold">Neuer Vertrag</h3>
                        <button id="closeVertragModal" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="p-6 space-y-4">
                        <input type="hidden" id="vertragId">
                        
                        <!-- ===== ABSCHNITT 1: VERTRAGSDETAILS ===== -->
                        <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                            <h4 class="font-bold text-indigo-800 mb-3">📋 Vertragsdetails</h4>
                            
                            <!-- Vertragsname -->
                            <div class="mb-3">
                                <label class="block text-sm font-bold text-gray-700 mb-1">Vertragsname *</label>
                                <input type="text" id="vertragName" placeholder="z.B. Netflix, Spotify, Handyvertrag..." 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200">
                            </div>
                            
                            <!-- Anbieter -->
                            <div class="mb-3">
                                <label class="block text-sm font-bold text-gray-700 mb-1">Anbieter / Unternehmen</label>
                                <input type="text" id="vertragAnbieter" placeholder="z.B. Netflix Inc., Telekom..." 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200">
                            </div>
                            
                            <!-- Kategorie und Unterkategorie -->
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Kategorie</label>
                                    <select id="vertragKategorie" class="w-full p-3 border-2 border-gray-300 rounded-lg bg-white focus:border-indigo-500">
                                        <option value="">Keine Kategorie</option>
                                        <!-- Wird dynamisch gefüllt -->
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Unterkategorie</label>
                                    <select id="vertragUnterkategorie" class="w-full p-3 border-2 border-gray-300 rounded-lg bg-white focus:border-indigo-500">
                                        <option value="">Keine Unterkategorie</option>
                                        <!-- Wird dynamisch gefüllt basierend auf Kategorie -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ===== ABSCHNITT 2: BETRAG & RHYTHMUS ===== -->
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <h4 class="font-bold text-green-800 mb-3">💰 Betrag & Rhythmus</h4>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Regelmäßiger Betrag (€) *</label>
                                    <input type="number" id="vertragBetrag" step="0.01" min="0" placeholder="0.00" 
                                        class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Zahlungsrhythmus *</label>
                                    <select id="vertragRhythmus" class="w-full p-3 border-2 border-gray-300 rounded-lg bg-white focus:border-green-500">
                                        <option value="monatlich">Monatlich</option>
                                        <option value="taeglich">Täglich</option>
                                        <option value="woechentlich">Wöchentlich</option>
                                        <option value="quartalsweise">Quartalsweise (alle 3 Monate)</option>
                                        <option value="halbjaehrlich">Halbjährlich</option>
                                        <option value="jaehrlich">Jährlich</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Einmalige Sonderzahlungen -->
                            <div class="mt-3 bg-gradient-to-r from-yellow-50 to-green-50 p-3 rounded-lg border border-yellow-200">
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <label class="block text-sm font-bold text-gray-800">📌 Sonderzahlungen (optional)</label>
                                        <p class="text-xs text-gray-600">Zusatzbeträge oder Gutschriften</p>
                                    </div>
                                    <button type="button" id="btn-add-sonderzahlung" 
                                        class="px-3 py-1 bg-indigo-600 text-white text-sm font-bold rounded-lg hover:bg-indigo-700 transition flex items-center gap-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                        </svg>
                                        Hinzufügen
                                    </button>
                                </div>
                                <div id="sonderzahlungen-container" class="space-y-3"></div>
                                <div id="sonderzahlungen-empty" class="text-center py-2 text-gray-400 text-sm italic">
                                    Keine Sonderzahlungen hinzugefügt
                                </div>
                            </div>
                        </div>
                        
                        <!-- ===== ABSCHNITT 3: VERTRAGSLAUFZEIT ===== -->
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <h4 class="font-bold text-purple-800 mb-3">📅 Vertragslaufzeit</h4>
                            
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Vertragsbeginn</label>
                                    <input type="date" id="vertragBeginn" 
                                        class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Vertragsende</label>
                                    <input type="date" id="vertragEnde" 
                                        class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500" disabled>
                                </div>
                            </div>
                            
                            <!-- Unbegrenzt Checkbox -->
                            <div class="flex items-center gap-2 mb-3">
                                <input type="checkbox" id="vertragUnbegrenzt" class="w-5 h-5 rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                                <label for="vertragUnbegrenzt" class="text-sm font-medium text-gray-700">Unbegrenzte Laufzeit (kein Vertragsende)</label>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Mindestlaufzeit (Monate)</label>
                                <input type="number" id="vertragLaufzeit" min="0" placeholder="z.B. 24" 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                            </div>
                        </div>
                        
                        <!-- ===== ABSCHNITT 4: KÜNDIGUNG ===== -->
                        <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                            <h4 class="font-bold text-red-800 mb-3">⚠️ Kündigung</h4>
                            
                            <!-- Kündigungsfrist -->
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label class="block text-xs font-semibold text-gray-600 mb-1">Kündigungsfrist (Anzahl)</label>
                                    <input type="number" id="vertragKuendigungsfrist" min="0" placeholder="z.B. 3" 
                                        class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-red-500">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-gray-600 mb-1">Einheit</label>
                                    <select id="vertragKuendigungsfristEinheit" class="w-full p-2 border-2 border-gray-300 rounded-lg bg-white">
                                        <option value="tage">Tage</option>
                                        <option value="wochen">Wochen</option>
                                        <option value="monate" selected>Monate</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="block text-xs font-semibold text-gray-600 mb-1">Nächstes Kündigungsdatum (falls bekannt)</label>
                                <input type="date" id="vertragKuendigungsdatum" 
                                    class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-red-500">
                            </div>
                            
                            <!-- Kündigungsstatus -->
                            <div class="mb-3">
                                <label class="block text-sm font-bold text-gray-700 mb-2">Kündigungsstatus</label>
                                <select id="vertragKuendigungsstatus" class="w-full p-2 border-2 border-gray-300 rounded-lg bg-white focus:border-red-500">
                                    <option value="laufend">🟢 Nicht gekündigt</option>
                                    <option value="kuendigung_gesendet">📤 Kündigung gesendet</option>
                                    <option value="kuendigung_bestaetigt">✅ Kündigung bestätigt</option>
                                    <option value="storniert">❌ Storniert</option>
                                </select>
                            </div>
                            
                            <!-- Kündigungsabsicht -->
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Kündigungsabsicht</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="flex items-center p-2 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition kuendigungs-option border-gray-200" data-value="behalten">
                                        <input type="radio" name="kuendigungsabsicht" value="behalten" class="hidden">
                                        <span class="w-4 h-4 rounded-full border-2 border-gray-400 mr-2 flex items-center justify-center radio-circle"></span>
                                        <span class="text-sm">✅ Behalten</span>
                                    </label>
                                    <label class="flex items-center p-2 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition kuendigungs-option border-gray-200" data-value="ueberlege">
                                        <input type="radio" name="kuendigungsabsicht" value="ueberlege" class="hidden">
                                        <span class="w-4 h-4 rounded-full border-2 border-gray-400 mr-2 flex items-center justify-center radio-circle"></span>
                                        <span class="text-sm">🤔 Überlege</span>
                                    </label>
                                    <label class="flex items-center p-2 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition kuendigungs-option border-gray-200" data-value="kuendigen">
                                        <input type="radio" name="kuendigungsabsicht" value="kuendigen" class="hidden">
                                        <span class="w-4 h-4 rounded-full border-2 border-gray-400 mr-2 flex items-center justify-center radio-circle"></span>
                                        <span class="text-sm">📝 Will kündigen</span>
                                    </label>
                                    <label class="flex items-center p-2 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition kuendigungs-option border-gray-200" data-value="dringend">
                                        <input type="radio" name="kuendigungsabsicht" value="dringend" class="hidden">
                                        <span class="w-4 h-4 rounded-full border-2 border-gray-400 mr-2 flex items-center justify-center radio-circle"></span>
                                        <span class="text-sm">🚨 Dringend!</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ===== ABSCHNITT 5: ERINNERUNG & NOTIZEN ===== -->
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <h4 class="font-bold text-blue-800 mb-3">🔔 Erinnerung & Notizen</h4>
                            
                            <div class="flex items-center gap-3 mb-3">
                                <input type="number" id="vertragErinnerungTage" min="1" value="30" 
                                    class="w-24 p-2 border-2 border-gray-300 rounded-lg focus:border-blue-500">
                                <span class="text-sm text-gray-700">Tage vor Kündigungsfrist erinnern</span>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Notizen</label>
                                <textarea id="vertragNotizen" rows="2" placeholder="Zusätzliche Informationen..." 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 resize-none"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sticky bottom-0 bg-gray-100 p-4 rounded-b-2xl flex justify-between items-center">
                        <!-- Abtausch Button (nur bei Bearbeitung sichtbar) -->
                        <button id="vertragAbtauschBtn" class="hidden px-4 py-2 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition flex items-center gap-2">
                            🔄 Abtausch
                        </button>
                        <div class="flex-1"></div>
                        <div class="flex gap-3">
                            <button id="cancelVertragBtn" class="px-6 py-2 bg-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-400 transition">
                                Abbrechen
                            </button>
                            <button id="saveVertragBtn" class="px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-500 text-white font-bold rounded-lg hover:shadow-lg transition">
                                Speichern
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== VERTRAG DETAILS MODAL ========== -->
            <div id="vertragDetailsModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 id="vertragDetailsTitle" class="text-xl font-bold">Vertragsdetails</h3>
                        <button id="closeVertragDetailsModal" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div id="vertragDetailsContent" class="p-6">
                        <!-- Wird dynamisch gefüllt -->
                    </div>
                </div>
            </div>

            <!-- ========== VERTRAEGE SETTINGS MODAL ========== -->
            <div id="vertraegeSettingsModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 class="text-xl font-bold">⚙️ Einstellungen</h3>
                        <button id="closeVertraegeSettingsModal" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="p-6 space-y-4">
                        <!-- ===== KATEGORIEN VERWALTEN ===== -->
                        <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                            <h4 class="font-bold text-indigo-800 mb-3">📁 Kategorien verwalten</h4>
                            
                            <!-- Neue Kategorie -->
                            <div class="flex gap-2 mb-3">
                                <input type="text" id="vv-neue-kategorie" placeholder="Neue Kategorie (z.B. Versicherung, Mietvertrag...)" 
                                    class="flex-1 p-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500">
                                <button id="btn-add-kategorie" class="px-4 py-2 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition">
                                    + Hinzufügen
                                </button>
                            </div>
                            
                            <!-- Kategorien-Liste -->
                            <div id="vv-kategorien-liste" class="space-y-2 max-h-40 overflow-y-auto">
                                <!-- Wird dynamisch gefüllt -->
                                <p class="text-gray-400 text-sm italic text-center py-2">Keine Kategorien vorhanden</p>
                            </div>
                        </div>
                        
                        <!-- ===== UNTERKATEGORIEN VERWALTEN ===== -->
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <h4 class="font-bold text-purple-800 mb-3">📂 Unterkategorien verwalten</h4>
                            
                            <!-- Kategorie auswählen -->
                            <div class="mb-3">
                                <label class="block text-sm font-bold text-gray-700 mb-1">Für Kategorie:</label>
                                <select id="vv-unterkategorie-parent" class="w-full p-2 border-2 border-gray-300 rounded-lg bg-white focus:border-purple-500">
                                    <option value="">Kategorie wählen...</option>
                                    <!-- Wird dynamisch gefüllt -->
                                </select>
                            </div>
                            
                            <!-- Neue Unterkategorie -->
                            <div class="flex gap-2 mb-3">
                                <input type="text" id="vv-neue-unterkategorie" placeholder="Neue Unterkategorie (z.B. Fitnessstudio, Wiener Netze...)" 
                                    class="flex-1 p-2 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                                <button id="btn-add-unterkategorie" class="px-4 py-2 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition">
                                    + Hinzufügen
                                </button>
                            </div>
                            
                            <!-- Unterkategorien-Liste -->
                            <div id="vv-unterkategorien-liste" class="space-y-2 max-h-40 overflow-y-auto">
                                <!-- Wird dynamisch gefüllt -->
                                <p class="text-gray-400 text-sm italic text-center py-2">Kategorie wählen um Unterkategorien zu sehen</p>
                            </div>
                        </div>
                        
                        <!-- ===== THEMEN VERWALTEN ===== -->
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <h4 class="font-bold text-gray-800 mb-3">📋 Themen verwalten</h4>
                            
                            <!-- Neues Thema erstellen -->
                            <div class="flex gap-2 mb-3">
                                <input type="text" id="vv-neues-thema-name" placeholder="z.B. Haushalt, Fitness, Versicherungen..." 
                                    class="flex-1 p-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200">
                                <button id="btn-create-vertrags-thema" class="px-4 py-2 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition">
                                    Erstellen
                                </button>
                            </div>
                            
                            <!-- Themen-Liste -->
                            <div id="vv-themen-liste" class="space-y-2 max-h-40 overflow-y-auto">
                                <!-- Wird dynamisch gefüllt -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== THEMA MITGLIEDER MODAL ========== -->
            <div id="themaMitgliederModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-blue-600 to-indigo-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 class="text-xl font-bold">Mitglieder: <span id="mitglieder-thema-name"></span></h3>
                        <button id="closeThemaMitgliederModal" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="p-6 space-y-4">
                        <!-- Mitglied hinzufügen -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-bold text-blue-800 mb-3">Mitglied hinzufügen</h4>
                            <div class="space-y-2">
                                <select id="vv-mitglied-user" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-blue-500">
                                    <option value="">Benutzer wählen...</option>
                                    <!-- Wird dynamisch mit USERS gefüllt -->
                                </select>
                                <input type="hidden" id="vv-mitglied-recht" value="lesen">
                                <p class="text-sm text-gray-600 bg-gray-100 p-2 rounded-lg">
                                    <span class="font-medium">Zugriffsrecht:</span> 👁️ Nur Lesen
                                </p>
                                <button id="btn-add-mitglied" class="w-full px-4 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition">
                                    Hinzufügen
                                </button>
                            </div>
                        </div>
                        
                        <!-- Mitglieder-Liste -->
                        <div>
                            <h4 class="font-bold text-gray-800 mb-3">Aktuelle Mitglieder</h4>
                            <div id="vv-mitglieder-liste" class="space-y-2">
                                <!-- Wird dynamisch gefüllt -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== VERTRAG ABTAUSCH MODAL ========== -->
            <div id="vertragAbtauschModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-purple-600 to-indigo-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 class="text-xl font-bold">🔄 Vertrag abtauschen</h3>
                        <button id="closeVertragAbtauschModal" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="p-6 space-y-4">
                        <!-- Alter Eintrag Info -->
                        <div class="bg-gray-100 rounded-lg p-4">
                            <h4 class="font-bold text-gray-700 mb-2">📋 Aktueller Vertrag (wird beendet)</h4>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div>
                                    <span class="text-gray-500">Name:</span>
                                    <span id="vv-abtausch-alter-name" class="font-medium ml-1">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Anbieter:</span>
                                    <span id="vv-abtausch-alter-anbieter" class="font-medium ml-1">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Betrag:</span>
                                    <span id="vv-abtausch-alter-betrag" class="font-medium ml-1">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Laufzeit:</span>
                                    <span id="vv-abtausch-alter-laufzeit" class="font-medium ml-1">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Datumsfelder -->
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <h4 class="font-bold text-purple-800 mb-3">📅 Zeitraum</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Neuer Beginn *</label>
                                    <input type="date" id="vv-abtausch-neuer-beginn" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Alter Eintrag endet am</label>
                                    <input type="date" id="vv-abtausch-altes-ende" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                                    <p class="text-xs text-gray-500 mt-1">Automatisch: Tag vor neuem Beginn</p>
                                </div>
                            </div>
                        </div>

                        <!-- Nicht bearbeitbare Felder (vom alten Vertrag übernommen) -->
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <h4 class="font-bold text-gray-700 mb-3">🔒 Übernommene Daten (nicht änderbar)</h4>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div>
                                    <span class="text-gray-500">Name:</span>
                                    <span id="vv-abtausch-fix-name" class="font-medium ml-1">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Anbieter:</span>
                                    <span id="vv-abtausch-fix-anbieter" class="font-medium ml-1">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Kategorie:</span>
                                    <span id="vv-abtausch-fix-kategorie" class="font-medium ml-1">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Unterkategorie:</span>
                                    <span id="vv-abtausch-fix-unterkategorie" class="font-medium ml-1">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Kündigungsabsicht:</span>
                                    <span id="vv-abtausch-fix-absicht" class="font-medium ml-1">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Kündigungsstatus:</span>
                                    <span id="vv-abtausch-fix-status" class="font-medium ml-1">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Bearbeitbare Felder -->
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <h4 class="font-bold text-green-800 mb-3">✨ Neue Werte (anpassbar)</h4>
                            
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">💰 Neuer Betrag (€) *</label>
                                    <input type="number" step="0.01" id="vv-abtausch-betrag" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Zahlungsrhythmus</label>
                                    <select id="vv-abtausch-rhythmus" class="w-full p-2 border-2 border-gray-300 rounded-lg bg-white focus:border-green-500">
                                        <option value="monatlich">Monatlich</option>
                                        <option value="taeglich">Täglich</option>
                                        <option value="woechentlich">Wöchentlich</option>
                                        <option value="quartalsweise">Quartalsweise</option>
                                        <option value="halbjaehrlich">Halbjährlich</option>
                                        <option value="jaehrlich">Jährlich</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Vertragsende</label>
                                    <input type="date" id="vv-abtausch-ende" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-green-500">
                                </div>
                                <div class="flex items-end pb-2">
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" id="vv-abtausch-unbegrenzt" class="w-5 h-5 rounded border-gray-300 text-green-600 focus:ring-green-500">
                                        <span class="text-sm font-medium text-gray-700">Unbegrenzt</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Kündigungsfrist</label>
                                    <input type="number" id="vv-abtausch-kuendigungsfrist" min="0" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Einheit</label>
                                    <select id="vv-abtausch-kuendigungsfrist-einheit" class="w-full p-2 border-2 border-gray-300 rounded-lg bg-white focus:border-green-500">
                                        <option value="tage">Tage</option>
                                        <option value="wochen">Wochen</option>
                                        <option value="monate" selected>Monate</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Notizen -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">📝 Notizen zum neuen Eintrag</label>
                            <textarea id="vv-abtausch-notizen" rows="2" placeholder="z.B. Preiserhöhung ab..." 
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 resize-none"></textarea>
                        </div>
                    </div>
                    
                    <div class="sticky bottom-0 bg-gray-100 p-4 rounded-b-2xl flex justify-end gap-3">
                        <button id="cancelVertragAbtauschBtn" class="px-6 py-2 bg-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-400 transition">
                            Abbrechen
                        </button>
                        <button id="saveVertragAbtauschBtn" class="px-6 py-2 bg-gradient-to-r from-purple-600 to-indigo-500 text-white font-bold rounded-lg hover:shadow-lg transition">
                            🔄 Abtausch speichern
                        </button>
                    </div>
                </div>
            </div>

            <!-- ========== SENDUNGSVERWALTUNG VIEW ========== -->
            <div id="sendungsverwaltungView" class="view">
                <div class="back-link-container w-full mb-3">
                    <div class="flex justify-between items-center flex-wrap gap-2">
                        <button class="back-link flex items-center text-gray-600 hover:text-amber-600 transition"
                            data-target="home">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                stroke-linejoin="round" class="w-5 h-5 mr-1">
                                <path d="m15 18-6-6 6-6" />
                            </svg>
                            <span class="text-sm font-semibold">zurück</span>
                        </button>
                        <button id="openSendungModalBtn"
                            class="py-2 px-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-lg hover:shadow-lg transition flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4v16m8-8H4" />
                            </svg>
                            Neue Sendung
                        </button>
                    </div>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <!-- Tabs Navigation -->
                <div class="flex gap-2 mb-3 border-b-2 border-gray-200">
                    <button id="tabEmpfang" class="sendung-tab px-4 py-2 font-bold text-blue-600 border-b-4 border-blue-600 transition" data-tab="empfang">
                        📥 Empfang
                    </button>
                    <button id="tabVersand" class="sendung-tab px-4 py-2 font-bold text-gray-500 hover:text-orange-600 transition" data-tab="versand">
                        📤 Versand
                    </button>
                    <button id="tabRuecksendung" class="sendung-tab px-4 py-2 font-bold text-gray-500 hover:text-purple-600 transition" data-tab="ruecksendung">
                        🔄 Rücksendung
                    </button>
                </div>

                <!-- Dashboard Empfang -->
                <div id="dashboardEmpfang" class="sendung-dashboard bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-xl shadow-md mb-3">
                    <h2 class="text-xl font-bold mb-3">📥 Eingehende Pakete</h2>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="bg-white/20 px-3 py-2 rounded-lg">
                            <div class="text-2xl font-bold" id="empfangErwartet">0</div>
                            <div class="text-xs">⏳ Erwartet</div>
                        </div>
                        <div class="bg-white/20 px-3 py-2 rounded-lg">
                            <div class="text-2xl font-bold" id="empfangUnterwegs">0</div>
                            <div class="text-xs">🚚 Unterwegs</div>
                        </div>
                        <div class="bg-white/20 px-3 py-2 rounded-lg">
                            <div class="text-2xl font-bold" id="empfangProblem">0</div>
                            <div class="text-xs">⚠️ Problem</div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Versand -->
                <div id="dashboardVersand" class="sendung-dashboard hidden bg-gradient-to-r from-orange-500 to-red-500 text-white p-4 rounded-xl shadow-md mb-3">
                    <h2 class="text-xl font-bold mb-3">📤 Ausgehende Pakete</h2>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="bg-white/20 px-3 py-2 rounded-lg">
                            <div class="text-2xl font-bold" id="versandVorbereitung">0</div>
                            <div class="text-xs">📦 In Vorbereitung</div>
                        </div>
                        <div class="bg-white/20 px-3 py-2 rounded-lg">
                            <div class="text-2xl font-bold" id="versandUnterwegs">0</div>
                            <div class="text-xs">🚚 Unterwegs</div>
                        </div>
                        <div class="bg-white/20 px-3 py-2 rounded-lg">
                            <div class="text-2xl font-bold" id="versandProblem">0</div>
                            <div class="text-xs">⚠️ Problem</div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Rücksendung -->
                <div id="dashboardRuecksendung" class="sendung-dashboard hidden bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-xl shadow-md mb-3">
                    <h2 class="text-xl font-bold mb-3">🔄 Rücksendungen</h2>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="bg-white/20 px-3 py-2 rounded-lg">
                            <div class="text-2xl font-bold" id="ruecksendungOffen">0</div>
                            <div class="text-xs">📋 Offen</div>
                        </div>
                        <div class="bg-white/20 px-3 py-2 rounded-lg">
                            <div class="text-2xl font-bold" id="ruecksendungUnterwegs">0</div>
                            <div class="text-xs">🚚 Unterwegs</div>
                        </div>
                        <div class="bg-white/20 px-3 py-2 rounded-lg">
                            <div class="text-2xl font-bold" id="ruecksendungFrist">0</div>
                            <div class="text-xs">⏰ Frist läuft ab</div>
                        </div>
                    </div>
                </div>

                <div class="mb-3 flex flex-wrap gap-2">
                    <button id="sendungToggleDetailsBtn" class="px-4 py-2 rounded-lg font-bold text-sm transition bg-gray-200 text-gray-800 hover:bg-gray-300">
                        🔍 Details anzeigen
                    </button>
                    <button id="sendungToggleViewBtn" class="px-4 py-2 rounded-lg font-bold text-sm transition bg-gray-200 text-gray-800 hover:bg-gray-300">
                        📋 Ansicht: Liste
                    </button>
                </div>

                <div class="flex justify-center mb-2">
                    <button id="sendungToggleFilterControls"
                        class="text-gray-500 hover:text-amber-700 transition flex items-center gap-1 text-xs font-bold py-1 px-4 rounded-full hover:bg-amber-50">
                        <span>Filter & Kategorien</span>
                        <svg id="sendungToggleFilterIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 transform transition-transform">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- Multi-Filter System -->
                <div id="sendungFilterControlsWrapper" class="hidden mb-3 space-y-3">
                    <div class="filterbox-panel">
                        <div class="filter-box-title">Filterbox</div>
                        <!-- Filter Hinzufügen -->
                        <div class="flex gap-2 items-center flex-wrap">
                            <label class="flex items-center gap-1 px-3 py-2 bg-white border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-red-50 hover:border-red-300 transition select-none">
                                <input type="checkbox" id="sendungFilterNegate" class="h-4 w-4 accent-red-500">
                                <span class="text-red-600 font-bold text-sm">NICHT</span>
                            </label>
                            <select id="sendungFilterJoinMode" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm font-bold">
                                <option value="and" selected>AND</option>
                                <option value="or">OR</option>
                            </select>
                            <div class="relative flex-1 min-w-[200px]">
                                <input type="text" id="sendungSearchInput"
                                    class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-amber-500 focus:outline-none text-sm"
                                    placeholder="🔍 Suchbegriff eingeben...">
                                <div id="sendungSearchSuggestionsBox" class="hidden absolute z-40 top-full left-0 right-0 mt-1 bg-white border-2 border-amber-300 rounded-lg shadow-xl max-h-72 overflow-y-auto">
                                    <ul id="sendungSearchSuggestionsList" class="text-sm"></ul>
                                </div>
                            </div>

                            <button id="sendungAddFilterBtn"
                                class="px-4 py-2 bg-amber-600 text-white text-sm font-bold rounded-lg hover:bg-amber-700 transition whitespace-nowrap">
                                + Filter
                            </button>

                            <button id="sendungResetFiltersBtn"
                                class="px-4 py-2 bg-gray-300 text-gray-700 text-sm font-bold rounded-lg hover:bg-gray-400 transition whitespace-nowrap">
                                ↺ Zurücksetzen
                            </button>
                        </div>

                        <!-- Aktive Filter Badges -->
                        <div id="sendungActiveFiltersContainer" class="flex flex-wrap gap-1 mt-2">
                        </div>
                    </div>
                </div>

                <!-- Sendungen Liste -->
                <div id="sendungenContainer" class="space-y-3">
                </div>
            </div>

            <!-- ========== REZEPTE VIEW ========== -->
            <div id="rezepteView" class="view">
                <div class="back-link-container w-full mb-3">
                    <div class="flex justify-between items-center">
                        <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition" data-target="home">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-1">
                                <path d="m15 18-6-6 6-6" />
                            </svg>
                            <span class="text-sm font-semibold">zurück</span>
                        </button>
                        <button id="btn-neues-rezept" class="py-2 px-4 bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold rounded-lg hover:shadow-lg transition flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                            </svg>
                            Neues Rezept
                        </button>
                    </div>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <!-- Header mit Statistiken -->
                <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-xl p-4 mb-4 shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold flex items-center gap-2">🍳 Rezepte</h2>
                            <p class="text-orange-100 text-sm">Deine Rezeptsammlung</p>
                        </div>
                        <div class="text-right">
                            <p class="text-3xl font-bold" id="stat-rezepte-gesamt">0</p>
                            <p class="text-xs text-orange-100">Rezepte gesamt</p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center mb-2">
                    <button id="rz-toggle-filter-controls"
                        class="text-gray-500 hover:text-orange-700 transition flex items-center gap-1 text-xs font-bold py-1 px-4 rounded-full hover:bg-orange-50">
                        <span>Filter & Kategorien</span>
                        <svg id="rz-toggle-filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 transform transition-transform">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- Suchleiste & Filter -->
                <div id="rz-filter-controls-wrapper" class="hidden mb-4 space-y-3">
                    <div class="filterbox-panel">
                        <div class="filter-box-title">Filterbox</div>
                    <!-- Hauptsuche -->
                    <div class="flex flex-wrap gap-2 items-center mb-3">
                        <label class="flex items-center gap-1 px-3 py-2 bg-gray-100 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-red-50 hover:border-red-300 transition select-none">
                            <input type="checkbox" id="rz-filter-negate" class="h-4 w-4 accent-red-500">
                            <span class="text-red-600 font-bold text-sm">NICHT</span>
                        </label>
                        <select id="rz-search-join-mode" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm font-bold">
                            <option value="and" selected>AND</option>
                            <option value="or">OR</option>
                        </select>
                        <div class="relative flex-1 min-w-[220px]">
                        <input type="text" id="rz-search-input" placeholder="Rezept suchen (Titel, Zutat, ID, Nummer...)" 
                            class="w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-orange-500 focus:outline-none transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        <div id="rz-search-suggestions-box" class="hidden absolute z-40 top-full left-0 right-0 mt-1 bg-white border-2 border-orange-300 rounded-lg shadow-xl max-h-72 overflow-y-auto">
                            <ul id="rz-search-suggestions-list" class="text-sm"></ul>
                        </div>
                        </div>
                        <button id="rz-add-filter-btn" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-bold text-sm">+ Filter</button>
                        <button id="rz-reset-all-filters" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-bold text-sm">↺ Reset</button>
                    </div>

                    <div class="grid grid-cols-1 gap-2 mb-3">
                        <div id="rz-active-filters" class="flex flex-wrap gap-1 mt-2"></div>
                    </div>
                    </div>

                    <div class="kategorienbox-panel">
                        <div class="kategorien-box-title">Kategorien-Box</div>
                    
                    <!-- Filter-Toggle -->
                    <button id="rz-toggle-advanced-filter" class="w-full flex items-center justify-between py-2 px-3 bg-gray-100 rounded-lg hover:bg-gray-200 transition mb-3">
                        <span class="text-sm font-semibold text-gray-700 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                            </svg>
                            Erweiterte Filter
                        </span>
                        <svg id="rz-advanced-filter-toggle-icon" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-500 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    
                    <!-- Erweiterte Filter (versteckt) -->
                    <div id="rz-advanced-filter-panel" class="hidden space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-semibold text-gray-600 mb-1">Kategorie</label>
                                <select id="rz-filter-kategorie" class="w-full p-2 border rounded-lg text-sm">
                                    <option value="">Alle Kategorien</option>
                                    <option value="vorspeise">🥗 Vorspeise</option>
                                    <option value="hauptgericht">🍽️ Hauptgericht</option>
                                    <option value="dessert">🍰 Dessert</option>
                                    <option value="getraenk">🥤 Getränk</option>
                                    <option value="snack">🍿 Snack</option>
                                    <option value="backen">🥧 Backen</option>
                                    <option value="suppe">🍲 Suppe</option>
                                    <option value="salat">🥬 Salat</option>
                                    <option value="sonstiges">📦 Sonstiges</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-600 mb-1">Arbeitszeit</label>
                                <select id="rz-filter-arbeitszeit" class="w-full p-2 border rounded-lg text-sm">
                                    <option value="">Beliebig</option>
                                    <option value="15">⚡ Bis 15 Min</option>
                                    <option value="30">🕐 Bis 30 Min</option>
                                    <option value="60">🕑 Bis 1 Std</option>
                                    <option value="120">🕒 Bis 2 Std</option>
                                    <option value="999">🕓 Über 2 Std</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-semibold text-gray-600 mb-1">Bewertung</label>
                                <select id="rz-filter-bewertung" class="w-full p-2 border rounded-lg text-sm">
                                    <option value="">Alle</option>
                                    <option value="5">⭐⭐⭐⭐⭐ (5)</option>
                                    <option value="4">⭐⭐⭐⭐ (4+)</option>
                                    <option value="3">⭐⭐⭐ (3+)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-600 mb-1">Rezept-Typ</label>
                                <select id="rz-filter-typ" class="w-full p-2 border rounded-lg text-sm">
                                    <option value="">Alle Typen</option>
                                    <option value="manuell">📝 Manuell eingegeben</option>
                                    <option value="dokument">📄 Dokument/Foto</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-semibold text-gray-600 mb-1">Rezept-ID</label>
                                <input type="text" id="rz-filter-id" placeholder="z.B. RZ001" class="w-full p-2 border rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-600 mb-1">Mappen-Nr.</label>
                                <input type="text" id="rz-filter-mappennr" placeholder="z.B. 42" class="w-full p-2 border rounded-lg text-sm">
                            </div>
                        </div>
                        <button id="rz-reset-advanced-filter" class="w-full py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition text-sm">
                            Filter zurücksetzen
                        </button>
                    </div>
                    </div>
                </div>

                <!-- Rezepte-Liste -->
                <div id="rezepte-liste" class="space-y-3">
                    <!-- Wird dynamisch gefüllt -->
                </div>

                <!-- Leerer Zustand -->
                <div id="rezepte-leer" class="hidden text-center py-12">
                    <div class="text-6xl mb-4">📖</div>
                    <h3 class="text-xl font-bold text-gray-700 mb-2">Noch keine Rezepte</h3>
                    <p class="text-gray-500 mb-4">Erstelle dein erstes Rezept!</p>
                    <button id="btn-erstes-rezept" class="py-2 px-6 bg-orange-500 text-white font-bold rounded-lg hover:bg-orange-600 transition">
                        + Rezept erstellen
                    </button>
                </div>
            </div>

            <!-- ========== REZEPT MODAL (Erstellen/Bearbeiten) ========== -->
            <div id="rezeptModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[95vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-orange-500 to-red-500 text-white p-4 rounded-t-2xl flex justify-between items-center z-10">
                        <h3 id="rezeptModalTitle" class="text-xl font-bold">Neues Rezept</h3>
                        <button id="closeRezeptModal" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="p-6 space-y-4">
                        <input type="hidden" id="rezeptId">
                        
                        <!-- Rezept-Typ Auswahl -->
                        <div class="bg-gray-100 p-4 rounded-xl">
                            <label class="block text-sm font-bold text-gray-700 mb-3">Rezept-Typ</label>
                            <div class="grid grid-cols-2 gap-3">
                                <label class="rezept-typ-option flex items-center gap-3 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-orange-400 transition" data-value="manuell">
                                    <input type="radio" name="rezeptTyp" value="manuell" checked class="hidden">
                                    <span class="text-2xl">📝</span>
                                    <div>
                                        <span class="font-bold text-gray-800 block">Manuell eingeben</span>
                                        <span class="text-xs text-gray-500">Zutaten & Schritte einzeln</span>
                                    </div>
                                </label>
                                <label class="rezept-typ-option flex items-center gap-3 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-orange-400 transition" data-value="dokument">
                                    <input type="radio" name="rezeptTyp" value="dokument" class="hidden">
                                    <span class="text-2xl">📄</span>
                                    <div>
                                        <span class="font-bold text-gray-800 block">Dokument/Foto</span>
                                        <span class="text-xs text-gray-500">PDF oder Bild anhängen</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Basis-Infos -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-2">
                                <label class="block text-sm font-bold text-gray-700 mb-1">Titel *</label>
                                <input type="text" id="rezeptTitel" placeholder="z.B. Spaghetti Carbonara" 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Kategorie</label>
                                <select id="rezeptKategorie" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                                    <option value="hauptgericht">🍽️ Hauptgericht</option>
                                    <option value="vorspeise">🥗 Vorspeise</option>
                                    <option value="dessert">🍰 Dessert</option>
                                    <option value="getraenk">🥤 Getränk</option>
                                    <option value="snack">🍿 Snack</option>
                                    <option value="backen">🥧 Backen</option>
                                    <option value="suppe">🍲 Suppe</option>
                                    <option value="salat">🥬 Salat</option>
                                    <option value="sonstiges">📦 Sonstiges</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Mappen-Nr.</label>
                                <input type="number" id="rezeptMappenNr" placeholder="z.B. 42" min="1"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Portionen</label>
                                <input type="number" id="rezeptPortionen" value="4" min="1"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Arbeitszeit (Min)</label>
                                <input type="number" id="rezeptArbeitszeit" placeholder="30" min="1"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Gesamtzeit (Min)</label>
                                <input type="number" id="rezeptGesamtzeit" placeholder="60" min="1"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                            </div>
                        </div>
                        
                        <!-- Dokument-Upload (nur bei Typ "dokument") -->
                        <div id="rezept-dokument-section" class="hidden bg-blue-50 p-4 rounded-xl border-2 border-dashed border-blue-300">
                            <label class="block text-sm font-bold text-blue-800 mb-3">📎 Dokument/Foto hochladen</label>
                            <div class="space-y-3">
                                <input type="file" id="rezeptDokument" accept="image/*,.pdf" multiple
                                    class="w-full p-2 border rounded-lg bg-white">
                                <div class="flex gap-2">
                                    <button type="button" id="btn-kamera" class="flex-1 py-2 px-4 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                        </svg>
                                        Kamera
                                    </button>
                                </div>
                                <div id="rezept-dokument-preview" class="grid grid-cols-3 gap-2">
                                    <!-- Vorschau der hochgeladenen Dateien -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Zutaten (nur bei Typ "manuell") -->
                        <div id="rezept-zutaten-section" class="bg-green-50 p-4 rounded-xl border border-green-200">
                            <div class="flex justify-between items-center mb-3">
                                <label class="block text-sm font-bold text-green-800">🥕 Zutaten</label>
                                <button type="button" id="btn-add-zutat" class="px-3 py-1 bg-green-600 text-white text-sm font-bold rounded-lg hover:bg-green-700 transition flex items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                    </svg>
                                    Zutat
                                </button>
                            </div>
                            <div id="zutaten-container" class="space-y-2">
                                <!-- Dynamisch hinzugefügte Zutaten -->
                            </div>
                            <div id="zutaten-leer" class="text-center py-3 text-gray-400 text-sm italic">
                                Noch keine Zutaten hinzugefügt
                            </div>
                        </div>
                        
                        <!-- Arbeitsschritte (nur bei Typ "manuell") -->
                        <div id="rezept-schritte-section" class="bg-yellow-50 p-4 rounded-xl border border-yellow-200">
                            <div class="flex justify-between items-center mb-3">
                                <label class="block text-sm font-bold text-yellow-800">📋 Arbeitsschritte</label>
                                <button type="button" id="btn-add-schritt" class="px-3 py-1 bg-yellow-600 text-white text-sm font-bold rounded-lg hover:bg-yellow-700 transition flex items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                    </svg>
                                    Schritt
                                </button>
                            </div>
                            <div id="schritte-container" class="space-y-3">
                                <!-- Dynamisch hinzugefügte Schritte -->
                            </div>
                            <div id="schritte-leer" class="text-center py-3 text-gray-400 text-sm italic">
                                Noch keine Arbeitsschritte hinzugefügt
                            </div>
                        </div>
                        
                        <!-- Notizen -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">📝 Notizen zum Rezept</label>
                            <textarea id="rezeptNotizen" rows="3" placeholder="Tipps, Variationen, Anmerkungen..." 
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 resize-none"></textarea>
                        </div>
                        
                        <!-- Bewertung -->
                        <div class="bg-purple-50 p-4 rounded-xl border border-purple-200">
                            <label class="block text-sm font-bold text-purple-800 mb-2">⭐ Bewertung</label>
                            <div id="rezept-bewertung" class="flex gap-2">
                                <button type="button" class="stern-btn text-3xl text-gray-300 hover:text-yellow-400 transition" data-wert="1">★</button>
                                <button type="button" class="stern-btn text-3xl text-gray-300 hover:text-yellow-400 transition" data-wert="2">★</button>
                                <button type="button" class="stern-btn text-3xl text-gray-300 hover:text-yellow-400 transition" data-wert="3">★</button>
                                <button type="button" class="stern-btn text-3xl text-gray-300 hover:text-yellow-400 transition" data-wert="4">★</button>
                                <button type="button" class="stern-btn text-3xl text-gray-300 hover:text-yellow-400 transition" data-wert="5">★</button>
                            </div>
                            <input type="hidden" id="rezeptBewertung" value="0">
                        </div>
                    </div>
                    
                    <div class="sticky bottom-0 bg-gray-100 p-4 rounded-b-2xl flex justify-end gap-3">
                        <button id="cancelRezeptBtn" class="px-6 py-2 bg-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-400 transition">
                            Abbrechen
                        </button>
                        <button id="saveRezeptBtn" class="px-6 py-2 bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold rounded-lg hover:shadow-lg transition">
                            Speichern
                        </button>
                    </div>
                </div>
            </div>

            <!-- ========== REZEPT DETAILS MODAL ========== -->
            <div id="rezeptDetailsModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[95vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-orange-500 to-red-500 text-white p-4 rounded-t-2xl flex justify-between items-center z-10">
                        <h3 id="rezeptDetailsTitle" class="text-xl font-bold">Rezeptdetails</h3>
                        <button id="closeRezeptDetailsModal" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Portionen-Umrechner -->
                    <div id="portionen-rechner" class="bg-orange-50 p-4 border-b border-orange-200">
                        <div class="flex items-center justify-center gap-4">
                            <span class="text-sm font-bold text-orange-800">Portionen:</span>
                            <button type="button" id="portionen-minus" class="w-8 h-8 bg-orange-500 text-white rounded-full font-bold hover:bg-orange-600 transition">-</button>
                            <span id="portionen-anzeige" class="text-2xl font-bold text-orange-700 w-12 text-center">4</span>
                            <button type="button" id="portionen-plus" class="w-8 h-8 bg-orange-500 text-white rounded-full font-bold hover:bg-orange-600 transition">+</button>
                            <span class="text-xs text-orange-600">(Original: <span id="original-portionen">4</span>)</span>
                        </div>
                    </div>
                    
                    <div id="rezeptDetailsContent" class="p-6">
                        <!-- Wird dynamisch gefüllt -->
                    </div>
                </div>
            </div>

            <!-- ========== HAUSHALTSZAHLUNGEN VIEW ========== -->
            <div id="haushaltszahlungenView" class="view">
                <div class="back-link-container w-full mb-3">
                    <div class="flex justify-between items-center flex-wrap gap-2">
                        <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition" data-target="home">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-1">
                                <path d="m15 18-6-6 6-6" />
                            </svg>
                            <span class="text-base font-semibold">zurück</span>
                        </button>
                        
                        <!-- Thema-Dropdown -->
                        <select id="hz-thema-dropdown" class="flex-1 min-w-[150px] max-w-[300px] p-2 border-2 border-cyan-500 rounded-lg bg-white text-sm font-bold text-cyan-700 focus:ring-2 focus:ring-cyan-300">
                            <option value="">Thema wählen...</option>
                        </select>
                        
                        <div class="flex gap-2">
                            <!-- Einladungen Button mit Badge -->
                            <button onclick="window.openEinladungenModal()" class="relative p-2 text-gray-500 hover:text-purple-600 transition rounded-full hover:bg-purple-100" title="Einladungen">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                                    <path d="M3 4a2 2 0 0 0-2 2v1.161l8.441 4.221a1.25 1.25 0 0 0 1.118 0L19 7.162V6a2 2 0 0 0-2-2H3Z" />
                                    <path d="m19 8.839-7.77 3.885a2.75 2.75 0 0 1-2.46 0L1 8.839V14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.839Z" />
                                </svg>
                                <span id="hz-einladungen-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">0</span>
                            </button>
                            <button id="btn-haushaltszahlungen-settings" class="p-2 text-gray-500 hover:text-gray-800 transition rounded-full hover:bg-gray-200" title="Einstellungen">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                                    <path fill-rule="evenodd" d="M7.84 1.804A1 1 0 0 1 8.82 1h2.36a1 1 0 0 1 .98.804l.295 1.473c.497.144.971.342 1.416.587l1.25-.834a1 1 0 0 1 1.262.125l1.669 1.669a1 1 0 0 1 .125 1.262l-.834 1.25c.245.445.443.919.587 1.416l1.473.294a1 1 0 0 1 .804.98v2.361a1 1 0 0 1-.804.98l-1.473.295a6.95 6.95 0 0 1-.587 1.416l.834 1.25a1 1 0 0 1-.125 1.262l-1.669 1.669a1 1 0 0 1-1.262.125l-1.25-.834a6.953 6.953 0 0 1-1.416.587l-.294 1.473a1 1 0 0 1-.98.804H8.82a1 1 0 0 1-.98-.804l-.295-1.473a6.957 6.957 0 0 1-1.416-.587l-1.25.834a1 1 0 0 1-1.262-.125l-1.669-1.669a1 1 0 0 1-.125-1.262l.834-1.25a6.957 6.957 0 0 1-.587-1.416l-1.473-.294A1 1 0 0 1 1 11.18V8.82a1 1 0 0 1 .804-.98l1.473-.295c.144-.497.342-.971.587-1.416l-.834-1.25a1 1 0 0 1 .125-1.262l1.669-1.669a1 1 0 0 1 1.262-.125l1.25.834c.445-.245.919-.443 1.416-.587l.294-1.473ZM13 10a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <button id="btn-create-haushaltszahlung" class="py-2 px-4 bg-gradient-to-r from-cyan-600 to-teal-500 text-white font-bold rounded-lg hover:shadow-lg transition flex items-center gap-2 text-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                </svg>
                                Neu
                            </button>
                        </div>
                    </div>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <!-- Simulations-Warnung -->
                <div id="hz-simulation-warning" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-3 rounded-lg mb-3 font-bold text-sm"></div>

                <!-- Header mit Dashboard -->
                <div class="bg-gradient-to-r from-cyan-600 to-teal-500 text-white p-4 rounded-xl shadow-md mb-3">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-xl font-bold">🏠 Haushaltszahlungen</h2>
                        <span id="hz-total-status" class="px-4 py-2 rounded-lg font-bold text-white bg-green-500">ALLES OK</span>
                    </div>
                    
                    <!-- Zähler: Aktiv, Geplant, Vergangen, Betrag fehlt -->
                    <div class="grid grid-cols-4 gap-2 text-center mb-3">
                        <div class="bg-green-500/30 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="hz-stat-aktiv">0</p>
                            <p class="text-[10px] font-semibold leading-tight">✓ Aktiv</p>
                        </div>
                        <div class="bg-blue-500/30 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="hz-stat-geplant">0</p>
                            <p class="text-[10px] font-semibold leading-tight">🕐 Geplant</p>
                        </div>
                        <div class="bg-gray-500/30 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="hz-stat-vergangen">0</p>
                            <p class="text-[10px] font-semibold leading-tight">⏸ Vergangen</p>
                        </div>
                        <div class="bg-yellow-500/30 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="hz-stat-betrag-fehlt">0</p>
                            <p class="text-[10px] font-semibold leading-tight">⚠️ Betrag fehlt</p>
                        </div>
                    </div>

                    <!-- Kosten-Übersicht -->
                    <div class="bg-white/10 p-3 rounded-lg mb-3">
                        <h4 class="text-xs font-bold mb-2">📊 Kosten-Übersicht (Gesamt)</h4>
                        <div class="grid grid-cols-3 gap-2 text-center items-start">
                            <div>
                                <p class="text-lg font-bold flex items-center justify-center" id="hz-kosten-monatlich">0,00 €</p>
                                <p class="text-[10px] flex items-center justify-center mt-1">Monatlich</p>
                            </div>
                            <div>
                                <p class="text-lg font-bold flex items-center justify-center" id="hz-kosten-jaehrlich">0,00 €</p>
                                <p class="text-[10px] flex items-center justify-center mt-1">Jährlich</p>
                            </div>
                            <div>
                                <p class="text-lg font-bold flex items-center justify-center" id="hz-kosten-effektiv">0,00 €</p>
                                <p class="text-[10px] flex items-center justify-center mt-1">Effektiv/Monat</p>
                            </div>
                        </div>
                    </div>

                    <!-- Mitglieder-Beiträge (dynamisch, max 2 pro Zeile) -->
                    <div id="hz-mitglieder-beitraege" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <!-- Wird dynamisch gefüllt -->
                        <p class="text-white/70 text-sm col-span-full text-center">Lade Mitglieder...</p>
                    </div>
                </div>

                <!-- Monatsübersicht -->
                <div class="bg-white rounded-lg shadow p-3 mb-3">
                    <div class="flex items-center justify-between mb-2 cursor-pointer" onclick="document.getElementById('hz-monats-uebersicht').classList.toggle('hidden'); this.querySelector('span').textContent = document.getElementById('hz-monats-uebersicht').classList.contains('hidden') ? '▶' : '▼';">
                        <h3 class="text-sm font-bold text-gray-700">Monatsübersicht (Gutschrift / Belastung)</h3>
                        <span class="text-gray-500 font-bold">▶</span>
                    </div>
                    <div id="hz-monats-uebersicht" class="overflow-x-auto text-xs hidden">
                        <!-- Wird dynamisch gefüllt -->
                    </div>
                </div>

                <!-- Simulations-Datum -->
                <div class="bg-gray-50 p-3 rounded-lg mb-3 border border-gray-200">
                    <div class="flex flex-wrap gap-2 items-center">
                        <label class="text-sm font-bold text-gray-700">📅 Datums-Simulation:</label>
                        <input type="date" id="hz-simulation-datum" class="p-2 border-2 border-gray-300 rounded-lg text-sm">
                        <button id="btn-clear-simulation" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-bold text-sm">Zurücksetzen</button>
                    </div>
                </div>

                <div class="flex justify-center mb-2">
                    <button id="hz-toggle-filter-controls"
                        class="text-gray-500 hover:text-cyan-700 transition flex items-center gap-1 text-xs font-bold py-1 px-4 rounded-full hover:bg-cyan-50">
                        <span>Filter & Kategorien</span>
                        <svg id="hz-toggle-filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 transform transition-transform">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- Such- und Filterleiste -->
                <div id="hz-filter-controls-wrapper" class="hidden mb-3 space-y-3">
                    <div class="filterbox-panel">
                        <div class="filter-box-title">Filterbox</div>
                    <div class="flex flex-wrap gap-2 items-center mb-2">
                        <label class="flex items-center gap-1 px-3 py-2 bg-white border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-red-50 hover:border-red-300 transition select-none">
                            <input type="checkbox" id="hz-filter-negate" class="h-4 w-4 accent-red-500">
                            <span class="text-red-600 font-bold text-sm">NICHT</span>
                        </label>
                        <select id="hz-search-join-mode" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm font-bold">
                            <option value="and" selected>AND</option>
                            <option value="or">OR</option>
                        </select>
                        <div class="relative flex-1 min-w-[200px]">
                            <input type="text" id="search-haushaltszahlungen" placeholder="🔍 Suchen... (Zweck, Organisation)" 
                                class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 text-sm">
                            <div id="hz-search-suggestions-box" class="hidden absolute z-40 top-full left-0 right-0 mt-1 bg-white border-2 border-cyan-300 rounded-lg shadow-xl max-h-72 overflow-y-auto">
                                <ul id="hz-search-suggestions-list" class="text-sm"></ul>
                            </div>
                        </div>
                        <button id="hz-add-filter-btn" class="px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 font-bold transition text-sm">+ Filter</button>
                        <button id="reset-filters-haushaltszahlungen" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-bold transition text-sm">
                            ↺ Reset
                        </button>
                    </div>

                    <div id="hz-active-search-tags" class="flex flex-wrap gap-1 mt-2"></div>
                    </div>

                    <div class="kategorienbox-panel">
                        <div class="kategorien-box-title">Kategorien-Box</div>
                    <div class="flex flex-wrap gap-2">
                        <select id="filter-hz-status" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm">
                            <option value="">Alle Status</option>
                            <option value="aktiv" selected>✓ Aktiv</option>
                            <option value="n-aktiv-geplant">📅 N-Aktiv:Geplant</option>
                            <option value="n-aktiv-vergangen">⏰ N-Aktiv:Vergangen</option>
                            <option value="fehler">⚠️ Fehler</option>
                        </select>
                        
                        <select id="filter-hz-typ" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm">
                            <option value="">Alle Typen</option>
                            <option value="belastung">📤 Belastung</option>
                            <option value="gutschrift">📥 Gutschrift</option>
                        </select>
                        
                        <!-- Intervall-Filter mit Mehrfachauswahl -->
                        <div class="relative" id="hz-intervall-filter-container">
                            <button type="button" id="hz-intervall-filter-btn" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm min-w-[140px] text-left flex justify-between items-center">
                                <span id="hz-intervall-filter-label">Alle Intervalle</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <div id="hz-intervall-dropdown" class="absolute top-full left-0 mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-lg z-50 hidden min-w-[200px] max-h-[300px] overflow-y-auto">
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer border-b border-gray-200">
                                    <input type="checkbox" value="monatlich" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm font-bold">📅 Monatlich</span>
                                </label>
                                <div class="border-b border-gray-200 py-1 px-2 text-xs text-gray-500 bg-gray-50">Einzelmonate:</div>
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" value="januar" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm">Jänner</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" value="februar" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm">Februar</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" value="maerz" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm">März</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" value="april" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm">April</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" value="mai" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm">Mai</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" value="juni" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm">Juni</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" value="juli" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm">Juli</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" value="august" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm">August</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" value="september" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm">September</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" value="oktober" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm">Oktober</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" value="november" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm">November</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" value="dezember" class="hz-intervall-filter-cb rounded">
                                    <span class="text-sm">Dezember</span>
                                </label>
                            </div>
                        </div>
                        
                    </div>
                    </div>
                </div>

                <!-- Einträge-Tabelle -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-cyan-50 border-b-2 border-cyan-200">
                                <tr>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-cyan-800 uppercase">Status</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-cyan-800 uppercase">Typ</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-cyan-800 uppercase">Zweck</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-cyan-800 uppercase">Organisation</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-cyan-800 uppercase">Intervall</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-cyan-800 uppercase">Betrag</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-cyan-800 uppercase">Anteil</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-cyan-800 uppercase">Gültigkeit</th>
                                    <th class="px-3 py-3 text-center text-xs font-bold text-cyan-800 uppercase">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="haushaltszahlungen-table-body" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="9" class="px-4 py-8 text-center text-gray-400 italic">
                                        Keine Einträge vorhanden. Erstelle deinen ersten Eintrag!
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ========== GESCHENKEMANAGEMENT VIEW ========== -->
            <div id="geschenkemanagementView" class="view">
                <div class="back-link-container w-full mb-3">
                    <div class="flex justify-between items-center flex-wrap gap-2">
                        <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition flex-shrink-0" data-target="home">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-1">
                                <path d="m15 18-6-6 6-6" />
                            </svg>
                            <span class="text-base font-semibold">zurück</span>
                        </button>
                        
                        <!-- Thema-Dropdown -->
                        <select id="gm-thema-dropdown" class="flex-1 min-w-[200px] p-2 border-2 border-pink-500 rounded-lg bg-white text-sm font-bold text-pink-700 focus:ring-2 focus:ring-pink-300">
                            <option value="">Thema wählen...</option>
                        </select>
                        
                        <div class="flex gap-2 flex-shrink-0">
                            <button id="btn-geschenke-settings" class="p-2 text-gray-500 hover:text-gray-800 transition rounded-full hover:bg-gray-200" title="Einstellungen">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                                    <path fill-rule="evenodd" d="M7.84 1.804A1 1 0 0 1 8.82 1h2.36a1 1 0 0 1 .98.804l.295 1.473c.497.144.971.342 1.416.587l1.25-.834a1 1 0 0 1 1.262.125l1.669 1.669a1 1 0 0 1 .125 1.262l-.834 1.25c.245.445.443.919.587 1.416l1.473.294a1 1 0 0 1 .804.98v2.361a1 1 0 0 1-.804.98l-1.473.295a6.95 6.95 0 0 1-.587 1.416l.834 1.25a1 1 0 0 1-.125 1.262l-1.669 1.669a1 1 0 0 1-1.262.125l-1.25-.834a6.953 6.953 0 0 1-1.416.587l-.294 1.473a1 1 0 0 1-.98.804H8.82a1 1 0 0 1-.98-.804l-.295-1.473a6.957 6.957 0 0 1-1.416-.587l-1.25.834a1 1 0 0 1-1.262-.125l-1.669-1.669a1 1 0 0 1-.125-1.262l.834-1.25a6.957 6.957 0 0 1-.587-1.416l-1.473-.294A1 1 0 0 1 1 11.18V8.82a1 1 0 0 1 .804-.98l1.473-.295c.144-.497.342-.971.587-1.416l-.834-1.25a1 1 0 0 1 .125-1.262l1.669-1.669a1 1 0 0 1 1.262-.125l1.25.834c.445-.245.919-.443 1.416-.587l.294-1.473ZM13 10a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <button id="btn-create-geschenk" class="py-2 px-4 bg-gradient-to-r from-pink-600 to-purple-500 text-white font-bold rounded-lg hover:shadow-lg transition text-sm whitespace-nowrap">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                </svg>
                                Neu
                            </button>
                        </div>
                    </div>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <!-- Header mit Dashboard -->
                <div class="bg-gradient-to-r from-pink-600 to-purple-500 text-white p-4 rounded-xl shadow-md mb-3">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-xl font-bold">🎁 Geschenkemanagement</h2>
                        <span class="text-xs bg-white/20 px-3 py-1 rounded-full">Management für Geschenke aller Anlässe</span>
                    </div>
                    
                    <!-- Statistiken -->
                    <div class="grid grid-cols-4 gap-2 text-center mb-3">
                        <div class="bg-white/20 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="gm-stat-total">0</p>
                            <p class="text-[10px] font-semibold leading-tight">📦 Gesamt</p>
                        </div>
                        <div class="bg-yellow-500/30 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="gm-stat-offen">0</p>
                            <p class="text-[10px] font-semibold leading-tight">⭕ Offen</p>
                        </div>
                        <div class="bg-blue-500/30 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="gm-stat-bestellt">0</p>
                            <p class="text-[10px] font-semibold leading-tight">📦 Bestellt</p>
                        </div>
                        <div class="bg-green-500/30 px-2 py-2 rounded-lg">
                            <p class="text-xl font-bold" id="gm-stat-abgeschlossen">0</p>
                            <p class="text-[10px] font-semibold leading-tight">✅ Fertig</p>
                        </div>
                    </div>

                    <!-- Kosten-Übersicht -->
                    <div class="bg-white/10 p-3 rounded-lg">
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div>
                                <p class="text-lg font-bold" id="gm-kosten-gesamt">0,00 €</p>
                                <p class="text-[10px]">Gesamtkosten</p>
                            </div>
                            <div>
                                <p class="text-lg font-bold text-green-300" id="gm-kosten-eigen">0,00 €</p>
                                <p class="text-[10px]">Eigene Kosten</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Personen-Übersicht -->
                <div class="bg-white rounded-lg shadow p-3 mb-3">
                    <h3 class="text-sm font-bold text-gray-700 mb-2">👥 Personen-Übersicht</h3>
                    <div id="gm-personen-uebersicht">
                        <p class="text-gray-500 text-sm text-center py-4">Lade Personen...</p>
                    </div>
                </div>

                <div class="flex justify-center mb-2">
                    <button id="gm-toggle-filter-controls"
                        class="text-gray-500 hover:text-pink-700 transition flex items-center gap-1 text-xs font-bold py-1 px-4 rounded-full hover:bg-pink-50">
                        <span>Filter & Kategorien</span>
                        <svg id="gm-toggle-filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 transform transition-transform">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- Such- und Filterleiste -->
                <div id="gm-filter-controls-wrapper" class="hidden mb-3 space-y-3">
                    <div class="filterbox-panel">
                        <div class="filter-box-title">Filterbox</div>
                        <div class="flex flex-wrap gap-2 mb-2 items-center">
                            <label class="flex items-center gap-2 px-3 py-2 bg-white border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition text-sm">
                                <input type="checkbox" id="gm-filter-negate" class="w-4 h-4 text-pink-600 rounded">
                                <span class="font-bold text-gray-700">NICHT</span>
                            </label>

                            <select id="gm-search-join-mode" class="p-2 border-2 border-gray-300 rounded-lg bg-white text-sm font-bold">
                                <option value="and" selected>AND</option>
                                <option value="or">OR</option>
                            </select>
                            
                            <div class="flex-1 min-w-[200px] relative">
                                <input type="text" id="gm-search-input" placeholder="🔍 Suchbegriff eingeben..." 
                                    class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-pink-500 focus:ring-2 focus:ring-pink-200 text-sm">
                                
                                <!-- Smart-Suggest Box (wie Zahlungsverwaltung) -->
                                <div id="gm-search-suggestions-box" class="hidden absolute z-30 bg-white border-2 border-pink-400 rounded-lg shadow-xl mt-1 w-full max-h-80 overflow-y-auto">
                                    <ul id="gm-search-suggestions-list" class="text-sm"></ul>
                                </div>
                            </div>
                            
                            <button id="gm-add-filter-btn" class="px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 font-bold transition text-sm">
                                ➕ Filter hinzufügen
                            </button>
                            
                            <button id="gm-reset-all-filters" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-bold transition text-sm">
                                ↺ Reset
                            </button>
                            
                            <button id="btn-export-selected" onclick="window.exportSelectedToExcel()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-bold transition text-sm opacity-50 cursor-not-allowed ml-auto" disabled title="Wähle Einträge zum Exportieren aus">
                                📊 Auswahl exportieren
                            </button>
                        </div>

                        <div id="gm-active-filters" class="flex flex-wrap gap-1 mt-2 empty:hidden">
                        </div>
                    </div>
                </div>

                <!-- Einträge-Tabelle -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-pink-50 border-b-2 border-pink-200">
                                <tr>
                                    <th class="px-2 py-3 text-center text-xs font-bold text-pink-800">
                                        <input type="checkbox" id="gm-select-all" class="w-4 h-4 rounded cursor-pointer" title="Alle auswählen/abwählen">
                                    </th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-pink-800 uppercase cursor-pointer hover:bg-pink-50 select-none" data-sort-key="status" onclick="sortGeschenkeBy('status')">Status</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-pink-800 uppercase cursor-pointer hover:bg-pink-50 select-none" data-sort-key="fuer" onclick="sortGeschenkeBy('fuer')">FÜR</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-pink-800 uppercase cursor-pointer hover:bg-pink-50 select-none" data-sort-key="von" onclick="sortGeschenkeBy('von')">VON</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-pink-800 uppercase">ID</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-pink-800 uppercase cursor-pointer hover:bg-pink-50 select-none" data-sort-key="geschenk" onclick="sortGeschenkeBy('geschenk')">Geschenk</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-pink-800 uppercase">Bezahlt von</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-pink-800 uppercase">Beteiligung</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-pink-800 uppercase cursor-pointer hover:bg-pink-50 select-none" data-sort-key="gesamtkosten" onclick="sortGeschenkeBy('gesamtkosten')">Gesamt</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-pink-800 uppercase cursor-pointer hover:bg-pink-50 select-none" data-sort-key="eigeneKosten" onclick="sortGeschenkeBy('eigeneKosten')">Eigen</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-pink-800 uppercase">SOLL</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-pink-800 uppercase">IST</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold text-pink-800 uppercase cursor-pointer hover:bg-pink-50 select-none" data-sort-key="standort" onclick="sortGeschenkeBy('standort')">Standort</th>
                                </tr>
                            </thead>
                            <tbody id="geschenke-table-body" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="13" class="px-4 py-8 text-center text-gray-400 italic">
                                        Keine Einträge vorhanden. Erstelle deinen ersten Geschenk-Eintrag!
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ========== GESCHENK MODAL ========== -->
            <div id="geschenkModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-[70] flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="bg-gradient-to-r from-pink-600 to-purple-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 id="geschenkModalTitle" class="text-xl font-bold">Neues Geschenk</h3>
                        <button id="closeGeschenkModal" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="p-6 space-y-4">
                        <input type="hidden" id="gm-id">
                        
                        <!-- Status -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Status</label>
                            <select id="gm-status" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500"></select>
                        </div>
                        
                        <!-- Geschenk & Shop -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Geschenk *</label>
                                <input type="text" id="gm-geschenk" placeholder="z.B. Dinner & Crime: Kurschatten" 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Shop</label>
                                <input type="text" id="gm-shop" placeholder="z.B. Amazon, crime-club.at" 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                            </div>
                        </div>
                        
                        <!-- FÜR (Empfänger) - Checkboxen -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">🎁 FÜR (Empfänger)</label>
                            <div id="gm-fuer-checkboxes" class="grid grid-cols-2 sm:grid-cols-3 gap-2 p-3 border-2 border-gray-300 rounded-lg bg-gray-50 max-h-32 overflow-y-auto">
                                <!-- Wird dynamisch befüllt -->
                            </div>
                        </div>
                        
                        <!-- VON (Schenker) - Checkboxen -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">🎀 VON (Schenker)</label>
                            <div id="gm-von-checkboxes" class="grid grid-cols-2 sm:grid-cols-3 gap-2 p-3 border-2 border-gray-300 rounded-lg bg-gray-50 max-h-32 overflow-y-auto">
                                <!-- Wird dynamisch befüllt -->
                            </div>
                        </div>
                        
                        <!-- Bezahlt von & Beteiligung - Gruppiert -->
                        <div class="p-4 border-2 border-purple-300 rounded-lg bg-purple-50/30">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">💳 Bezahlt von</label>
                                    <select id="gm-bezahlt-von" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500"></select>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">👥 (Finanz.) Beteiligungen</label>
                                    <div id="gm-beteiligung-checkboxes" class="grid grid-cols-2 gap-2 p-3 border-2 border-gray-300 rounded-lg bg-gray-50 max-h-24 overflow-y-auto">
                                        <!-- Wird dynamisch befüllt -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Kosten -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Gesamtkosten (€)</label>
                                <input type="number" step="0.01" id="gm-gesamtkosten" placeholder="0.00" 
                                    oninput="window.updateEigeneKostenAuto()" 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Eigene Kosten (€) <span id="gm-eigene-kosten-hint" class="text-xs text-blue-600"></span></label>
                                <input type="number" step="0.01" id="gm-eigene-kosten" placeholder="0.00" 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                                <!-- Kostenvorschlag -->
                                <div id="gm-kosten-vorschlag" style="display: none;" class="mt-2"></div>
                            </div>
                        </div>
                        
                        <!-- Zahlungsarten -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">SOLL-Bezahlung</label>
                                <select id="gm-soll-bezahlung" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500"></select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">IST-Bezahlung</label>
                                <select id="gm-ist-bezahlung" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500"></select>
                            </div>
                        </div>
                        
                        <!-- Bestellnummer & Rechnungsnummer -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Bestellnummer</label>
                                <input type="text" id="gm-bestellnummer" placeholder="Optional" 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Rechnungsnummer</label>
                                <input type="text" id="gm-rechnungsnummer" placeholder="Optional" 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                            </div>
                        </div>
                        
                        <!-- Standort -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Geschenke-Standort</label>
                            <select id="gm-standort" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500"></select>
                        </div>
                        
                        <!-- Notizen -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">📝 Notizen</label>
                            <textarea id="gm-notizen" rows="3" placeholder="Zusätzliche Notizen..." 
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500 resize-none"></textarea>
                        </div>
                    </div>
                    
                    <div class="sticky bottom-0 bg-gray-100 p-4 rounded-b-2xl flex justify-between gap-3">
                        <!-- Weitere Optionen Dropdown (Links) -->
                        <div class="relative">
                            <button id="gm-weitere-optionen-btn" onclick="window.toggleWeitereOptionen()" class="px-4 py-2 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-700 transition flex items-center gap-2">
                                ⚙️ Weitere Optionen
                                <span id="gm-dropdown-arrow">▼</span>
                            </button>
                            <div id="gm-weitere-optionen-dropdown" class="hidden absolute bottom-full left-0 mb-2 bg-white border-2 border-gray-300 rounded-lg shadow-xl z-10 min-w-[200px]">
                                <div class="p-2 space-y-1">
                                    <!-- Vorlage laden (nur bei NEUEM Eintrag) -->
                                    <button id="gm-dropdown-vorlage-laden" onclick="window.openVorlagenModal()" class="w-full px-3 py-2 bg-teal-500 text-white font-bold rounded hover:bg-teal-600 transition text-sm text-left" style="display: none;">
                                        📥 Vorlage laden
                                    </button>
                                    <!-- Bearbeiten-Button -->
                                    <button id="gm-dropdown-bearbeiten" onclick="window.enableEditMode()" class="w-full px-3 py-2 bg-orange-500 text-white font-bold rounded hover:bg-orange-600 transition text-sm text-left" style="display: none;">
                                        ✏️ Bearbeiten
                                    </button>
                                    <!-- Kopieren (nur bei bestehendem Eintrag) -->
                                    <button id="gm-dropdown-kopieren" onclick="window.copyGeschenk(document.getElementById('gm-id').value)" class="w-full px-3 py-2 bg-blue-500 text-white font-bold rounded hover:bg-blue-600 transition text-sm text-left" style="display: none;">
                                        📋 Kopieren
                                    </button>
                                    <!-- Vorlage speichern (nur bei bestehendem Eintrag) -->
                                    <button id="gm-dropdown-vorlage" onclick="window.saveAsVorlage(document.getElementById('gm-id').value)" class="w-full px-3 py-2 bg-purple-500 text-white font-bold rounded hover:bg-purple-600 transition text-sm text-left" style="display: none;">
                                        📑 Vorlage
                                    </button>
                                    <!-- Weitere Optionen Toggle -->
                                    <button id="gm-dropdown-toggle-delete" onclick="window.toggleDeleteOption()" class="w-full px-3 py-2 bg-yellow-500 text-white font-bold rounded hover:bg-yellow-600 transition text-sm text-left" style="display: none;">
                                        🔓 Weitere Optionen
                                    </button>
                                    <!-- Löschen (nur sichtbar nach Klick auf "Weitere Optionen") -->
                                    <button id="gm-dropdown-loeschen" onclick="window.deleteGeschenk(document.getElementById('gm-id').value)" class="w-full px-3 py-2 bg-red-500 text-white font-bold rounded hover:bg-red-600 transition text-sm text-left" style="display: none;">
                                        🗑️ Löschen
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Standard-Buttons Rechts -->
                        <div class="flex gap-2">
                            <button id="cancelGeschenkBtn" class="px-6 py-2 bg-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-400 transition">
                                Abbrechen
                            </button>
                            <button id="saveGeschenkBtn" class="px-6 py-2 bg-gradient-to-r from-pink-600 to-purple-500 text-white font-bold rounded-lg hover:shadow-lg transition">
                                💾 Speichern
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== GESCHENKE SETTINGS MODAL ========== -->
            <div id="geschenkeSettingsModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-pink-600 to-purple-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 class="text-xl font-bold">⚙️ Einstellungen</h3>
                        <button id="closeGeschenkeSettingsModal" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="p-6 space-y-6">
                        <!-- Tabs -->
                        <div class="flex border-b border-gray-200 gap-1">
                            <button onclick="showSettingsTab('kontaktbuch')" class="gm-settings-tab px-4 py-2 font-bold text-pink-600 border-b-2 border-pink-600" data-tab="kontaktbuch">👥 Kontaktbuch</button>
                            <button onclick="showSettingsTab('themen')" class="gm-settings-tab px-4 py-2 font-bold text-gray-500 hover:text-pink-600" data-tab="themen">📁 Themen</button>
                            <button onclick="showSettingsTab('optionen')" class="gm-settings-tab px-4 py-2 font-bold text-gray-500 hover:text-pink-600" data-tab="optionen">⚙️ Optionen</button>
                        </div>
                        
                        <!-- Kontaktbuch Tab -->
                        <div id="gm-tab-kontaktbuch" class="gm-settings-content">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-bold text-gray-800">Kontaktbuch</h4>
                                <button onclick="window.createNewKontakt()" class="text-sm bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700 transition font-bold">
                                    + Neuer Kontakt
                                </button>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">Verwalte alle Personen, die in deinem Geschenkemanagement vorkommen.</p>
                            <div id="gm-kontaktbuch-list" class="space-y-2 max-h-64 overflow-y-auto">
                                <p class="text-gray-500 text-center py-4">Lade Kontakte...</p>
                            </div>
                        </div>
                        
                        <!-- Themen Tab -->
                        <div id="gm-tab-themen" class="gm-settings-content hidden">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-bold text-gray-800">Themen (Anlässe)</h4>
                                <button onclick="window.createNewThema()" class="text-sm bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700 transition font-bold">
                                    + Neues Thema
                                </button>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">Erstelle Themen wie "Weihnachten 2025", "Geburtstage 2025" etc.</p>
                            <div id="gm-themen-list" class="space-y-2 max-h-64 overflow-y-auto">
                                <p class="text-gray-500 text-center py-4">Lade Themen...</p>
                            </div>
                        </div>
                        
                        <!-- Optionen Tab -->
                        <div id="gm-tab-optionen" class="gm-settings-content hidden">
                            <h4 class="font-bold text-gray-800 mb-4">Optionen verwalten</h4>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <!-- Status-Optionen -->
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <h5 class="font-bold text-sm text-gray-700 mb-2">Status-Optionen</h5>
                                    <div id="gm-status-optionen" class="space-y-1 max-h-40 overflow-y-auto mb-2"></div>
                                    <input type="text" id="gm-new-status" placeholder="Neuer Status..." class="w-full p-2 border rounded text-sm">
                                    <button onclick="addCustomOption('status')" class="w-full mt-1 p-1 bg-pink-500 text-white rounded text-sm">+ Hinzufügen</button>
                                </div>
                                
                                <!-- Zahlungsarten (vereinheitlicht für SOLL und IST) -->
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <h5 class="font-bold text-sm text-gray-700 mb-2">Zahlungsarten</h5>
                                    <p class="text-xs text-gray-500 mb-2">Wird für SOLL- und IST-Bezahlung verwendet</p>
                                    <div id="gm-zahlungsarten-optionen" class="space-y-1 max-h-40 overflow-y-auto mb-2"></div>
                                    <input type="text" id="gm-new-zahlungsarten" placeholder="Neue Zahlungsart..." class="w-full p-2 border rounded text-sm">
                                    <button onclick="addCustomOption('zahlungsarten')" class="w-full mt-1 p-1 bg-pink-500 text-white rounded text-sm">+ Hinzufügen</button>
                                </div>
                                
                                <!-- Standorte -->
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <h5 class="font-bold text-sm text-gray-700 mb-2">Geschenke-Standorte</h5>
                                    <div id="gm-standort-optionen" class="space-y-1 max-h-40 overflow-y-auto mb-2"></div>
                                    <input type="text" id="gm-new-standort" placeholder="Neuer Standort..." class="w-full p-2 border rounded text-sm">
                                    <button onclick="addCustomStandort()" class="w-full mt-1 p-1 bg-pink-500 text-white rounded text-sm">+ Hinzufügen</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sticky bottom-0 bg-gray-100 p-4 rounded-b-2xl flex justify-end">
                        <button onclick="document.getElementById('geschenkeSettingsModal').style.display='none'" class="px-6 py-2 bg-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-400 transition">
                            Schließen
                        </button>
                    </div>
                </div>
            </div>

            <script>
                function showSettingsTab(tabName) {
                    document.querySelectorAll('.gm-settings-content').forEach(el => el.classList.add('hidden'));
                    document.querySelectorAll('.gm-settings-tab').forEach(el => {
                        el.classList.remove('text-pink-600', 'border-b-2', 'border-pink-600');
                        el.classList.add('text-gray-500');
                    });
                    document.getElementById('gm-tab-' + tabName).classList.remove('hidden');
                    document.querySelector('[data-tab="' + tabName + '"]').classList.add('text-pink-600', 'border-b-2', 'border-pink-600');
                    document.querySelector('[data-tab="' + tabName + '"]').classList.remove('text-gray-500');
                }
            </script>

            <!-- ========== HAUSHALTSZAHLUNG MODAL ========== -->
            <div id="haushaltszahlungModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-cyan-600 to-teal-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 id="haushaltszahlungModalTitle" class="text-xl font-bold">Neuer Eintrag</h3>
                        <button id="closeHaushaltszahlungModal" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="p-6 space-y-4">
                        <input type="hidden" id="hz-id">
                        
                        <!-- Zweck & Organisation mit Autocomplete -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="relative">
                                <label class="block text-sm font-bold text-gray-700 mb-1">Zahlungszweck *</label>
                                <input type="text" id="hz-zweck" list="hz-zweck-list" placeholder="z.B. Miete, Strom, Internet..." 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500" autocomplete="off">
                                <datalist id="hz-zweck-list">
                                    <!-- Wird dynamisch befüllt -->
                                </datalist>
                            </div>
                            <div class="relative">
                                <label class="block text-sm font-bold text-gray-700 mb-1">Organisation *</label>
                                <input type="text" id="hz-organisation" list="hz-organisation-list" placeholder="z.B. Stadtwerke, Telekom..." 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500" autocomplete="off">
                                <datalist id="hz-organisation-list">
                                    <!-- Wird dynamisch befüllt -->
                                </datalist>
                            </div>
                        </div>
                        
                        <!-- Betrag -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Betrag (€) <span class="text-xs text-gray-500">(negativ = Gutschrift, 0 = Gratis)</span></label>
                            <input type="text" 
                                id="hz-betrag" 
                                inputmode="decimal"
                                placeholder="z.B. 9.99 oder -5.00 für Gutschrift" 
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500"
                                oninput="window.updateBetragHinweis(this)"
                                onkeypress="return window.allowNumberInput(event)">
                            <!-- Explizite Validierung erlaubt: 0-9, Punkt, Minus, Komma -->
                            
                            <!-- Hinweis wenn Betrag fehlt -->
                            <div id="hz-betrag-hinweis" class="mt-2 p-2 bg-yellow-50 border border-yellow-300 rounded text-xs text-yellow-800 hidden">
                                <div class="flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                    <div>
                                        <strong>Betrag noch unbekannt?</strong>
                                        <p class="text-xs mt-0.5">Für Gratis-Monate gib bitte <strong>0</strong> ein. Lass das Feld nur leer, wenn der Betrag wirklich noch unbekannt ist.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Intervall -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="mb-3">
                                <label class="text-sm font-bold text-gray-700">Zahlungsintervall * <span class="text-xs text-gray-500">(Monatlich ODER einzelne Monate)</span></label>
                            </div>
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <label class="flex items-center gap-2 p-3 bg-cyan-100 rounded-lg border-2 border-cyan-300 cursor-pointer hover:bg-cyan-200">
                                    <input type="checkbox" value="monatlich" class="hz-intervall-checkbox w-5 h-5">
                                    <span class="font-bold text-cyan-800">📅 Monatlich (jeden Monat)</span>
                                </label>
                                <div class="p-3 bg-gray-100 rounded-lg text-xs text-gray-600">
                                    <p class="font-bold">💡 Tipp:</p>
                                    <p>Wähle "Monatlich" für wiederkehrende Zahlungen oder einzelne Monate für einmalige Jahreskosten.</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-6 gap-2 text-center text-xs">
                                <label class="flex flex-col items-center p-2 bg-white rounded-lg border cursor-pointer hover:bg-cyan-50">
                                    <input type="checkbox" value="januar" class="hz-intervall-checkbox mb-1">
                                    <span>Jan</span>
                                </label>
                                <label class="flex flex-col items-center p-2 bg-white rounded-lg border cursor-pointer hover:bg-cyan-50">
                                    <input type="checkbox" value="februar" class="hz-intervall-checkbox mb-1">
                                    <span>Feb</span>
                                </label>
                                <label class="flex flex-col items-center p-2 bg-white rounded-lg border cursor-pointer hover:bg-cyan-50">
                                    <input type="checkbox" value="maerz" class="hz-intervall-checkbox mb-1">
                                    <span>Mär</span>
                                </label>
                                <label class="flex flex-col items-center p-2 bg-white rounded-lg border cursor-pointer hover:bg-cyan-50">
                                    <input type="checkbox" value="april" class="hz-intervall-checkbox mb-1">
                                    <span>Apr</span>
                                </label>
                                <label class="flex flex-col items-center p-2 bg-white rounded-lg border cursor-pointer hover:bg-cyan-50">
                                    <input type="checkbox" value="mai" class="hz-intervall-checkbox mb-1">
                                    <span>Mai</span>
                                </label>
                                <label class="flex flex-col items-center p-2 bg-white rounded-lg border cursor-pointer hover:bg-cyan-50">
                                    <input type="checkbox" value="juni" class="hz-intervall-checkbox mb-1">
                                    <span>Jun</span>
                                </label>
                                <label class="flex flex-col items-center p-2 bg-white rounded-lg border cursor-pointer hover:bg-cyan-50">
                                    <input type="checkbox" value="juli" class="hz-intervall-checkbox mb-1">
                                    <span>Jul</span>
                                </label>
                                <label class="flex flex-col items-center p-2 bg-white rounded-lg border cursor-pointer hover:bg-cyan-50">
                                    <input type="checkbox" value="august" class="hz-intervall-checkbox mb-1">
                                    <span>Aug</span>
                                </label>
                                <label class="flex flex-col items-center p-2 bg-white rounded-lg border cursor-pointer hover:bg-cyan-50">
                                    <input type="checkbox" value="september" class="hz-intervall-checkbox mb-1">
                                    <span>Sep</span>
                                </label>
                                <label class="flex flex-col items-center p-2 bg-white rounded-lg border cursor-pointer hover:bg-cyan-50">
                                    <input type="checkbox" value="oktober" class="hz-intervall-checkbox mb-1">
                                    <span>Okt</span>
                                </label>
                                <label class="flex flex-col items-center p-2 bg-white rounded-lg border cursor-pointer hover:bg-cyan-50">
                                    <input type="checkbox" value="november" class="hz-intervall-checkbox mb-1">
                                    <span>Nov</span>
                                </label>
                                <label class="flex flex-col items-center p-2 bg-white rounded-lg border cursor-pointer hover:bg-cyan-50">
                                    <input type="checkbox" value="dezember" class="hz-intervall-checkbox mb-1">
                                    <span>Dez</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Gültigkeit -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Gültig AB *</label>
                                <input type="date" id="hz-gueltig-ab" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Gültig BIS <span class="text-xs text-gray-500 font-normal">(leer = fortlaufend)</span></label>
                                <input type="date" id="hz-gueltig-bis" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500">
                            </div>
                        </div>
                        
                        <!-- Kostenaufteilung (Dynamisch basierend auf Themen-Mitgliedern) -->
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg">
                            <label class="block text-sm font-bold text-gray-700 mb-3">📊 Kostenaufteilung * (muss 100% ergeben)</label>
                            <div id="hz-kostenaufteilung-inputs" class="space-y-3">
                                <!-- Wird dynamisch basierend auf Themen-Mitgliedern gefüllt -->
                            </div>
                            <div id="hz-kostenaufteilung-summe" class="mt-3 p-2 rounded text-sm font-bold text-center">
                                <!-- Zeigt Summe und Validierung -->
                            </div>
                        </div>
                        
                        <!-- Zusätzliche Infos -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Kundennummer</label>
                                <input type="text" id="hz-kundennummer" placeholder="Optional" 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Vertragsnummer</label>
                                <input type="text" id="hz-vertragsnummer" placeholder="Optional" 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Vormerkung</label>
                                <input type="text" id="hz-vormerk" placeholder="Optional" 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Erinnerung</label>
                                <input type="date" id="hz-erinnerung" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500">
                            </div>
                        </div>
                        
                        <!-- Notizen -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">📝 Notizen</label>
                            <textarea id="hz-notizen" rows="3" placeholder="Zusätzliche Notizen zu diesem Eintrag..." 
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500 resize-none"></textarea>
                        </div>
                    </div>
                    
                    <div class="sticky bottom-0 bg-gray-100 p-4 rounded-b-2xl flex justify-between gap-3">
                        <!-- Abtausch-Button (nur bei aktiven Einträgen sichtbar) -->
                        <button id="hz-abtausch-btn" class="px-4 py-2 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition hidden" title="Eintrag abtauschen">
                            🔄 Abtausch
                        </button>
                        <div class="flex gap-3">
                            <button id="cancelHaushaltszahlungBtn" class="px-6 py-2 bg-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-400 transition">
                                Abbrechen
                            </button>
                            <button id="saveHaushaltszahlungBtn" class="px-6 py-2 bg-gradient-to-r from-cyan-600 to-teal-500 text-white font-bold rounded-lg hover:shadow-lg transition">
                                Speichern
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== HAUSHALTSZAHLUNGEN SETTINGS MODAL ========== -->
            <div id="haushaltszahlungenSettingsModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-cyan-600 to-teal-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 class="text-xl font-bold">⚙️ Einstellungen</h3>
                        <button id="closeHaushaltszahlungenSettingsModal" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="p-6 space-y-6">
                        <!-- Themen-Verwaltung -->
                        <div class="bg-cyan-50 p-4 rounded-lg border-2 border-cyan-200">
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="font-bold text-cyan-800">🏠 Themen (Arbeitsbereiche)</h4>
                                <button id="hz-add-thema-btn" class="text-xs bg-cyan-600 text-white px-3 py-1 rounded-lg hover:bg-cyan-700 transition font-bold">
                                    + Neues Thema
                                </button>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">Verwalte verschiedene Haushalte oder Arbeitsbereiche separat.</p>
                            <div id="hz-themen-liste" class="space-y-2">
                                <!-- Wird dynamisch gefüllt -->
                            </div>
                        </div>

                        <!-- Mitglieder des aktuellen Themas -->
                        <div class="bg-purple-50 p-4 rounded-lg border-2 border-purple-200">
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="font-bold text-purple-800">👥 Mitglieder (aktuelles Thema)</h4>
                                <button id="hz-add-mitglied-btn" class="text-xs bg-purple-600 text-white px-3 py-1 rounded-lg hover:bg-purple-700 transition font-bold">
                                    + Person hinzufügen
                                </button>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">Füge registrierte Benutzer hinzu, die an diesem Haushalt mitwirken.</p>
                            <div id="hz-mitglieder-liste" class="space-y-2">
                                <!-- Wird dynamisch gefüllt -->
                            </div>
                        </div>

                        <!-- Kostenaufteilung wurde entfernt - wird individuell pro Eintrag definiert -->
                    </div>
                    
                    <div class="sticky bottom-0 bg-gray-100 p-4 rounded-b-2xl flex justify-end gap-3">
                        <button id="saveHaushaltszahlungenSettingsBtn" class="px-6 py-2 bg-gradient-to-r from-cyan-600 to-teal-500 text-white font-bold rounded-lg hover:shadow-lg transition">
                            Speichern
                        </button>
                    </div>
                </div>
            </div>

            <!-- ========== ALARME MODAL ========== -->
            <div id="hz-alarme-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[80vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-red-500 to-orange-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 class="text-xl font-bold">⚠️ Alarme</h3>
                        <button onclick="document.getElementById('hz-alarme-modal').style.display='none'" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div id="hz-alarme-content" class="p-4 space-y-3">
                        <!-- Wird dynamisch gefüllt -->
                    </div>
                </div>
            </div>

            <!-- ========== DAUERAUFTRÄGE MODAL ========== -->
            <div id="hz-dauerauftraege-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-blue-600 to-indigo-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 class="text-xl font-bold">💳 Daueraufträge</h3>
                        <button onclick="document.getElementById('hz-dauerauftraege-modal').style.display='none'" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="p-4">
                        <p class="text-sm text-gray-600 mb-4">Gib die Beträge deiner 13 Daueraufträge an das Haushaltskonto ein:</p>
                        <div id="hz-dauerauftraege-content" class="space-y-3">
                            <!-- Wird dynamisch gefüllt -->
                        </div>
                        <div id="hz-dauerauftraege-protokoll" class="mt-4 border-t pt-4 hidden">
                            <h4 class="font-bold text-gray-700 mb-2">📋 Änderungsprotokoll</h4>
                            <div id="hz-protokoll-liste" class="text-xs space-y-1 max-h-40 overflow-y-auto">
                                <!-- Wird dynamisch gefüllt -->
                            </div>
                        </div>
                    </div>
                    <div class="sticky bottom-0 bg-gray-100 p-4 rounded-b-2xl flex justify-between">
                        <button id="hz-show-protokoll-btn" class="text-xs text-gray-600 hover:text-gray-800">
                            📋 Protokoll anzeigen
                        </button>
                        <button id="hz-save-dauerauftraege-btn" class="px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-500 text-white font-bold rounded-lg hover:shadow-lg transition">
                            Speichern
                        </button>
                    </div>
                </div>
            </div>

            <!-- ========== MITGLIED HINZUFÜGEN MODAL ========== -->
            <div id="hz-add-mitglied-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
                    <div class="bg-gradient-to-r from-purple-600 to-pink-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 class="text-xl font-bold">👤 Mitglied hinzufügen</h3>
                        <button onclick="document.getElementById('hz-add-mitglied-modal').style.display='none'" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Benutzer auswählen</label>
                            <select id="hz-mitglied-user-select" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                                <option value="">Benutzer wählen...</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Zugriffsrecht</label>
                            <select id="hz-mitglied-recht-select" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                                <option value="nicht_teilen">🔒 Nicht teilen (nur kalkulieren)</option>
                                <option value="lesen">👁️ Nur Lesen</option>
                                <option value="eigene">✏️ Eigene Zahlung ändern</option>
                                <option value="vollzugriff">🔓 Vollzugriff</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">
                                <strong>Nicht teilen:</strong> Person wird nur zur Kalkulation verwendet, erhält keinen Zugriff<br>
                                <strong>Nur Lesen:</strong> Kann nur ansehen<br>
                                <strong>Eigene Zahlung:</strong> Kann eigene Daueraufträge ändern<br>
                                <strong>Vollzugriff:</strong> Kann alles bearbeiten
                            </p>
                        </div>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-b-2xl flex justify-end gap-3">
                        <button onclick="document.getElementById('hz-add-mitglied-modal').style.display='none'" class="px-4 py-2 bg-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-400 transition">
                            Abbrechen
                        </button>
                        <button id="hz-save-mitglied-btn" class="px-6 py-2 bg-gradient-to-r from-purple-600 to-pink-500 text-white font-bold rounded-lg hover:shadow-lg transition">
                            Hinzufügen
                        </button>
                    </div>
                </div>
            </div>

            <!-- ========== THEMA HINZUFÜGEN MODAL ========== -->
            <div id="hz-add-thema-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
                    <div class="bg-gradient-to-r from-cyan-600 to-teal-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 class="text-xl font-bold">🏠 Neues Thema</h3>
                        <button onclick="document.getElementById('hz-add-thema-modal').style.display='none'" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Thema-Name</label>
                            <input type="text" id="hz-thema-name" placeholder="z.B. Haushalt 2, Ferienhaus..." 
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-cyan-500">
                        </div>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-b-2xl flex justify-end gap-3">
                        <button onclick="document.getElementById('hz-add-thema-modal').style.display='none'" class="px-4 py-2 bg-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-400 transition">
                            Abbrechen
                        </button>
                        <button id="hz-save-thema-btn" class="px-6 py-2 bg-gradient-to-r from-cyan-600 to-teal-500 text-white font-bold rounded-lg hover:shadow-lg transition">
                            Erstellen
                        </button>
                    </div>
                </div>
            </div>

            <!-- ========== EINLADUNGEN MODAL ========== -->
            <div id="hz-einladungen-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[80vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-purple-600 to-pink-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 class="text-xl font-bold">📬 Einladungen</h3>
                        <button onclick="document.getElementById('hz-einladungen-modal').style.display='none'" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="p-6">
                        <div id="hz-einladungen-liste">
                            <p class="text-gray-500 text-sm italic">Keine Einladungen vorhanden</p>
                        </div>
                    </div>
                    <div class="sticky bottom-0 bg-gray-100 p-4 rounded-b-2xl flex justify-end">
                        <button onclick="document.getElementById('hz-einladungen-modal').style.display='none'" class="px-6 py-2 bg-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-400 transition">
                            Schließen
                        </button>
                    </div>
                </div>
            </div>

            <!-- ========== ABTAUSCH MODAL ========== -->
            <div id="hz-abtausch-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-gradient-to-r from-purple-600 to-indigo-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
                        <h3 class="text-xl font-bold">🔄 Zahlung abtauschen</h3>
                        <button onclick="window.closeAbtauschModal()" class="text-white/80 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="p-6">
                        <!-- Alter Eintrag Info -->
                        <div class="bg-gray-100 rounded-lg p-4 mb-4">
                            <h4 class="font-bold text-gray-700 mb-2">📋 Aktueller Eintrag (wird beendet)</h4>
                            <div class="grid grid-cols-3 gap-2 text-sm">
                                <div>
                                    <span class="text-gray-500">Zweck:</span>
                                    <span id="hz-abtausch-alter-zweck" class="font-medium">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Betrag:</span>
                                    <span id="hz-abtausch-alter-betrag" class="font-medium">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Gültigkeit:</span>
                                    <span id="hz-abtausch-alter-gueltig" class="font-medium">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Datumsfelder -->
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">📅 Neuer Beginn *</label>
                                <input type="date" id="hz-abtausch-neuer-beginn" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">📅 Alter Eintrag endet am</label>
                                <input type="date" id="hz-abtausch-altes-ende" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                                <p class="text-xs text-gray-500 mt-1">Wird automatisch berechnet (Tag vor neuem Beginn)</p>
                            </div>
                        </div>

                        <hr class="my-4">
                        <h4 class="font-bold text-gray-700 mb-3">✨ Neuer Eintrag (Werte anpassen)</h4>

                        <!-- Neue Werte -->
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Zahlungszweck</label>
                                <input type="text" id="hz-abtausch-zweck" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Organisation</label>
                                <input type="text" id="hz-abtausch-organisation" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">💰 Neuer Betrag *</label>
                                <input type="number" step="0.01" id="hz-abtausch-betrag" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Anteil Markus %</label>
                                <input type="number" min="0" max="100" id="hz-abtausch-anteil" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Kundennummer</label>
                                <input type="text" id="hz-abtausch-kundennummer" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-bold text-gray-700 mb-1">Vertragsnummer</label>
                            <input type="text" id="hz-abtausch-vertragsnummer" class="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                        </div>

                        <!-- Intervall -->
                        <div class="mb-4">
                            <label class="block text-sm font-bold text-gray-700 mb-2">📆 Intervall</label>
                            <p class="text-xs text-gray-500 mb-2">Entweder "Monatlich" ODER einzelne Monate auswählen</p>
                            <div class="grid grid-cols-4 gap-2">
                                <label class="flex items-center gap-2 p-2 bg-cyan-50 rounded-lg hover:bg-cyan-100 cursor-pointer border-2 border-cyan-200">
                                    <input type="checkbox" value="monatlich" class="hz-abtausch-intervall rounded" data-type="monatlich">
                                    <span class="text-sm font-bold">Monatlich</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer hz-abtausch-einzelmonat">
                                    <input type="checkbox" value="januar" class="hz-abtausch-intervall rounded" data-type="einzelmonat">
                                    <span class="text-sm">Jänner</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer hz-abtausch-einzelmonat">
                                    <input type="checkbox" value="februar" class="hz-abtausch-intervall rounded" data-type="einzelmonat">
                                    <span class="text-sm">Februar</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer hz-abtausch-einzelmonat">
                                    <input type="checkbox" value="maerz" class="hz-abtausch-intervall rounded" data-type="einzelmonat">
                                    <span class="text-sm">März</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer hz-abtausch-einzelmonat">
                                    <input type="checkbox" value="april" class="hz-abtausch-intervall rounded" data-type="einzelmonat">
                                    <span class="text-sm">April</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer hz-abtausch-einzelmonat">
                                    <input type="checkbox" value="mai" class="hz-abtausch-intervall rounded" data-type="einzelmonat">
                                    <span class="text-sm">Mai</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer hz-abtausch-einzelmonat">
                                    <input type="checkbox" value="juni" class="hz-abtausch-intervall rounded" data-type="einzelmonat">
                                    <span class="text-sm">Juni</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer hz-abtausch-einzelmonat">
                                    <input type="checkbox" value="juli" class="hz-abtausch-intervall rounded" data-type="einzelmonat">
                                    <span class="text-sm">Juli</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer hz-abtausch-einzelmonat">
                                    <input type="checkbox" value="august" class="hz-abtausch-intervall rounded" data-type="einzelmonat">
                                    <span class="text-sm">August</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer hz-abtausch-einzelmonat">
                                    <input type="checkbox" value="september" class="hz-abtausch-intervall rounded" data-type="einzelmonat">
                                    <span class="text-sm">September</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer hz-abtausch-einzelmonat">
                                    <input type="checkbox" value="oktober" class="hz-abtausch-intervall rounded" data-type="einzelmonat">
                                    <span class="text-sm">Oktober</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer hz-abtausch-einzelmonat">
                                    <input type="checkbox" value="november" class="hz-abtausch-intervall rounded" data-type="einzelmonat">
                                    <span class="text-sm">November</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer hz-abtausch-einzelmonat">
                                    <input type="checkbox" value="dezember" class="hz-abtausch-intervall rounded" data-type="einzelmonat">
                                    <span class="text-sm">Dezember</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Notizen -->
                        <div class="mb-4">
                            <label class="block text-sm font-bold text-gray-700 mb-1">📝 Notizen</label>
                            <textarea id="hz-abtausch-notizen" rows="3" placeholder="Zusätzliche Notizen zum neuen Eintrag..." 
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 resize-none"></textarea>
                        </div>
                    </div>
                    <div class="sticky bottom-0 bg-gray-100 p-4 rounded-b-2xl flex justify-end gap-3">
                        <button onclick="window.closeAbtauschModal()" class="px-6 py-2 bg-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-400 transition">
                            Abbrechen
                        </button>
                        <button onclick="window.saveAbtausch()" class="px-6 py-2 bg-gradient-to-r from-purple-600 to-indigo-500 text-white font-bold rounded-lg hover:opacity-90 transition">
                            🔄 Abtausch speichern
                        </button>
                    </div>
                </div>
            </div>

            <div id="terminplanerView" class="view">

                <div id="terminplaner-main-view">
                    <div class="back-link-container w-full mb-4">
                        <div class="flex justify-between items-center">
                            <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                                data-target="home">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                    stroke-linejoin="round" class="w-5 h-5 mr-1">
                                    <path d="m15 18-6-6 6-6" />
                                </svg>
                                <span class="text-sm font-semibold">zurück</span>
                            </button>

                            <button id="show-create-vote-modal-btn"
                                class="py-2 px-4 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition shadow-sm flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                    class="w-5 h-5">
                                    <path
                                        d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                </svg>
                                Neuen Termin
                            </button>
                        </div>
                        <div class="border-t border-gray-300 mt-2"></div>
                    </div>
                    <div class="flex justify-center mb-4">
                        <div
                            class="p-3 bg-gray-100 border border-gray-300 rounded-lg inline-flex flex-wrap gap-x-4 gap-y-2 justify-center">

                            <div class="flex items-center gap-2">
                                <span class="text-sm font-semibold text-gray-700">Direkt-URL (Startseite):</span>
                                <input type="text" id="main-share-url"
                                    class="text-sm text-gray-900 bg-gray-200 p-1 rounded-md flex-grow w-32" readonly>
                                <button id="copy-main-url-btn" title="URL kopieren"
                                    class="p-1 rounded-md hover:bg-gray-200 transition">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                        class="w-5 h-5 text-gray-500">
                                        <path d="M8 3a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2H9a1 1 0 0 1-1-1Z" />
                                        <path
                                            d="M4 3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h5.5a.5.5 0 0 1 0 1H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h5.5a.5.5 0 0 1 0 1H4Z" />
                                        <path
                                            d="M9 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5-.5h-5a.5.5 0 0 1-.5-.5v-5ZM10 8v4h4V8h-4Z" />
                                    </svg>
                                </button>
                            </div>

                        </div>
                    </div>
                    <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-indigo-500 mb-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">An Umfrage teilnehmen</h3>
                        <p class="text-sm text-gray-600 mb-4">Gib den 8-stelligen Token ein (z.B. A1B2 - C3D4), um an
                            einer privaten Umfrage teilzunehmen.</p>

                        <div class="flex flex-col sm:flex-row gap-2">
                            <input type="text" id="vote-token-input"
                                class="flex-grow p-3 border-2 border-gray-300 rounded-lg text-center tracking-widest text-lg font-mono uppercase focus:ring-indigo-500 focus:border-indigo-500"
                                placeholder="XXXX - XXXX" maxlength="11">
                            <button id="join-vote-by-token-btn"
                                class="py-3 px-5 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition flex items-center justify-center">
                                <span class="button-text">Teilnehmen</span>
                                <div class="loading-spinner"></div>
                            </button>
                        </div>
                    </div>

                    <div id="outstanding-votes-summary"
                        class="hidden p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded-lg">
                    </div>

                    <hr class="my-6 border-t-2 border-gray-800">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                        <div class="flex flex-col">
                            <h3 class="text-xl font-bold text-gray-800 mb-3">Mir zugewiesen</h3>
                            <div id="assigned-votes-list" class="space-y-3">
                            </div>
                        </div>

                        <div class="flex flex-col">
                            <h3 class="text-xl font-bold text-gray-800 mb-3">Öffentliche Umfragen</h3>
                            <div id="public-votes-list" class="space-y-3">
                            </div>
                        </div>

                        <div class="flex flex-col">
                            <h3 class="text-xl font-bold text-gray-800 mb-3">Von mir erstellt</h3>
                            <div id="created-votes-list" class="space-y-3">
                            </div>
                        </div>

                        <div class="flex flex-col">
                            <h3 class="text-xl font-bold text-gray-800 mb-3">Vergangene Umfragen</h3>
                            <div id="past-votes-list" class="space-y-3">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="terminplaner-create-view" class="hidden">
                    <div class="mb-4">
                        <div class="flex justify-between items-center">
                            <h2 class="text-2xl font-bold text-gray-800">Neue Gruppenumfrage</h2>
                            <button id="cancel-vote-creation-btn"
                                class="py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition">
                                Abbrechen
                            </button>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">Finde den besten Termin für deine Gruppe.</p>
                    </div>

                    <div class="card bg-white p-4 rounded-xl shadow-lg mb-6 space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-2 md:items-center">
                            <label for="vote-title" class="block text-sm font-bold text-gray-700">Titel der
                                Umfrage</label>
                            <input type="text" id="vote-title"
                                class="w-full p-2 border border-gray-300 rounded-lg md:col-span-3"
                                placeholder="z.B. Nächstes Team-Meeting">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-2">
                            <label for="vote-description" class="block text-sm font-bold text-gray-700">Beschreibung
                                (Optional)</label>
                            <textarea id="vote-description" rows="2"
                                class="w-full p-2 border border-gray-300 rounded-lg md:col-span-3"
                                placeholder="z.B. Themen: Projekt-Update, Budget..."></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-2 md:items-center">
                            <label for="vote-location" class="block text-sm font-bold text-gray-700">Ort
                                (Optional)</label>
                            <input type="text" id="vote-location"
                                class="w-full p-2 border border-gray-300 rounded-lg md:col-span-3"
                                placeholder="z.B. Konferenzraum 1 oder Online">
                        </div>
                    </div>

                    <div class="card bg-white p-4 rounded-xl shadow-lg mb-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-3">Termine vorschlagen</h3>
                        <div id="vote-dates-container" class="space-y-4">
                        </div>
                        <button id="vote-add-date-btn"
                            class="w-full mt-4 py-2 bg-blue-100 text-blue-700 font-semibold rounded-lg hover:bg-blue-200 transition hidden">
                            + Tag hinzufügen
                        </button>
                    </div>

                    <div class="card bg-white p-4 rounded-xl shadow-lg mb-6 space-y-4">
                        <h3 class="text-lg font-bold text-gray-800 mb-1">Gültigkeitszeitraum der Umfrage</h3>
                        <p class="text-xs text-gray-500 mb-3">Lege fest, von wann bis wann abgestimmt werden kann.</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="vote-start-time" class="block text-sm font-medium text-gray-700">Startet
                                    am</label>
                                <input type="datetime-local" id="vote-start-time"
                                    class="w-full p-2 border rounded-lg mt-1">
                            </div>
                            <div>
                                <label for="vote-end-time" class="block text-sm font-medium text-gray-700">Endet
                                    am</label>
                                <input type="datetime-local" id="vote-end-time"
                                    class="w-full p-2 border rounded-lg mt-1 disabled:bg-gray-100 disabled:cursor-not-allowed">
                                <label class="flex items-center gap-2 mt-2">
                                    <input type="checkbox" id="vote-end-time-unlimited" class="h-4 w-4 rounded">
                                    <span class="text-sm text-gray-600">Unbegrenzt (offen lassen)</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-white p-4 rounded-xl shadow-lg mb-6 space-y-4">
                        <h3 class="text-lg font-bold text-gray-800 mb-1">Einstellungen</h3>

                        <div class="p-2 bg-gray-50 rounded-lg">
                            <label class="block font-semibold text-gray-700">Teilnehmer zuweisen</label>
                            <p class="text-xs text-gray-500 mb-2">Nur zugewiesene Personen (mit Konto) sehen diese
                                Umfrage in ihrer Liste.</p>
                            <div class="flex items-center gap-2 p-2 bg-white border rounded-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                    class="w-5 h-5 text-gray-400 flex-shrink-0">
                                    <path
                                        d="M10 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM3.468 11.69A5.022 5.022 0 0 1 7.5 10h5a5.022 5.022 0 0 1 4.032 1.69l.966 1.616A2.25 2.25 0 0 1 15.53 15H4.47a2.25 2.25 0 0 1-1.968-1.694l.966-1.616Z" />
                                </svg>
                                <span id="vote-assigned-users-display" class="flex-grow text-sm text-gray-600 truncate"
                                    title="Niemand ausgewählt">Niemand ausgewählt</span>
                                <button id="vote-show-assign-user-modal-btn"
                                    class="py-1 px-3 bg-blue-100 text-blue-600 text-sm font-semibold rounded-lg hover:bg-blue-200 transition flex-shrink-0">
                                    Auswählen
                                </button>
                            </div>
                        </div>
                        <label class="flex items-center gap-3 p-2 bg-gray-50 rounded-lg cursor-pointer">
                            <input type="checkbox" id="vote-setting-public" class="h-5 w-5 rounded">
                            <div>
                                <span class="font-semibold text-gray-700">Öffentliche Umfrage</span>
                                <p class="text-xs text-gray-500">Jeder (auch ohne Link) kann diese Umfrage in der
                                    App sehen und teilnehmen.</p>
                            </div>
                        </label>
                        <div class="p-2 bg-gray-50 rounded-lg flex flex-col md:flex-row gap-3">
                            <label class="flex items-center gap-3 cursor-pointer flex-shrink-0">
                                <input type="checkbox" id="vote-setting-anonymous" class="h-5 w-5 rounded">
                                <div>
                                    <span class="font-semibold text-gray-700">Anonyme Umfrage</span>
                                    <p class="text-xs text-gray-500">Teilnehmer müssen keinen Namen eingeben.</p>
                                </div>
                            </label>

                            <div id="vote-setting-anonymous-mode-wrapper" class="hidden flex-grow">
                                <select id="vote-setting-anonymous-mode"
                                    class="w-full p-2 border border-gray-300 rounded-lg bg-white">
                                    <option value="erzwingen" selected>Erzwingen (Alle sind "Anonym")</option>
                                    <option value="ermöglichen">Ermöglichen (Jeder kann "Anonym" wählen)</option>
                                </select>
                            </div>
                        </div>
                        <label class="flex items-center gap-3 p-2 bg-gray-50 rounded-lg cursor-pointer">
                            <input type="checkbox" id="vote-setting-disable-maybe" class="h-5 w-5 rounded">
                            <div>
                                <span class="font-semibold text-gray-700">"Vielleicht"-Option deaktivieren</span>
                                <p class="text-xs text-gray-500">Erlaube nur "Ja" oder "Nein" als Antwort.</p>
                            </div>
                        </label>
                        <div class="p-2 bg-gray-50 rounded-lg flex flex-col md:flex-row gap-3">
                            <label class="flex items-center gap-3 cursor-pointer flex-shrink-0">
                                <input type="checkbox" id="vote-setting-hide-answers" class="h-5 w-5 rounded">
                                <div>
                                    <span class="font-semibold text-gray-700">Antworten verstecken</span>
                                    <p class="text-xs text-gray-500">Verhindert Beeinflussung durch andere.</p>
                                </div>
                            </label>

                            <div id="vote-setting-hide-answers-mode-wrapper" class="hidden flex-grow">
                                <select id="vote-setting-hide-answers-mode"
                                    class="w-full p-2 border border-gray-300 rounded-lg bg-white">
                                    <option value="bis_umfragenabschluss" selected>bis Umfrageabschluss</option>
                                    <option value="bis_stimmabgabe_mit_korrektur">bis zur eigenen Stimmabgabe</option>
                                    <option value="bis_stimmabgabe_ohne_korrektur">bis zur eignen Stimmabgabe
                                        (Korrekturen verbieten)</option>
                                </select>
                            </div>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <div class="flex justify-between items-center">
                                <div>
                                    <span id="vote-setting-access-text" class="font-semibold text-gray-700">Diese
                                        Umfrage können nur angemeldete Benutzer sehen.</span>
                                    <input type="hidden" id="vote-setting-access-mode" value="registered">
                                </div>
                                <button id="vote-setting-access-btn"
                                    class="py-1 px-3 bg-gray-200 text-gray-700 text-sm font-semibold rounded-lg hover:bg-gray-300 flex-shrink-0 ml-2">
                                    ändern...
                                </button>
                            </div>
                        </div>
                    </div>


                    <div class="card bg-white p-4 rounded-xl shadow-lg mb-6 space-y-4 border-t-4 border-cyan-500">
                        <h3 class="text-lg font-bold text-gray-800 mb-1">Gäste per Link einladen (Optional)</h3>
                        <p class="text-xs text-gray-500 mb-3">
                            Füge hier Gäste hinzu, die (noch) kein Konto haben. Nach dem Speichern kannst du im
                            "EDIT"-Modus
                            die einzigartigen Einladungs-Links für diese Gäste kopieren.
                            Dies ist sicherer als die "Token"-Eingabe.
                        </p>

                        <div class="flex flex-col sm:flex-row gap-2">
                            <input type="text" id="vote-guest-name-input-admin"
                                class="flex-grow p-2 border border-gray-300 rounded-lg"
                                placeholder="Name des Gastes (z.B. Max Mustermann)">
                            <button id="vote-add-guest-btn-admin"
                                class="py-2 px-4 bg-cyan-600 text-white font-semibold rounded-lg hover:bg-cyan-700 transition flex-shrink-0">
                                + Gast hinzufügen
                            </button>
                        </div>

                        <div id="vote-guest-list-admin" class="space-y-2 pt-2 border-t">
                            <p class="text-sm text-center text-gray-400">Noch keine Gäste für diese Umfrage hinzugefügt.
                            </p>
                        </div>
                    </div>


                    <button id="vote-save-group-poll-btn"
                        class="w-full py-3 bg-green-600 text-white font-bold text-lg rounded-lg hover:bg-green-700 transition shadow-lg">
                        Umfrage erstellen und Link erhalten
                    </button>
                </div>


                <div id="terminplaner-vote-view" class="hidden">

                    <div class="back-link-container w-full mb-2">
                        <button id="cancel-vote-participation-btn"
                            class="flex items-center text-gray-600 hover:text-indigo-600 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                stroke-linejoin="round" class="w-5 h-5 mr-1">
                                <path d="m15 18-6-6 6-6" />
                            </svg>
                            <span class="text-sm font-semibold">zurück</span>
                        </button>
                        <div class="border-t border-gray-300 mt-2"></div>
                    </div>

                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-2">

                        <div class="text-center sm:text-left flex-grow min-w-0">
                            <h2 id="vote-poll-title" class="text-2xl font-bold text-gray-800 truncate">...</h2>
                            <p id="vote-poll-creator" class="text-sm text-gray-500 mt-1">Erstellt von ...</p>
                        </div>

                        <div id="edit-vote-wrapper" class="flex items-center gap-2 flex-shrink-0 justify-center">
                            <button id="show-edit-vote-btn"
                                class="py-1 px-3 bg-gray-200 text-gray-700 text-sm font-semibold rounded-lg hover:bg-gray-300">
                                EDIT
                            </button>
                            <input type="text" id="edit-token-input-inline"
                                class="hidden p-1 border rounded-lg text-sm font-mono uppercase w-36"
                                placeholder="XXXX - XXXX" maxlength="11">
                            <button id="submit-edit-token-inline-btn"
                                class="hidden py-1 px-3 bg-orange-500 text-white text-sm font-semibold rounded-lg hover:bg-orange-600">
                                OK
                            </button>
                        </div>

                    </div>

                    <div class="flex justify-center mb-4">
                        <div id="vote-share-box"
                            class="p-3 bg-gray-100 border border-gray-300 rounded-lg inline-flex flex-wrap gap-x-4 gap-y-2 justify-center">

                            <div class="flex items-center gap-2">
                                <span class="text-sm font-semibold text-gray-700">TOKEN:</span>
                                <span id="vote-share-token" class="font-mono font-bold text-gray-900">XXXX - XXXX</span>
                                <button id="copy-vote-token-btn" title="Token kopieren"
                                    class="ml-auto p-1 rounded-md hover:bg-gray-200 transition">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                        class="w-5 h-5 text-gray-500">
                                        <path d="M8 3a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2H9a1 1 0 0 1-1-1Z" />
                                        <path
                                            d="M4 3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h5.5a.5.5 0 0 1 0 1H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h5.5a.5.5 0 0 1 0 1H4Z" />
                                        <path
                                            d="M9 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5v-5ZM10 8v4h4V8h-4Z" />
                                    </svg>
                                </button>
                            </div>

                            <div class="border-l border-gray-200"></div>

                            <div class="flex items-center gap-2">
                                <span class="text-sm font-semibold text-gray-700">Direkt-URL:</span>
                                <input type="text" id="vote-share-url"
                                    class="text-sm text-gray-900 bg-gray-200 p-1 rounded-md flex-grow w-32" readonly>
                                <button id="copy-vote-url-btn" title="URL kopieren"
                                    class="p-1 rounded-md hover:bg-gray-200 transition">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                        class="w-5 h-5 text-gray-500">
                                        <path d="M8 3a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2H9a1 1 0 0 1-1-1Z" />
                                        <path
                                            d="M4 3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h5.5a.5.5 0 0 1 0 1H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h5.5a.5.5 0 0 1 0 1H4Z" />
                                        <path
                                            d="M9 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5v-5ZM10 8v4h4V8h-4Z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="vote-poll-validity-container" class="hidden text-sm text-center text-gray-600 mb-4">
                        <span id="vote-poll-validity"></span>
                    </div>
                    <div id="vote-validity-warning-box"
                        class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg mb-6">
                        <p id="vote-validity-warning-text"></p>
                    </div>
                    <div id="vote-info-box" class="card bg-white p-4 rounded-xl shadow-lg mb-6 space-y-3">

                        <div id="poll-update-notification-box" class="hidden p-3 border-l-4 border-blue-500 bg-blue-50">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-bold text-blue-700">Diese Umfrage wurde aktualisiert.</p>
                                    <p id="poll-update-subtitle" class="text-sm text-blue-600">Geänderte Felder blinken
                                        blau.</p>
                                </div>
                                <div class="flex flex-col gap-2 items-end flex-shrink-0 ml-2">
                                    <button id="show-poll-history-btn-main"
                                        class="py-1 px-3 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 flex-shrink-0 w-full text-center">
                                        Details
                                    </button>
                                    <button id="acknowledge-update-btn"
                                        class="py-1 px-3 bg-blue-100 text-blue-700 text-sm font-semibold rounded-lg hover:bg-blue-200 flex-shrink-0 w-full text-center">
                                        <span class="button-text">Ok, quittieren</span>
                                        <div class="loading-spinner"
                                            style="border-top-color: #1d4ed8; border-right-color: transparent; border-bottom-color: transparent; border-left-color: transparent;">
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="vote-poll-description-container" class="hidden">
                            <p class="text-sm text-gray-600" id="vote-poll-description"></p>
                        </div>
                        <div id="vote-poll-location-container" class="hidden">
                            <p class="text-sm text-gray-600 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                    class="w-5 h-5 text-gray-400">
                                    <path fill-rule="evenodd"
                                        d="M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 0 0 .281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.966 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 1 0 3 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 0 0 2.273 1.765 11.842 11.842 0 0 0 1.039.574l.018.008.006.003ZM10 11.25a2.25 2.25 0 1 0 0-4.5 2.25 2.25 0 0 0 0 4.5Z"
                                        clip-rule="evenodd" />
                                </svg>
                                <span id="vote-poll-location"></span>
                            </p>
                        </div>
                    </div>
                    <div id="vote-hidden-answers-infobox"
                        class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg mb-6">
                        <p class="font-bold">Antworten sind versteckt</p>
                        <p id="vote-hidden-answers-infobox-text" class="text-sm"></p>
                    </div>

                    <div id="vote-participant-status-container"
                        class="card bg-white p-4 rounded-xl shadow-lg mb-6 hidden">

                        <div id="vote-guest-name-container" class="hidden">
                            <label for="vote-guest-name-input" class="block text-sm font-bold text-gray-700 mb-1">Dein
                                Name (als Gast)</label>
                            <div class="flex items-center gap-2">
                                <input type="text" id="vote-guest-name-input"
                                    class="flex-grow p-2 border border-gray-300 rounded-lg"
                                    placeholder="Vor- und Nachname...">
                                <button id="vote-guest-change-to-anon-btn"
                                    class="hidden py-1 px-3 bg-gray-200 text-gray-700 text-sm font-semibold rounded-lg hover:bg-gray-300 flex-shrink-0">
                                    Anonym teilnehmen
                                </button>
                            </div>
                        </div>

                        <div id="vote-user-name-container" class="hidden">
                            <label class="block text-sm font-bold text-gray-700">Deine Teilnahme als:</label>
                            <div class="flex items-center justify-between gap-2">
                                <p id="vote-participant-name" class="text-lg font-bold text-gray-800"></p>
                                <button id="vote-user-change-to-anon-btn"
                                    class="hidden py-1 px-3 bg-gray-200 text-gray-700 text-sm font-semibold rounded-lg hover:bg-gray-300 flex-shrink-0">
                                    Ändern
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="vote-options-container" class="overflow-x-auto rounded-xl shadow-lg mb-6">
                    </div>

                    <button id="vote-save-participation-btn"
                        class="w-full py-3 bg-green-600 text-white font-bold text-lg rounded-lg hover:bg-green-700 transition shadow-lg hidden">
                        Abstimmung speichern
                    </button>

                </div>




                <div id="terminplaner-edit-view" class="hidden">
                    <div class="mb-4">
                        <div class="flex justify-between items-center">
                            <h2 id="edit-poll-title" class="text-2xl font-bold text-gray-800">... bearbeiten</h2>
                            <button id="cancel-vote-editing-btn"
                                class="py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition">
                                Zurück zur Umfrage
                            </button>
                        </div>
                    </div>

                    <div class="card bg-white p-4 rounded-xl shadow-lg mb-6 space-y-4">
                        <h3 class="text-lg font-bold text-gray-800 mb-1">Details</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-2 md:items-center">
                            <label for="vote-title-edit" class="block text-sm font-bold text-gray-700">Titel</label>
                            <input type="text" id="vote-title-edit"
                                class="w-full p-2 border border-gray-300 rounded-lg md:col-span-3">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-2">
                            <label for="vote-description-edit"
                                class="block text-sm font-bold text-gray-700">Beschreibung</label>
                            <textarea id="vote-description-edit" rows="2"
                                class="w-full p-2 border border-gray-300 rounded-lg md:col-span-3"></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-2 md:items-center">
                            <label for="vote-location-edit" class="block text-sm font-bold text-gray-700">Ort</label>
                            <input type="text" id="vote-location-edit"
                                class="w-full p-2 border border-gray-300 rounded-lg md:col-span-3">
                        </div>
                    </div>

                    <div class="card bg-white rounded-xl shadow-lg mb-6">
                        <button
                            class="accordion-toggle w-full flex justify-between items-center p-4 cursor-pointer hover:bg-gray-50 rounded-xl"
                            data-toggle-target="#existing-terms-area">
                            <h3 class="text-lg font-bold text-gray-800">Bestehende Termine verwalten</h3>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-5 h-5 accordion-icon transition-transform">
                                <path fill-rule="evenodd"
                                    d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="existing-terms-area" class="accordion-content hidden p-4 pt-0">
                            <div class="border-t pt-4">
                                <p class="text-xs text-gray-500 mb-3">Hier kannst du Termine streichen. Gestreichene
                                    Termine
                                    werden auf der Abstimm-Seite markiert und alle Stimmen dafür werden entfernt (lokal
                                    gespeichert, bis du auf "Änderungen speichern" klickst).</p>
                                <div id="manage-existing-terms-list" class="space-y-2 max-h-72 overflow-y-auto pr-2">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-white rounded-xl shadow-lg mb-6">
                        <button
                            class="accordion-toggle w-full flex justify-between items-center p-4 cursor-pointer hover:bg-gray-50 rounded-xl"
                            data-toggle-target="#new-terms-area">
                            <h3 class="text-lg font-bold text-gray-800">Weitere Termine vorschlagen</h3>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-5 h-5 accordion-icon transition-transform">
                                <path fill-rule="evenodd"
                                    d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="new-terms-area" class="accordion-content hidden p-4 pt-0">
                            <div class="border-t pt-4">
                                <p class="text-xs text-gray-500 mb-3">Du kannst hier <strong>neue</strong> Termine
                                    hinzufügen.
                                    Bestehende Termine können aus Sicherheitsgründen nicht geändert oder gelöscht
                                    werden. Wenn
                                    du einen Termin hinzufügst, müssen alle Teilnehmer erneut abstimmen (für diesen
                                    neuen
                                    Termin).</p>
                                <div id="vote-dates-container-edit" class="space-y-4">
                                </div>
                                <button id="vote-add-date-btn-edit"
                                    class="w-full mt-4 py-2 bg-blue-100 text-blue-700 font-semibold rounded-lg hover:bg-blue-200 transition">
                                    + Tag hinzufügen
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-white rounded-xl shadow-lg mb-6">
                        <button
                            class="accordion-toggle w-full flex justify-between items-center p-4 cursor-pointer hover:bg-gray-50 rounded-xl"
                            data-toggle-target="#participant-edit-area">
                            <h3 class="text-lg font-bold text-gray-800">Teilnehmer-Abstimmungen bearbeiten</h3>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-5 h-5 accordion-icon transition-transform">
                                <path fill-rule="evenodd"
                                    d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="participant-edit-area" class="accordion-content hidden p-4 pt-0">
                            <div class="border-t pt-4">
                                <p class="text-xs text-gray-500 mb-3">Du kannst hier die Abstimmungen für andere
                                    Teilnehmer
                                    korrigieren. Jede Änderung wird im Korrektur-Verlauf des Teilnehmers protokolliert
                                    und
                                    sofort **lokal** gespeichert. Klicke am Ende auf "Änderungen speichern", um alles in
                                    die
                                    Datenbank zu schreiben.</p>

                                <div class="p-3 bg-green-50 border border-green-200 rounded-lg mb-4 space-y-2">
                                    <label for="new-participant-name-input"
                                        class="block text-sm font-bold text-green-800">Neuen
                                        Teilnehmer (manuell) hinzufügen</label>
                                    <div class="flex flex-col sm:flex-row gap-2">
                                        <input type="text" id="new-participant-name-input"
                                            class="flex-grow p-2 border border-gray-300 rounded-lg"
                                            placeholder="Name (z.B. Oma Erna)">
                                        <button id="add-new-participant-btn"
                                            class="py-2 px-4 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition flex-shrink-0">
                                            + Hinzufügen
                                        </button>
                                    </div>
                                </div>
                                <div id="edit-participant-grid-container" class="space-y-3">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-white rounded-xl shadow-lg mb-6">
                        <button
                            class="accordion-toggle w-full flex justify-between items-center p-4 cursor-pointer hover:bg-gray-50 rounded-xl"
                            data-toggle-target="#validity-area">
                            <h3 class="text-lg font-bold text-gray-800">Gültigkeitszeitraum</h3>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-5 h-5 accordion-icon transition-transform">
                                <path fill-rule="evenodd"
                                    d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="validity-area" class="accordion-content hidden p-4 pt-0">
                            <div class="border-t pt-4 space-y-4">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="vote-start-time-edit"
                                            class="block text-sm font-medium text-gray-700">Startet
                                            am</label>
                                        <input type="datetime-local" id="vote-start-time-edit"
                                            class="w-full p-2 border rounded-lg mt-1">
                                    </div>
                                    <div>
                                        <label for="vote-end-time-edit"
                                            class="block text-sm font-medium text-gray-700">Endet
                                            am</label>
                                        <input type="datetime-local" id="vote-end-time-edit"
                                            class="w-full p-2 border rounded-lg mt-1 disabled:bg-gray-100 disabled:cursor-not-allowed">
                                        <label class="flex items-center gap-2 mt-2">
                                            <input type="checkbox" id="vote-end-time-unlimited-edit"
                                                class="h-4 w-4 rounded">
                                            <span class="text-sm text-gray-600">Unbegrenzt (offen lassen)</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-white rounded-xl shadow-lg mb-6">
                        <button
                            class="accordion-toggle w-full flex justify-between items-center p-4 cursor-pointer hover:bg-gray-50 rounded-xl"
                            data-toggle-target="#settings-area">
                            <h3 class="text-lg font-bold text-gray-800">Einstellungen</h3>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-5 h-5 accordion-icon transition-transform">
                                <path fill-rule="evenodd"
                                    d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="settings-area" class="accordion-content hidden p-4 pt-0">
                            <div class="border-t pt-4 space-y-4">
                                <div class="p-2 bg-gray-50 rounded-lg">
                                    <label class="block font-semibold text-gray-700">Teilnehmer zuweisen</label>
                                    <p class="text-xs text-gray-500 mb-2">Wähle Benutzer aus, die diese Umfrage in ihrer
                                        Liste
                                        sehen sollen.</p>
                                    <div class="flex items-center gap-2 p-2 bg-white border rounded-lg">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                            class="w-5 h-5 text-gray-400 flex-shrink-0">
                                            <path
                                                d="M10 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM3.468 11.69A5.022 5.022 0 0 1 7.5 10h5a5.022 5.022 0 0 1 4.032 1.69l.966 1.616A2.25 2.25 0 0 1 15.53 15H4.47a2.25 2.25 0 0 1-1.968-1.694l.966-1.616Z" />
                                        </svg>
                                        <span id="vote-assigned-users-display-edit"
                                            class="flex-grow text-sm text-gray-600 truncate"
                                            title="Niemand ausgewählt">Niemand
                                            ausgewählt</span>
                                        <button id="vote-show-assign-user-modal-btn-edit"
                                            class="py-1 px-3 bg-blue-100 text-blue-600 text-sm font-semibold rounded-lg hover:bg-blue-200 transition flex-shrink-0">
                                            Auswählen
                                        </button>
                                    </div>
                                </div>
                                <label class="flex items-center gap-3 p-2 bg-gray-50 rounded-lg cursor-pointer">
                                    <input type="checkbox" id="vote-setting-public-edit" class="h-5 w-5 rounded">
                                    <span class="font-semibold text-gray-700">Öffentliche Umfrage</span>
                                </label>
                                <div class="p-2 bg-gray-50 rounded-lg flex flex-col md:flex-row gap-3">
                                    <label class="flex items-center gap-3 cursor-pointer flex-shrink-0">
                                        <input type="checkbox" id="vote-setting-anonymous-edit" class="h-5 w-5 rounded">
                                        <span class="font-semibold text-gray-700">Anonyme Umfrage</span>
                                    </label>

                                    <div id="vote-setting-anonymous-mode-wrapper-edit" class="hidden flex-grow">
                                        <select id="vote-setting-anonymous-mode-edit"
                                            class="w-full p-2 border border-gray-300 rounded-lg bg-white">
                                            <option value="erzwingen" selected>Erzwingen (Alle sind "Anonym")</option>
                                            <option value="ermöglichen">Ermöglichen (Jeder kann "Anonym" wählen)
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <label class="flex items-center gap-3 p-2 bg-gray-50 rounded-lg cursor-pointer">
                                    <input type="checkbox" id="vote-setting-disable-maybe-edit" class="h-5 w-5 rounded">
                                    <span class="font-semibold text-gray-700">"Vielleicht"-Option deaktivieren</span>
                                </label>
                                <div class="p-2 bg-gray-50 rounded-lg flex flex-col md:flex-row gap-3">
                                    <label class="flex items-center gap-3 cursor-pointer flex-shrink-0">
                                        <input type="checkbox" id="vote-setting-hide-answers-edit"
                                            class="h-5 w-5 rounded">
                                        <span class="font-semibold text-gray-700">Antworten verstecken</span>
                                    </label>

                                    <div id="vote-setting-hide-answers-mode-wrapper-edit" class="hidden flex-grow">
                                        <select id="vote-setting-hide-answers-mode-edit"
                                            class="w-full p-2 border border-gray-300 rounded-lg bg-white">
                                            <option value="bis_umfragenabschluss" selected>bis Umfrageabschluss</option>
                                            <option value="bis_stimmabgabe_mit_korrektur">bis zur eigenen Stimmabgabe
                                            </option>
                                            <option value="bis_stimmabgabe_ohne_korrektur">bis zur eignen Stimmabgabe
                                                (Korrekturen verbieten)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="p-3 bg-gray-50 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <span id="vote-setting-access-text-edit"
                                                class="font-semibold text-gray-700">Diese
                                                Umfrage können nur angemeldete Benutzer sehen.</span>
                                            <input type="hidden" id="vote-setting-access-mode-edit" value="registered">
                                        </div>
                                        <button id="vote-setting-access-btn-edit"
                                            class="py-1 px-3 bg-gray-200 text-gray-700 text-sm font-semibold rounded-lg hover:bg-gray-300 flex-shrink-0 ml-2">
                                            ändern...
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-white rounded-xl shadow-lg mb-6 border-t-4 border-cyan-500">
                        <button
                            class="accordion-toggle w-full flex justify-between items-center p-4 cursor-pointer hover:bg-gray-50 rounded-xl"
                            data-toggle-target="#guests-area">
                            <h3 class="text-lg font-bold text-gray-800">Gäste per Link einladen</h3>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-5 h-5 accordion-icon transition-transform">
                                <path fill-rule="evenodd"
                                    d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="guests-area" class="accordion-content hidden p-4 pt-0">
                            <div class="border-t pt-4 space-y-4">
                                <p class="text-xs text-gray-500 mb-3">
                                    Füge Gäste hinzu oder kopiere die Links für bestehende Gäste, um sie einzuladen.
                                </p>

                                <div class="flex flex-col sm:flex-row gap-2">
                                    <input type="text" id="vote-guest-name-input-admin-edit"
                                        class="flex-grow p-2 border border-gray-300 rounded-lg"
                                        placeholder="Name des Gastes (z.B. Max Mustermann)">
                                    <button id="vote-add-guest-btn-admin-edit"
                                        class="py-2 px-4 bg-cyan-600 text-white font-semibold rounded-lg hover:bg-cyan-700 transition flex-shrink-0">
                                        + Gast hinzufügen
                                    </button>
                                </div>

                                <div id="vote-guest-list-admin-edit" class="space-y-2 pt-2 border-t">
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="vote-save-changes-btn"
                        class="w-full py-3 bg-green-600 text-white font-bold text-lg rounded-lg hover:bg-green-700 transition shadow-lg mb-6">
                        Änderungen speichern
                    </button>

                    <div class="card bg-white p-4 rounded-xl shadow-lg mb-6 space-y-4 border-t-4 border-red-500">
                        <h3 class="text-lg font-bold text-red-700 mb-1">Gefahrenzone</h3>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <button id="vote-fix-date-btn"
                                class="w-full py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition"
                                data-action="fix">
                                Tag & Zeit fixieren
                            </button>
                            <button id="vote-toggle-manual-close-btn"
                                class="w-full py-2 px-4 bg-yellow-500 text-black font-semibold rounded-lg hover:bg-yellow-600 transition">
                                Umfrage beenden
                            </button>
                        </div>

                        <div id="fix-date-selection-container" class="hidden p-4 pt-0">
                            <div class="border-t border-red-300 pt-4 space-y-3">
                                <h4 class="font-bold text-lg text-gray-900">Finalen Termin auswählen & Umfrage schließen
                                </h4>
                                <p class="text-sm text-gray-600">
                                    Wähle den besten Termin aus der Liste aus. Das System schlägt den Termin mit den
                                    meisten "Ja"-Stimmen vor.
                                </p>

                                <div id="final-date-options-list"
                                    class="space-y-2 max-h-60 overflow-y-auto p-2 border rounded-lg bg-gray-50">
                                    <p class="text-sm text-gray-400 text-center">Lade Termin-Optionen...</p>
                                </div>

                                <div class="flex gap-2">
                                    <button id="cancel-fix-date-btn"
                                        class="w-1/2 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition">
                                        Abbrechen
                                    </button>
                                    <button id="confirm-fix-date-btn"
                                        class="w-1/2 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition flex items-center justify-center">
                                        <span class="button-text">Auswählen & Schließen</span>
                                        <div class="loading-spinner"></div>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <button id="vote-delete-poll-btn"
                            class="w-full py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition">
                            Diese Umfrage endgültig löschen
                        </button>
                    </div>
                </div>


            </div>
            <div id="userSelectionModal"
                class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-20">
                <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-xs">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">Benutzer auswählen</h3>
                    <p class="text-sm text-gray-600 mb-4">Wählen Sie den Modus, in dem Sie sich anmelden möchten.
                    </p>
                    <div id="modalUserButtons" class="space-y-3"></div>
                    <div class="flex justify-end mt-4">
                        <button id="cancelSelectionButton"
                            class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">Abbrechen</button>
                    </div>
                </div>
            </div>

            <div id="pinModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-20">
                <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-xs">
                    <div id="pinRegularContent">
                        <h3 id="pinModalTitle" class="text-xl font-bold mb-4 text-gray-800">Schlüssel eingeben</h3>
                        <p class="text-sm text-gray-600 mb-4">Geben Sie den Schlüssel für den gewählten Benutzer
                            ein.
                        </p>
                        <input type="password" id="adminPinInput"
                            class="w-full p-3 border-2 border-gray-300 rounded-lg text-center tracking-widest text-lg focus:ring-blue-500 focus:border-blue-500"
                            maxlength="20">
                        <div id="pinError" class="text-red-500 text-sm mt-2 hidden">Falscher Schlüssel!</div>
                        <div id="forgotPasswordLink" class="text-center mt-2 hidden">
                            <a href="#" class="text-blue-600 text-sm hover:underline">Passwort vergessen?</a>
                        </div>
                        <div class="flex justify-between space-x-3 mt-6">
                            <button id="backToSelectionButton"
                                class="py-2 px-3 bg-gray-400 text-white font-medium rounded-lg hover:bg-gray-500 transition">Zurück</button>
                            <button id="submitAdminKeyButton"
                                class="py-2 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition flex items-center justify-center">
                                <span class="button-text">Bestätigen</span>
                                <div class="loading-spinner"></div>
                            </button>
                        </div>
                    </div>
                    <div id="pinLockedContent" class="hidden text-center">
                        <h3 class="text-xl font-bold mb-4 text-red-700">Zugriff verweigert</h3>
                        <p class="text-gray-600 mb-6">Dieser Benutzer ist gesperrt. Bitte kontaktieren Sie einen
                            Administrator.</p>
                        <button id="closeLockedModalButton"
                            class="w-full py-2 px-4 bg-gray-600 text-white font-medium rounded-lg hover:bg-gray-700 transition">Zurück
                            zur Auswahl</button>
                    </div>
                </div>
            </div>

            <div id="loginLoadingOverlay" class="fullscreen-loading-overlay">
                <div class="fullscreen-loading-box">
                    <div class="fullscreen-loading-spinner"></div>
                    <div class="fullscreen-loading-text">Anmeldung läuft...</div>
                </div>
            </div>

            <div id="passwordResetModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-30">
                <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">Passwort zurücksetzen</h3>
                    <p class="text-sm text-gray-600 mb-4">
                        Zur Verifizierung geben Sie bitte Ihren vollständigen Pushover User-Key ein.
                    </p>
                    <input type="text" id="pushoverTokenInput"
                        class="w-full p-3 border-2 border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500"
                        placeholder="z.B. uQiRzpo4DXghDmr9QzzfQu27cmVRsG">
                    <div id="tokenError" class="text-red-500 text-sm mt-2 hidden">Falscher Token!</div>
                    <div id="tokenSuccess" class="text-green-600 text-sm mt-2 hidden">Passwort wird per Pushover gesendet...</div>
                    <div class="flex justify-between space-x-3 mt-6">
                        <button id="cancelPasswordResetButton"
                            class="py-2 px-3 bg-gray-400 text-white font-medium rounded-lg hover:bg-gray-500 transition">Abbrechen</button>
                        <button id="verifyTokenButton"
                            class="py-2 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition flex items-center justify-center">
                            <span class="button-text">Verifizieren</span>
                            <div class="loading-spinner"></div>
                        </button>
                    </div>
                </div>
            </div>

            <div id="logoutConfirmModal"
                class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-20">
                <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-xs">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">Abmelden</h3>
                    <p class="text-sm text-gray-600 mb-6">Möchten Sie sich wirklich abmelden?</p>
                    <div class="flex justify-between space-x-3 mt-4">
                        <button id="confirmLogoutNo"
                            class="flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">NEIN</button>
                        <button id="confirmLogoutYes"
                            class="flex-1 py-2 px-4 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition">JA</button>
                    </div>
                </div>
            </div>

            <div id="zahlungsverwaltungView" class="view">
                <div class="back-link-container w-full mb-3">
                    <div class="flex justify-between items-center">
                        <div class="flex gap-2">
                            <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                                data-target="home">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                    stroke-linejoin="round" class="w-6 h-6 mr-1">
                                    <path d="m15 18-6-6 6-6" />
                                </svg>
                                <span class="text-base font-semibold">zurück</span>
                            </button>
                            <button id="btn-zv-settings"
                                class="p-2 text-gray-500 hover:text-gray-800 transition rounded-full hover:bg-gray-200"
                                title="Einstellungen & Vorlagen">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                    class="w-6 h-6">
                                    <path fill-rule="evenodd"
                                        d="M7.84 1.804A1 1 0 0 1 8.82 1h2.36a1 1 0 0 1 .98.804l.331 1.652a6.993 6.993 0 0 1 1.929 1.115l1.598-.54a1 1 0 0 1 1.186.447l1.18 2.044a1 1 0 0 1-.205 1.251l-1.267 1.113a7.047 7.047 0 0 1 0 2.228l1.267 1.113a1 1 0 0 1 .206 1.25l-1.18 2.045a1 1 0 0 1-1.187.447l-1.598-.54a6.993 6.993 0 0 1-1.929 1.115l-.33 1.652a1 1 0 0 1-.98.804H8.82a1 1 0 0 1-.98-.804l-.331-1.652a6.993 6.993 0 0 1-1.929-1.115l-1.598.54a1 1 0 0 1-1.186-.447l-1.18-2.044a1 1 0 0 1 .205-1.251l1.267-1.114a7.05 7.05 0 0 1 0-2.227L1.821 7.773a1 1 0 0 1-.206-1.25l1.18-2.045a1 1 0 0 1 1.187-.447l1.598.54A6.992 6.992 0 0 1 7.51 3.456l.33-1.652ZM10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
                                        clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>

                        <button id="btn-create-new-payment"
                            class="py-2 px-4 bg-emerald-600 text-white font-bold rounded-lg hover:bg-emerald-700 transition shadow-sm flex items-center gap-2 text-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-5 h-5">
                                <path
                                    d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                            </svg>
                            Neu
                        </button>
                    </div>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <div class="grid grid-cols-3 gap-2 mb-1">
                    <div
                        class="p-2 bg-red-50 border border-red-200 rounded-lg shadow-sm flex flex-col justify-center text-center">
                        <p class="text-xs font-bold text-red-700 uppercase tracking-wide leading-tight mb-1">Ich schulde
                        </p>
                        <p class="text-lg font-extrabold text-gray-800 leading-tight" id="dashboard-my-debt-display">
                            0,00 €</p>
                    </div>

                    <div
                        class="p-2 bg-emerald-50 border border-emerald-200 rounded-lg shadow-sm flex flex-col justify-center text-center">
                        <p class="text-xs font-bold text-emerald-700 uppercase tracking-wide leading-tight mb-1">Mir
                            geschuldet
                        </p>
                        <p class="text-lg font-extrabold text-gray-800 leading-tight" id="dashboard-owe-me-display">0,00
                            €</p>
                    </div>

                    <div id="btn-dashboard-credits"
                        class="p-1 bg-blue-50 border border-blue-200 rounded-lg shadow-sm cursor-pointer hover:bg-blue-100 transition flex flex-col relative group text-center h-full">

                        <p class="text-xs font-bold text-blue-700 uppercase tracking-wide leading-tight mb-1 pt-1">
                            Guthaben</p>

                        <div class="flex w-full flex-grow divide-x divide-blue-200 items-center pb-1">
                            <div class="flex-1 flex flex-col justify-center px-1">
                                <p class="text-[10px] font-bold text-blue-600 uppercase leading-tight mb-0.5">Bei
                                    Anderen</p>
                                <p class="text-sm font-extrabold text-gray-800 leading-tight"
                                    id="dashboard-credit-others-display">0,00 €</p>
                            </div>

                            <div class="flex-1 flex flex-col justify-center px-1">
                                <p class="text-[10px] font-bold text-blue-600 uppercase leading-tight mb-0.5">Bei Mir
                                </p>
                                <p class="text-sm font-extrabold text-gray-800 leading-tight"
                                    id="dashboard-credit-me-display">0,00 €</p>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="grid grid-cols-3 gap-1 mb-2 mt-1">

                    <div id="btn-action-requests"
                        class="p-1 bg-gray-50 border border-gray-200 rounded-lg shadow-sm cursor-pointer transition flex flex-col justify-center text-center min-h-[45px]">
                        <p class="text-[9px] font-bold text-gray-500 uppercase leading-none">Anfragen</p>
                        <p class="text-base font-extrabold text-gray-800 leading-none mt-0.5"
                            id="dashboard-requests-count">0</p>
                    </div>

                    <div id="btn-action-trans-approvals"
                        class="p-1 bg-gray-50 border border-gray-200 rounded-lg shadow-sm cursor-pointer transition flex flex-col justify-center text-center min-h-[45px]">
                        <p class="text-[9px] font-bold text-gray-500 uppercase leading-none">Buchungen</p>
                        <div class="leading-none mt-0.5">
                            <p class="text-base font-extrabold text-gray-800 leading-none"
                                id="dashboard-trans-approvals-count">0</p>
                        </div>
                    </div>

                    <div id="btn-action-value-credit"
                        class="p-1 bg-gray-50 border border-gray-200 rounded-lg shadow-sm flex flex-col justify-center text-center min-h-[45px] opacity-60 cursor-not-allowed">
                        <p class="text-[9px] font-bold text-gray-500 uppercase leading-none">Wertguthaben</p>
                        <p class="text-[9px] text-gray-400 italic leading-none mt-0.5">Folgt...</p>
                    </div>
                </div>


                <div class="flex justify-center mb-2">
                    <button id="btn-toggle-dashboard-controls"
                        class="text-gray-400 hover:text-indigo-600 transition flex items-center gap-1 text-xs font-bold py-1 px-4 rounded-full hover:bg-gray-100">
                        <span>Filter & Kategorien</span>
                        <svg id="icon-dashboard-toggle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                            fill="currentColor" class="w-4 h-4 transform transition-transform">
                            <path fill-rule="evenodd"
                                d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <div id="dashboard-controls-wrapper"
                    class="hidden mb-3 space-y-3">
                    <div class="filterbox-panel">
                        <div class="filter-box-title">Filterbox</div>
                        <div class="flex flex-wrap gap-2 relative z-20 items-center">
                            <button id="btn-toggle-selection-mode"
                                class="p-2 bg-gray-100 text-gray-600 border border-gray-300 rounded-lg shadow-sm hover:bg-gray-200 shrink-0 text-sm"
                                title="Mehrfachauswahl">
                                ☑️
                            </button>

                            <button id="btn-open-settlement"
                                class="p-2 bg-indigo-100 text-indigo-700 border border-indigo-200 rounded-lg shadow-sm font-bold hover:bg-indigo-200 whitespace-nowrap shrink-0 text-sm">
                                ⚖️ Bilanz
                            </button>

                            <label class="inline-flex items-center gap-1 px-2 py-2 bg-white border border-gray-300 rounded-lg text-xs font-bold text-red-700 shrink-0">
                                <input type="checkbox" id="payment-search-negate" class="w-4 h-4 accent-red-600">
                                NICHT
                            </label>

                            <select id="payment-search-join-mode"
                                class="p-2 border rounded bg-white shadow-sm text-xs font-semibold h-9 shrink-0">
                                <option value="and" selected>AND</option>
                                <option value="or">OR</option>
                            </select>

                            <div class="relative flex-grow">
                                <input type="text" id="payment-search-input" placeholder="Suchen (Name, Nr, Datum...)"
                                    class="w-full p-2 border rounded-lg shadow-sm text-sm bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                    autocomplete="off">

                                <div id="search-suggestions-box"
                                    class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-xl max-h-60 overflow-y-auto z-50">
                                    <ul id="search-suggestions-list" class="text-sm text-gray-700"></ul>
                                </div>
                            </div>

                            <button id="btn-payment-add-filter"
                                class="px-3 py-2 bg-indigo-600 text-white border border-indigo-700 rounded-lg shadow-sm font-bold hover:bg-indigo-700 whitespace-nowrap shrink-0 text-sm">
                                + Filter
                            </button>

                            <button id="btn-payment-reset-filters"
                                class="px-3 py-2 bg-gray-100 text-gray-700 border border-gray-300 rounded-lg shadow-sm font-bold hover:bg-gray-200 whitespace-nowrap shrink-0 text-sm">
                                ↺ Reset
                            </button>

                            <div class="pl-1 border-l border-gray-300 ml-1">
                                <button id="btn-toggle-view-mode"
                                    class="p-2 bg-white text-indigo-600 border border-indigo-200 rounded-lg shadow-sm hover:bg-indigo-50 shrink-0 text-sm"
                                    title="Ansicht wechseln (Liste/Karten)">
                                    📋
                                </button>
                            </div>
                        </div>

                        <div id="active-search-tags" class="flex flex-wrap gap-1 mt-2 empty:hidden"></div>
                    </div>

                    <div class="kategorienbox-panel">
                        <div class="kategorien-box-title">Kategorien-Box</div>
                        <div id="category-dashboard-container" class="flex gap-2 overflow-x-auto mb-3 pb-1 no-scrollbar">
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                            <select id="payment-search-type"
                                class="p-1 border rounded bg-white shadow-sm text-xs font-semibold h-9">
                                <option value="all" selected>Suche: Alles</option>
                                <option value="debtor">Suche: Von</option>
                                <option value="creditor">Suche: An</option>
                                <option value="content">Suche: Inhalt</option>
                                <option value="numbers">Suche: Nummer/ID</option>
                                <option value="date">Suche: Datum</option>
                                <option value="amount">Suche: Betrag</option>
                            </select>
                            <select id="payment-filter-status"
                                class="p-1 border rounded bg-white shadow-sm text-xs font-semibold h-9">
                            </select>
                            <select id="payment-filter-category"
                                class="p-1 border rounded bg-white shadow-sm text-xs font-semibold h-9">
                            </select>
                            <select id="payment-filter-direction"
                                class="p-1 border rounded bg-white shadow-sm text-xs font-semibold h-9">
                                <option value="all">Alle</option>
                                <option value="i_owe">Ich schulde</option>
                                <option value="owes_me">Schuldet mir</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="payments-list-container" class="grid grid-cols-2 gap-3 pb-20">
                    <p class="col-span-2 text-center text-gray-500 py-8">Lade Daten...</p>
                </div>

                <div id="merge-action-bar"
                    class="hidden fixed bottom-4 left-4 right-4 bg-gray-800 text-white p-3 rounded-xl shadow-2xl z-40 flex justify-between items-center max-w-2xl mx-auto">
                    <span class="font-bold pl-2"><span id="merge-count">0</span> ausgewählt</span>
                    <button id="btn-execute-merge"
                        class="px-4 py-2 bg-indigo-500 hover:bg-indigo-600 rounded-lg font-bold text-sm transition">
                        Zusammenfassen 🔗
                    </button>
                </div>

                <div id="settlementModal"
                    class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 overflow-y-auto">
                    <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Bilanz & Verrechnung</h3>
                        <div id="settlement-user-list" class="space-y-3 max-h-60 overflow-y-auto mb-4">
                            <p class="text-center text-gray-500">Lade Daten...</p>
                        </div>
                        <div id="settlement-detail-view" class="hidden border-t pt-4">
                            <h4 class="font-bold text-lg text-indigo-700 mb-2" id="settlement-partner-name">...</h4>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Du schuldest:</span>
                                <span class="text-red-600 font-bold" id="settlement-i-owe">0,00 €</span>
                            </div>
                            <div class="flex justify-between text-sm mb-3 border-b pb-2">
                                <span>Schuldet dir:</span>
                                <span class="text-emerald-600 font-bold" id="settlement-owes-me">0,00 €</span>
                            </div>
                            <div class="text-center bg-gray-100 p-3 rounded-lg mb-4">
                                <p class="text-xs text-gray-500 uppercase font-bold">Ergebnis (Netto)</p>
                                <p class="text-2xl font-extrabold" id="settlement-net-result">...</p>
                                <p class="text-xs text-gray-600 mt-1" id="settlement-action-text">...</p>
                            </div>
                            <button id="btn-execute-settlement"
                                class="w-full py-3 bg-blue-600 text-white font-bold rounded-lg shadow hover:bg-blue-700 transition">
                                Jetzt verrechnen & glattstellen
                            </button>
                            <p class="text-xs text-gray-400 text-center mt-2">
                                Dadurch werden alle offenen Posten dieser Person als "bezahlt" markiert und nur der
                                Restbetrag bleibt als neuer Eintrag bestehen.
                            </p>
                        </div>
                        <div class="flex justify-end mt-4 pt-2 border-t">
                            <button id="close-settlement-modal"
                                class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Schließen</button>
                        </div>
                    </div>
                </div>

                <div id="createPaymentModal"
                    class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 overflow-y-auto">
                    <div class="bg-white p-0 rounded-xl shadow-2xl w-full max-w-2xl flex flex-col max-h-[90vh]">
                        <div class="p-4 border-b bg-gray-50 rounded-t-xl flex justify-between items-center">
                            <h3 class="text-xl font-bold text-gray-800">Neuer Finanz-Eintrag</h3>
                            <button id="close-create-payment-modal"
                                class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                        </div>

                        <div class="p-2 bg-indigo-50 border-b flex gap-2 items-center justify-between">
                            <span class="text-xs font-bold text-indigo-800 uppercase">Schnellstart:</span>
                            <select id="payment-template-select"
                                class="text-sm border-gray-300 rounded shadow-sm p-1 flex-grow">
                                <option value="">-- Vorlage wählen --</option>
                            </select>
                            <button id="btn-save-as-template"
                                class="text-xs bg-white border border-indigo-200 text-indigo-600 px-2 py-1 rounded hover:bg-indigo-100"
                                title="Aktuelle Eingaben als Vorlage speichern">💾 Speichern</button>
                        </div>

                        <div class="p-4 overflow-y-auto space-y-4 flex-grow">
                            <input type="hidden" id="edit-payment-id" value="">

                            <div id="scenario-selector-container"
                                class="flex flex-col justify-center h-full py-4 space-y-4">
                                <p class="text-center text-gray-500 font-bold mb-2">Was möchtest du erfassen?</p>
                                <div class="grid grid-cols-1 gap-3">
                                    <button id="scenario-i-owe"
                                        class="py-4 px-4 text-lg font-bold rounded-xl text-left transition bg-white border-2 border-red-100 hover:border-red-300 text-red-700 shadow-sm flex items-center gap-3">
                                        <span class="text-2xl">💸</span> Ich schulde Geld
                                    </button>
                                    <button id="scenario-owes-me"
                                        class="py-4 px-4 text-lg font-bold rounded-xl text-left transition bg-white border-2 border-emerald-100 hover:border-emerald-300 text-emerald-700 shadow-sm flex items-center gap-3">
                                        <span class="text-2xl">💰</span> Jemand schuldet mir
                                    </button>
                                    <button id="scenario-other"
                                        class="py-4 px-4 text-lg font-bold rounded-xl text-left transition bg-white border-2 border-gray-200 hover:border-gray-400 text-gray-700 shadow-sm flex items-center gap-3">
                                        <span class="text-2xl">🔄</span> Sonstiges / Transfer
                                    </button>
                                </div>
                            </div>

                            <div id="transaction-details-container" class="hidden space-y-4">

                                <div class="bg-gray-50 p-3 rounded-xl border border-gray-200">
                                    <div class="flex justify-between items-center mb-2">
                                        <button id="btn-back-to-scenario"
                                            class="text-xs font-bold text-indigo-500 hover:underline flex items-center gap-1">
                                            ← Zurück
                                        </button>
                                        <label
                                            class="flex items-center gap-2 cursor-pointer bg-white px-2 py-1 rounded border border-gray-200 shadow-sm hover:bg-gray-50">
                                            <span class="text-xs font-bold text-indigo-600">Gruppe / Split?</span>
                                            <input type="checkbox" id="toggle-split-mode"
                                                class="h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500">
                                        </label>
                                    </div>

                                    <div class="flex flex-row items-start gap-2">
                                        <div class="flex-1 min-w-0">
                                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Von
                                                (Schuldner)</label>
                                            <div id="debtor-single-wrapper" class="flex flex-col gap-1">
                                                <select id="payment-debtor-select"
                                                    class="w-full p-2 border border-gray-300 rounded-lg bg-white text-gray-800 text-sm font-bold shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"></select>
                                                <input type="text" id="payment-debtor-manual"
                                                    class="w-full p-2 border border-gray-300 rounded-lg text-sm hidden"
                                                    placeholder="Name...">
                                                <button id="btn-toggle-debtor-manual"
                                                    class="text-[10px] text-indigo-500 hover:text-indigo-700 font-bold text-right w-full">Manuell
                                                    eingeben</button>
                                            </div>
                                            <div id="debtor-split-wrapper"
                                                class="hidden p-2 bg-white border border-indigo-100 rounded-lg shadow-inner">
                                                <div class="flex gap-1 mb-2 border-b border-indigo-50 pb-1">
                                                    <input type="text" id="split-manual-name-input"
                                                        class="flex-grow p-1 text-xs border rounded"
                                                        placeholder="+ Gast...">
                                                    <button id="btn-add-split-manual"
                                                        class="px-2 bg-indigo-100 text-indigo-700 rounded font-bold text-xs">+</button>
                                                </div>
                                                <div id="split-partner-list" class="max-h-32 overflow-y-auto space-y-1">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="flex flex-col justify-center items-center pt-6">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                                fill="currentColor"
                                                class="w-8 h-8 text-indigo-500 filter drop-shadow-sm transform scale-125">
                                                <path fill-rule="evenodd"
                                                    d="M16.72 7.72a.75.75 0 0 1 1.06 0l3.75 3.75a.75.75 0 0 1 0 1.06l-3.75 3.75a.75.75 0 1 1-1.06-1.06l2.47-2.47H3a.75.75 0 0 1 0-1.5h16.19l-2.47-2.47a.75.75 0 0 1 0-1.06Z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                        </div>

                                        <div class="flex-1 min-w-0">
                                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">An
                                                (Gläubiger)</label>
                                            <div class="flex flex-col gap-1">
                                                <select id="payment-creditor-select"
                                                    class="w-full p-2 border border-gray-300 rounded-lg bg-white text-gray-800 text-sm font-bold shadow-sm border-l-4 border-l-emerald-400 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"></select>
                                                <input type="text" id="payment-creditor-manual"
                                                    class="w-full p-2 border border-gray-300 rounded-lg text-sm hidden"
                                                    placeholder="Empfänger...">
                                                <button id="btn-toggle-creditor-manual"
                                                    class="text-[10px] text-indigo-500 hover:text-indigo-700 font-bold text-right w-full">Manuell
                                                    eingeben</button>
                                            </div>
                                            <p class="text-[10px] text-gray-400 mt-1 italic leading-tight"
                                                id="creditor-details-hint"></p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-gray-50 p-3 rounded-xl border border-gray-200 mb-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-xs font-bold text-gray-500 uppercase">Positionen
                                            (Optional)</label>
                                        <button id="btn-add-position"
                                            class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded hover:bg-indigo-200 font-bold flex items-center gap-1">
                                            <span>+</span> Posten
                                        </button>
                                    </div>

                                    <div id="positions-container" class="space-y-2 mb-2 hidden"></div>

                                    <div class="flex justify-between items-center pt-2 border-t border-gray-200 gap-2">
                                        <span class="text-sm font-bold text-gray-700">Gesamtbetrag:</span>
                                        <div class="relative w-1/2">
                                            <span
                                                class="absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 font-bold">€</span>
                                            <input type="number" id="payment-amount"
                                                class="w-full pl-6 p-1 border border-gray-300 rounded-lg font-mono font-bold text-right text-gray-800 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
                                                placeholder="0.00" step="0.01">
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Grund / Betreff</label>
                                    <input type="text" id="payment-title"
                                        class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                        placeholder="z.B. Rückerstattung Amazon, Miete...">
                                </div>

                                <div class="border-t border-gray-100 pt-2">
                                    <button id="btn-toggle-advanced-payment"
                                        class="flex items-center gap-1 text-xs text-indigo-600 font-bold hover:text-indigo-800 transition w-full justify-center py-2 bg-indigo-50 rounded-lg">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                            class="w-4 h-4">
                                            <path fill-rule="evenodd"
                                                d="M10 3a1 1 0 0 1 .707.293l3 3a1 1 0 0 1-1.414 1.414L10 5.414 7.707 7.707a1 1 0 0 1-1.414-1.414l3-3A1 1 0 0 1 10 3Zm-3.707 9.293a1 1 0 0 1 1.414 0L10 14.586l2.293-2.293a1 1 0 0 1 1.414 1.414l-3 3a1 1 0 0 1-1.414 0l-3-3a1 1 0 0 1 0-1.414Z"
                                                clip-rule="evenodd" />
                                        </svg>
                                        Datum, Kategorie & Details
                                    </button>
                                </div>

                                <div id="payment-advanced-options"
                                    class="hidden space-y-4 p-3 bg-gray-50 rounded-lg border border-gray-200">

                                    <div class="grid grid-cols-2 gap-4 items-start pb-4 border-b border-gray-200">

                                        <div class="flex flex-col gap-4">
                                            <div>
                                                <label
                                                    class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Kategorie</label>
                                                <select id="payment-category-select"
                                                    class="w-full p-2 border border-gray-300 rounded-lg bg-white text-sm"></select>
                                            </div>

                                            <div id="tbd-wrapper" class="flex items-end">
                                                <label
                                                    class="flex items-center gap-2 cursor-pointer p-2 border border-gray-200 rounded-lg hover:bg-gray-50 transition w-full h-10 border-l-4 border-l-orange-400 bg-white">
                                                    <input type="checkbox" id="payment-amount-tbd"
                                                        class="h-5 w-5 text-orange-500 rounded focus:ring-orange-500">
                                                    <span class="text-xs text-gray-700 font-bold">Betrag
                                                        unbekannt</span>
                                                </label>
                                            </div>
                                        </div>

                                        <div class="flex flex-col gap-3">
                                            <div>
                                                <label
                                                    class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Datum
                                                    (Start)</label>
                                                <input type="date" id="payment-start-date"
                                                    class="w-full p-2 border border-gray-300 rounded-lg bg-white text-sm">
                                            </div>
                                            <div>
                                                <label
                                                    class="block text-[10px] font-bold text-gray-400 uppercase mb-1">Fälligkeit
                                                    (Optional)</label>
                                                <input type="date" id="payment-deadline"
                                                    class="w-full p-2 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 text-sm text-gray-600 focus:bg-white focus:border-indigo-300 h-10">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label
                                                class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Rechnungs-Nr.</label>
                                            <input type="text" id="payment-invoice-nr"
                                                class="w-full p-2 border border-gray-300 rounded-lg text-sm"
                                                placeholder="#">
                                        </div>
                                        <div>
                                            <label
                                                class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Bestell-Nr.</label>
                                            <input type="text" id="payment-order-nr"
                                                class="w-full p-2 border border-gray-300 rounded-lg text-sm"
                                                placeholder="#">
                                        </div>
                                    </div>
                                    <textarea id="payment-notes"
                                        class="w-full p-2 border border-gray-300 rounded-lg text-sm" rows="2"
                                        placeholder="Interne Notizen..."></textarea>
                                    <div>
                                        <label
                                            class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Buchungstyp</label>
                                        <select id="payment-type"
                                            class="w-full p-2 border border-gray-300 rounded-lg bg-white text-sm">
                                            <option value="debt">Schulde / Forderung / Erstattung (Standard)</option>
                                            <option value="transfer">Umbuchung (Konto zu Konto)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>




                        <div class="p-4 border-t bg-gray-50 rounded-b-xl flex justify-end gap-3">
                            <button id="btn-cancel-create-payment"
                                class="py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300">Abbrechen</button>
                            <button id="btn-save-payment"
                                class="py-2 px-6 bg-emerald-600 text-white font-bold rounded-lg hover:bg-emerald-700 shadow-md">Speichern</button>
                        </div>
                    </div>
                </div>

                <div id="paymentDetailModal"
                    class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 overflow-y-auto">
                    <div class="bg-white p-0 rounded-xl shadow-2xl w-full max-w-2xl flex flex-col max-h-[95vh]">
                        <div class="p-4 border-b flex justify-between items-center no-print">
                            <h3 class="text-lg font-bold text-gray-800">Details & Verlauf</h3>
                            <div class="flex gap-2">
                                <button id="btn-print-payment"
                                    class="p-2 bg-gray-100 text-gray-600 rounded hover:bg-gray-200" title="Drucken">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                        class="w-5 h-5">
                                        <path fill-rule="evenodd"
                                            d="M5 2.75C5 1.784 5.784 1 6.75 1h6.5c.966 0 1.75.784 1.75 1.75V5.5a.75.75 0 0 1-1.5 0V2.75a.25.25 0 0 0-.25-.25h-6.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h2.75a.75.75 0 0 1 0 1.5H6.75A1.75 1.75 0 0 1 5 13.25V2.75Zm6 9.75a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0v-1.5h-1.5a.75.75 0 0 1 .75-.75Z"
                                            clip-rule="evenodd" />
                                        <path d="M14.5 6.5a2 2 0 1 1 4 0 2 2 0 0 1-4 0Z" />
                                    </svg>
                                </button>
                                <button id="btn-close-detail-modal"
                                    class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                            </div>
                        </div>
                        <div id="payment-detail-content" class="p-6 overflow-y-auto flex-grow"></div>
                        <div id="transaction-history-section" class="px-6 pb-4 hidden border-t bg-gray-50">
                            <h4 class="font-bold text-gray-700 mb-2 pt-4">Zahlungseingänge / Teilzahlungen</h4>
                            <div id="transaction-list" class="space-y-2 text-sm"></div>
                        </div>
                        <div class="p-4 border-t bg-gray-50 rounded-b-xl flex flex-col gap-2 no-print">
                            <div id="payment-detail-actions" class="flex flex-wrap gap-2 justify-end"></div>
                            <div id="partial-payment-form"
                                class="hidden p-3 bg-white border rounded-lg mt-2 shadow-inner">
                                <label class="block text-sm font-bold mb-1 text-gray-700">Zahlung erfassen</label>
                                <div class="flex gap-2">
                                    <input type="number" id="partial-amount-input"
                                        class="flex-grow p-2 border rounded font-mono" placeholder="Betrag..."
                                        step="0.01">
                                    <button id="btn-submit-partial"
                                        class="bg-green-600 text-white px-4 rounded font-bold hover:bg-green-700 shadow">Buchen</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="zahlungsverwaltungSettingsView" class="view">
                <div class="back-link-container w-full mb-4">
                    <button class="back-link flex items-center text-gray-600 hover:text-indigo-600 transition"
                        data-target="zahlungsverwaltung">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="w-5 h-5 mr-1">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                        <span class="text-sm font-semibold">zurück</span>
                    </button>
                    <div class="border-t border-gray-300 mt-2"></div>
                </div>

                <h2 class="text-2xl font-bold text-gray-800 mb-4">Finanz-Einstellungen</h2>

                <div class="flex gap-2 mb-4 border-b flex-wrap">
                    <button id="tab-zv-requests"
                        class="px-4 py-2 font-bold text-gray-500 hover:text-gray-700 whitespace-nowrap">Anfragen</button>
                    <button id="tab-zv-templates"
                        class="px-4 py-2 font-bold text-gray-500 hover:text-gray-700 whitespace-nowrap">Vorlagen</button>
                    <button id="tab-zv-accounts"
                        class="px-4 py-2 font-bold text-gray-500 hover:text-gray-700 whitespace-nowrap">Meine
                        Konten</button>
                    <button id="tab-zv-categories"
                        class="px-4 py-2 font-bold text-gray-500 hover:text-gray-700 whitespace-nowrap">Kategorien</button>
                    <button id="tab-zv-contacts"
                        class="px-4 py-2 font-bold text-gray-500 hover:text-gray-700 whitespace-nowrap">Adressbuch</button>
                    <button id="tab-zv-credits"
                        class="px-4 py-2 font-bold text-gray-500 hover:text-gray-700 whitespace-nowrap">Guthaben</button>
                    <button id="tab-zv-archive"
                        class="px-4 py-2 font-bold text-gray-500 hover:text-gray-700 whitespace-nowrap">Archiv</button>
                </div>

                <div id="content-zv-templates" class="space-y-4">
                    <div class="bg-blue-50 p-3 rounded-lg text-sm text-blue-800 mb-2">
                        Erstelle Bausteine für wiederkehrende Zahlungen (z.B. "Miete", "Spotify").
                    </div>
                    <div id="zv-templates-list" class="space-y-2">
                        <p class="text-gray-400 text-center py-4">Lade Vorlagen...</p>
                    </div>
                </div>

                <div id="content-zv-accounts" class="hidden space-y-4">
                    <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-blue-600">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Meine Geld-Konten</h3>
                        <p class="text-xs text-gray-500 mb-4">Definiere hier deine Geldbörsen oder Bankkonten.</p>
                        <div class="p-3 bg-gray-50 rounded-lg border mb-4 space-y-2">
                            <input type="text" id="new-account-name" class="w-full p-2 border rounded-lg"
                                placeholder="Name (z.B. Haushaltskonto)">
                            <input type="text" id="new-account-details" class="w-full p-2 border rounded-lg text-sm"
                                placeholder="Details (z.B. IBAN AT12...)">
                            <button id="btn-add-account-setting"
                                class="w-full py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700">+
                                Konto anlegen</button>
                        </div>
                        <div id="zv-accounts-list" class="space-y-2 max-h-80 overflow-y-auto">
                            <p class="text-center text-gray-400 italic">Keine eigenen Konten angelegt.</p>
                        </div>
                    </div>
                </div>

                <div id="content-zv-categories" class="hidden space-y-4">
                    <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-pink-500">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Kategorien verwalten</h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-category-name-input" class="flex-grow p-2 border rounded-lg"
                                placeholder="Neue Kategorie">
                            <button id="btn-add-category-setting"
                                class="px-4 py-2 bg-pink-600 text-white font-bold rounded-lg hover:bg-pink-700">+</button>
                        </div>
                        <div id="zv-categories-list" class="space-y-2 max-h-80 overflow-y-auto"></div>
                    </div>
                </div>

                <div id="content-zv-contacts" class="hidden space-y-4">
                    <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-teal-500">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Mein Adressbuch</h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-contact-name-input" class="flex-grow p-2 border rounded-lg"
                                placeholder="Name (z.B. Max)">
                            <button id="btn-add-contact-setting"
                                class="px-4 py-2 bg-teal-600 text-white font-bold rounded-lg hover:bg-teal-700">+</button>
                        </div>
                        <div id="zv-contacts-list" class="space-y-2 max-h-80 overflow-y-auto"></div>
                    </div>
                </div>

                <div id="content-zv-credits" class="hidden space-y-6">
                    <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-purple-500">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Mein Guthaben (bei anderen)</h3>
                        <div id="my-credits-list" class="space-y-2 mb-4"></div>
                        <button id="btn-add-my-credit"
                            class="w-full py-2 bg-purple-100 text-purple-700 font-bold rounded hover:bg-purple-200 transition">+
                            Guthaben einzahlen / aufladen</button>
                    </div>
                    <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-orange-500">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Fremdes Guthaben (bei mir)</h3>
                        <div id="others-credits-list" class="space-y-2 mb-4"></div>
                        <button id="btn-add-other-credit"
                            class="w-full py-2 bg-orange-100 text-orange-700 font-bold rounded hover:bg-orange-200 transition">+
                            Guthaben für jemanden verbuchen</button>
                    </div>
                </div>

                <div id="content-zv-requests" class="hidden space-y-4">
                </div>

                <div id="content-zv-archive" class="hidden h-full">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 h-full">

                        <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-gray-400 flex flex-col">
                            <h3 class="text-lg font-bold text-gray-800 mb-2 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                                </svg>
                                Archiviert
                            </h3>
                            <p class="text-xs text-gray-500 mb-4">Einträge, die ausgeblendet wurden.</p>
                            <div id="zv-archive-list"
                                class="space-y-2 overflow-y-auto max-h-96 flex-grow p-1 bg-gray-50 rounded border border-gray-100">
                                <p class="text-center text-gray-400 italic py-4">Leer.</p>
                            </div>
                        </div>

                        <div class="card bg-white p-4 rounded-xl shadow-lg border-t-4 border-red-500 flex flex-col">
                            <h3 class="text-lg font-bold text-gray-800 mb-2 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                                Papierkorb
                            </h3>
                            <p class="text-xs text-gray-500 mb-4">Endstation für gelöschte Einträge (Audit-Log).</p>
                            <div id="zv-trash-list"
                                class="space-y-2 overflow-y-auto max-h-96 flex-grow p-1 bg-red-50 rounded border border-red-100">
                                <p class="text-center text-gray-400 italic py-4">Leer.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div id="creditManageModal"
                class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[70]">
                <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                    <h3 class="text-xl font-bold text-gray-800 mb-2" id="credit-modal-title">Guthaben verwalten</h3>
                    <p class="text-sm text-gray-600 mb-4" id="credit-modal-desc">...</p>
                    <input type="hidden" id="credit-mode" value="add">
                    <input type="hidden" id="credit-context" value="my">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1"
                                id="label-credit-partner">Person</label>
                            <select id="credit-partner-select" class="w-full p-2 border rounded-lg bg-white"></select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Betrag (€)</label>
                            <input type="number" id="credit-amount"
                                class="w-full p-2 border rounded-lg font-mono text-lg" placeholder="0.00" step="0.01">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Grund / Notiz</label>
                            <input type="text" id="credit-reason" class="w-full p-2 border rounded-lg"
                                placeholder="z.B. Einzahlung, Rückzahlung...">
                        </div>
                        <div id="credit-sub-warning"
                            class="hidden p-2 bg-red-50 text-red-700 text-xs rounded border border-red-200">
                            Hinweis: Abbuchen reduziert das bestehende Guthaben.
                        </div>
                    </div>
                    <div class="flex justify-end gap-2 mt-6">
                        <button id="btn-cancel-credit"
                            class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Abbrechen</button>
                        <button id="btn-save-credit"
                            class="px-4 py-2 bg-green-600 text-white font-bold rounded hover:bg-green-700">Buchen</button>
                    </div>
                </div>
            </div>

            <div id="creditDetailsModal"
                class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[80]">
                <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md flex flex-col max-h-[80vh]">
                    <div class="flex justify-between items-center mb-4 border-b pb-2">
                        <h3 class="text-xl font-bold text-gray-800" id="credit-details-title">Guthaben Details</h3>
                        <button id="close-credit-details-btn"
                            class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                    </div>

                    <div class="bg-gray-100 p-3 rounded-lg mb-4 flex justify-between items-center">
                        <span class="text-sm font-bold text-gray-500">Gesamt:</span>
                        <span class="text-xl font-extrabold text-gray-800" id="credit-details-total">0,00 €</span>
                    </div>

                    <p class="text-xs text-gray-400 uppercase font-bold mb-2">Einzelne Posten:</p>
                    <div id="credit-details-list" class="space-y-2 overflow-y-auto flex-grow">
                    </div>

                    <div class="flex justify-end mt-4 pt-2 border-t">
                        <button id="btn-close-credit-details"
                            class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Schließen</button>
                    </div>
                </div>
            </div>

        </main>


        <div id="sticky-save-bar" class="hidden flex-shrink-0 bg-red-700 text-white p-3
            flex justify-between items-center shadow-lg border-t-4 border-red-400 animate-pulse
            transition-all duration-300 z-20">
            <span id="sticky-save-text" class="text-sm font-medium">Änderungen noch nicht gespeichert.</span>
            <button id="sticky-save-button"
                class="py-2 px-4 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition shadow-md text-sm">
                Jetzt Speichern
            </button>
        </div>

        <div id="pendingNotificationsModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col">
                <div class="flex justify-between items-center mb-4 border-b pb-3">
                    <h3 class="text-xl font-bold text-red-600">⚠️ Ausstehende Benachrichtigungen</h3>
                    <button id="closePendingNotificationsModal"
                        class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                </div>

                <div class="text-sm text-gray-600 mb-4">
                    Bitte quittieren Sie die folgenden Benachrichtigungen, um sie zu bestätigen.
                </div>

                <div id="pendingNotificationsList" class="flex-grow overflow-y-auto space-y-3 mb-4">
                    <p class="text-sm text-gray-400 text-center">Keine ausstehenden Benachrichtigungen</p>
                </div>
            </div>
        </div>

        <div id="customizeNotificationModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg">
                <div class="flex justify-between items-center mb-4 border-b pb-3">
                    <h3 class="text-xl font-bold text-gray-800">Benachrichtigungstext anpassen</h3>
                    <button id="closeCustomizeNotificationModal"
                        class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label for="customNotificationTitle" class="block text-sm font-medium text-gray-700 mb-1">Titel</label>
                        <input type="text" id="customNotificationTitle"
                            class="w-full p-2 border rounded-lg"
                            placeholder="Titel der Benachrichtigung">
                    </div>

                    <div>
                        <label for="customNotificationMessage" class="block text-sm font-medium text-gray-700 mb-1">Nachricht</label>
                        <textarea id="customNotificationMessage" rows="4"
                            class="w-full p-2 border rounded-lg"
                            placeholder="Nachrichtentext"></textarea>
                        <p id="customNotificationPlaceholders" class="text-xs text-gray-500 mt-1">
                            Verfügbare Platzhalter werden hier angezeigt
                        </p>
                    </div>
                </div>

                <div class="flex gap-3 mt-6">
                    <button id="saveCustomNotificationBtn"
                        class="flex-1 py-2 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition">
                        Speichern
                    </button>
                    <button id="cancelCustomNotificationBtn"
                        class="flex-1 py-2 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">
                        Abbrechen
                    </button>
                </div>
            </div>
        </div>

        <footer id="appFooter"
            class="flex-shrink-0 bg-gray-700 text-white border-t border-gray-600 p-2 flex justify-between items-center text-sm shadow-inner">
            <div id="footerStatus" class="flex items-center text-xs sm:text-sm font-bold text-gray-500">
                Status: <span class="ml-1 text-green-500">OK</span>
            </div>
            <div id="footerUser" class="font-medium text-xs sm:text-sm text-center">
            </div>
            <div id="footerLogout" class="flex items-center justify-end text-xs sm:text-sm">
            </div>
        </footer>

        <div id="templateApplyModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-30">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">Container-Inhalt einfügen</h3>
                    <button id="closeTemplateModalBtn" class="text-gray-400 hover:text-red-600">&times;</button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">1. Quell-Typ wählen</label>
                        <div class="grid grid-cols-2 gap-2 p-1 bg-gray-200 rounded-lg">
                            <label class="relative flex items-center justify-center cursor-pointer">
                                <input type="radio" name="template-type" value="Container" class="peer sr-only" checked>
                                <span
                                    class="w-full text-center py-1.5 px-3 rounded-md text-sm font-semibold text-gray-700 peer-checked:bg-white peer-checked:shadow">Container</span>
                            </label>
                            <label class="relative flex items-center justify-center cursor-pointer">
                                <input type="radio" name="template-type" value="Schiff" class="peer sr-only">
                                <span
                                    class="w-full text-center py-1.5 px-3 rounded-md text-sm font-semibold text-gray-700 peer-checked:bg-white peer-checked:shadow">Schiff</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label for="template-select" class="block text-sm font-medium text-gray-700 mb-1">2. Quelle
                            auswählen</label>
                        <select id="template-select" class="w-full p-2 border rounded-lg bg-white">
                            <option value="">Bitte zuerst Typ wählen...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">3. Inhalte zum Einfügen
                            auswählen</label>
                        <div id="template-items-container"
                            class="max-h-48 overflow-y-auto p-3 border rounded-lg bg-gray-50 space-y-2">
                        </div>
                    </div>
                    <div id="template-mode-section" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">4. Einfüge-Methode</label>
                        <div class="flex gap-4 p-2 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="insert-mode" value="einfuegen" class="h-4 w-4" checked>
                                <span>Zur Liste hinzufügen</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="insert-mode" value="ersetzen" class="h-4 w-4">
                                <span>Liste komplett ersetzen</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end space-x-3 mt-6">
                    <button id="cancel-template-modal-btn"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">Abbrechen</button>
                    <button id="apply-template-btn"
                        class="py-2 px-4 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition">Anwenden</button>
                </div>
            </div>
        </div>
        <div id="deletedListsModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-20">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Gelöschte Checklisten</h3>
                <div id="deletedListsContainer" class="space-y-3 max-h-96 overflow-y-auto">
                </div>
                <div class="flex justify-end mt-6">
                    <button id="closeDeletedListsModal"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">Schließen</button>
                </div>
            </div>
        </div>

        <div id="archivedListsModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-20">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Archivierte Checklisten</h3>
                <div id="archivedListsContainer" class="space-y-3 max-h-96 overflow-y-auto">
                </div>
                <div class="flex justify-end mt-6">
                    <button id="closeArchivedListsModal"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">Schließen</button>
                </div>
            </div>
        </div>

        <div id="permanentDeleteModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-30">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg">
                <h3 class="text-xl font-bold mb-4 text-red-800">Papierkorb endgültig leeren</h3>
                <p class="text-sm text-gray-600 mb-4">Wählen Sie die Checklisten aus, die unwiderruflich gelöscht werden
                    sollen. Diese Aktion kann nicht rückgängig gemacht werden.</p>

                <div class="p-2 border-b mb-2">
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" id="permanent-delete-select-all"
                            class="h-5 w-5 rounded border-gray-400 text-indigo-600 focus:ring-indigo-500">
                        <span class="font-semibold text-gray-700">Alle auswählen / abwählen</span>
                    </label>
                </div>

                <div id="permanentDeleteListsContainer"
                    class="space-y-2 max-h-64 overflow-y-auto p-2 border rounded-lg bg-gray-50">
                </div>

                <div class="flex justify-between items-center space-x-3 mt-6">
                    <button id="cancelPermanentDeleteBtn"
                        class="flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">Abbrechen</button>
                    <button id="confirmPermanentDeleteBtn"
                        class="flex-1 py-2 px-4 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition">Auswahl
                        endgültig löschen</button>
                </div>
            </div>
        </div>

        <div id="contactBookModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-30">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg flex flex-col gap-4">
                <h3 class="text-xl font-bold text-gray-800">Kontaktbuch</h3>

                <div id="contactBookList" class="space-y-2 max-h-48 overflow-y-auto p-3 border rounded-lg bg-gray-50">
                    <p class="text-sm text-center text-gray-400">Keine Kontakte gefunden.</p>
                </div>

                <div class="p-4 border rounded-xl bg-green-50 space-y-2">
                    <h4 class="font-semibold text-green-800">Neuen Kontakt anlegen</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                        <select id="contactIsGroup" class="p-2 border rounded-lg bg-white">
                            <option value="User" selected>User</option>
                            <option value="Gruppe">Gruppe</option>
                        </select>
                        <input type="text" id="contactName" class="p-2 border rounded-lg" placeholder="Anzeigename">
                    </div>
                    <input type="text" id="contactUserKey" class="w-full p-2 border rounded-lg"
                        placeholder="User / Group Key">
                    <button id="contactAddButton"
                        class="w-full py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700">Hinzufügen</button>
                </div>
                <div class="flex justify-end space-x-3 mt-4">
                    <button id="contactBookCloseButton"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300">Schließen</button>
                    <button id="contactBookApplyButton"
                        class="py-2 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700">Auswahl
                        übernehmen</button>
                </div>
            </div>
        </div>

        <div id="nachrichtencenterContactBookModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-40">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-2xl flex flex-col gap-4">
                <h3 class="text-xl font-bold text-gray-800">Nachrichtencenter - Kontaktbuch</h3>

                <div class="grid grid-cols-2 gap-1 border rounded-lg bg-gray-100 p-1">
                    <button id="nachrichtencenterContactsTabGlobal" data-scope="global"
                        class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600 bg-white shadow text-indigo-600">
                        GLOBAL-Adressbuch
                    </button>
                    <button id="nachrichtencenterContactsTabPrivate" data-scope="private"
                        class="settings-tab-btn p-2 text-sm font-semibold rounded-md text-gray-600">
                        Eigenes Adressbuch
                    </button>
                </div>

                <div id="nachrichtencenterContactsListGlobal" class="space-y-2 max-h-52 overflow-y-auto p-3 border rounded-lg bg-gray-50">
                    <p class="text-sm text-center text-gray-400">Keine Kontakte gefunden.</p>
                </div>
                <div id="nachrichtencenterContactsListPrivate" class="space-y-2 max-h-52 overflow-y-auto p-3 border rounded-lg bg-gray-50 hidden">
                    <p class="text-sm text-center text-gray-400">Keine Kontakte gefunden.</p>
                </div>

                <div class="p-4 border rounded-xl bg-green-50 space-y-2">
                    <h4 id="nachrichtencenterContactsFormTitle" class="font-semibold text-green-800">Neuen Kontakt anlegen</h4>
                    <input type="hidden" id="nachrichtencenterEditingContactId">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                        <select id="nachrichtencenterContactType" class="p-2 border rounded-lg bg-white">
                            <option value="User" selected>User</option>
                            <option value="Gruppe">Gruppe</option>
                        </select>
                        <input type="text" id="nachrichtencenterContactName" class="p-2 border rounded-lg" placeholder="Anzeigename">
                        <input type="text" id="nachrichtencenterContactKey" class="p-2 border rounded-lg" placeholder="Pushover Key">
                    </div>
                    <p class="text-xs text-gray-600">GLOBAL: sichtbar für alle. Privat: nur für dich.</p>
                    <button id="nachrichtencenterContactSaveButton"
                        class="w-full py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700">Speichern</button>
                </div>

                <div class="flex justify-end space-x-3 mt-2">
                    <button id="nachrichtencenterContactBookCloseButton"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300">Schließen</button>
                    <button id="nachrichtencenterContactBookApplyButton"
                        class="py-2 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700">Auswahl
                        übernehmen</button>
                </div>
            </div>
        </div>

        <div id="apiTokenBookModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-40">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg flex flex-col gap-4">
                <h3 class="text-xl font-bold text-gray-800">API-Token Verwalten</h3>
                <div id="apiTokenBookList" class="space-y-2 max-h-48 overflow-y-auto p-3 border rounded-lg bg-gray-50">
                    <p class="text-sm text-center text-gray-400">Keine Tokens gefunden.</p>
                </div>
                <div class="p-4 border rounded-xl bg-green-50 space-y-2">
                    <h4 class="font-semibold text-green-800">Neuen Token anlegen</h4>
                    <input type="text" id="apiTokenName" class="w-full p-2 border rounded-lg"
                        placeholder="Bezeichnung (z.B. App Name)">
                    <input type="text" id="apiTokenKey" class="w-full p-2 border rounded-lg"
                        placeholder="API / Application Key">
                    <button id="apiTokenAddButton"
                        class="w-full py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700">Hinzufügen</button>
                </div>
                <div class="flex justify-end space-x-3 mt-4">
                    <button id="apiTokenBookCloseButton"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300">Schließen</button>
                    <button id="apiTokenBookApplyButton"
                        class="py-2 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700">Auswahl
                        übernehmen</button>
                </div>
            </div>
        </div>

        <div id="soundBookModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-40">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg flex flex-col gap-4">
                <h3 class="text-xl font-bold text-gray-800">Sounds Verwalten</h3>
                <div id="soundBookList" class="space-y-2 max-h-48 overflow-y-auto p-3 border rounded-lg bg-gray-50">
                    <div class="flex items-center justify-between p-2 hover:bg-gray-100 rounded-md">
                        <label class="flex items-center gap-3 cursor-pointer flex-grow">
                            <input type="radio" name="soundSelection" value="default" class="h-4 w-4 sound-radio">
                            <div>
                                <span class="font-semibold text-gray-800">Standard (pushover)</span>
                                <p class="text-xs text-gray-500 italic">Verwendet den in der Pushover-App eingestellten
                                    Ton</p>
                            </div>
                        </label>
                    </div>
                    <p id="sound-list-placeholder" class="text-sm text-center text-gray-400 hidden">Keine eigenen Sounds
                        gefunden.</p>
                </div>
                <div class="p-4 border rounded-xl bg-green-50 space-y-2">
                    <h4 class="font-semibold text-green-800">Neuen Sound anlegen</h4>
                    <input type="text" id="soundCode" class="w-full p-2 border rounded-lg"
                        placeholder="Soundcode (von Pushover)">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="soundUseCustomName" class="h-4 w-4">
                        <label for="soundUseCustomName" class="text-sm font-medium">Eigenen Anzeigenamen
                            verwenden</label>
                    </div>
                    <input type="text" id="soundCustomName" class="w-full p-2 border rounded-lg hidden"
                        placeholder="Eigener Anzeigename">
                    <button id="soundAddButton"
                        class="w-full py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700">Hinzufügen</button>
                </div>
                <div class="flex justify-end space-x-3 mt-4">
                    <button id="soundBookCloseButton"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300">Schließen</button>
                    <button id="soundBookApplyButton"
                        class="py-2 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700">Auswahl
                        übernehmen</button>
                </div>
            </div>
        </div>

        <div id="createVoteModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-30">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-3xl">
                <div class="flex justify-between items-center mb-6 pb-3 border-b">
                    <h3 class="text-2xl font-bold text-gray-800">Neuen Termin erstellen</h3>
                    <button id="close-create-vote-modal-btn"
                        class="text-gray-400 hover:text-red-600 font-bold text-3xl">&times;</button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

                    <div id="select-vote-type-group"
                        class="p-4 border rounded-lg hover:shadow-lg hover:border-indigo-500 cursor-pointer transition-all duration-200 flex flex-col items-center text-center">
                        <div class="p-4 rounded-lg bg-yellow-100 mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                                class="w-10 h-10 text-yellow-600">
                                <path fill-rule="evenodd"
                                    d="M4.5 3.75a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h10.5a3 3 0 0 0 3-3V6.75a3 3 0 0 0-3-3H4.5ZM12 7.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Zm-3 3a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Zm6 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </div>
                        <h4 class="font-bold text-lg text-gray-800">Termin MatchFinder</h4>
                        <p class="text-sm text-gray-600 mt-1">Finde schnell den perfekten Termin, der für alle in deiner
                            Gruppe passt.</p>
                    </div>

                    <div id="select-vote-type-survey"
                        class="p-4 border rounded-lg opacity-50 cursor-not-allowed transition-all duration-200 flex flex-col items-center text-center">
                        <div class="p-4 rounded-lg bg-gray-100 mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                                class="w-10 h-10 text-gray-400">
                                <path fill-rule="evenodd"
                                    d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </div>
                        <h4 class="font-bold text-lg text-gray-800">Allgemeine Umfragen</h4>
                        <p class="text-sm text-gray-600 mt-1">Diese Application ist noch nicht verfügbar. Coming soon.
                        </p>
                    </div>

                </div>
            </div>
        </div>


        <div id="correctionLogModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-40">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg flex flex-col gap-4">
                <div class="flex justify-between items-center">
                    <h3 id="correction-log-title" class="text-xl font-bold text-gray-800">Korrektur-Verlauf</h3>
                    <button id="close-correction-log-btn"
                        class="text-gray-400 hover:text-red-600 font-bold text-3xl">&times;</button>
                </div>

                <div id="correction-log-content"
                    class="space-y-4 max-h-96 overflow-y-auto p-2 border rounded-lg bg-gray-50">
                    <p class="text-sm text-center text-gray-400">Keine Korrekturen gefunden.</p>
                </div>
            </div>
        </div>

        <div id="assignUserModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-40">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md flex flex-col gap-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800">Teilnehmer zuweisen</h3>
                    <button id="assign-user-modal-close-btn"
                        class="text-gray-400 hover:text-red-600 font-bold text-3xl">&times;</button>
                </div>

                <p class="text-sm text-gray-600">Wähle die registrierten Benutzer aus, die diese Umfrage in ihrer
                    persönlichen Liste sehen sollen.</p>

                <div id="assign-user-list" class="space-y-2 max-h-64 overflow-y-auto p-3 border rounded-lg bg-gray-50">
                    <p class="text-sm text-center text-gray-400">Lade Benutzer...</p>
                </div>

                <div class="flex justify-end space-x-3 mt-4">
                    <button id="assign-user-modal-cancel-btn"
                        class="py-2 px-4 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300">Abbrechen</button>
                    <button id="assign-user-modal-apply-btn"
                        class="py-2 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700">Auswahl
                        übernehmen</button>
                </div>
            </div>
        </div>
        <div id="voteCreatedModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md flex flex-col gap-4">

                <h3 class="text-2xl font-bold text-green-700">Umfrage erfolgreich erstellt!</h3>

                <p class="text-sm text-gray-600">
                    Deine Umfrage ist jetzt live. Hier sind deine Zugangs-Tokens.
                </p>

                <div class="space-y-3 p-4 bg-gray-50 border rounded-lg">
                    <div>
                        <label class="block text-sm font-bold text-gray-700">Umfrage-Token (zum Teilen):</label>
                        <code id="new-vote-token-display"
                            class="block w-full p-2 bg-white border rounded-md text-lg font-mono text-indigo-700 tracking-widest">...</code>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700">EDIT-Token (Nicht weitergeben!):</label>
                        <code id="new-edit-token-display"
                            class="block w-full p-2 bg-white border rounded-md text-lg font-mono text-red-700 tracking-widest">...</code>
                    </div>
                </div>

                <div class="text-xs text-gray-600 space-y-2">
                    <p>
                        <strong>Tipp 1:</strong> Den <strong>Umfrage-Token</strong> siehst du jederzeit, wenn du die
                        Umfrage öffnest. Dort kannst du ihn kopieren und weitergeben.
                    </p>
                    <p>
                        <strong>Tipp 2:</strong> Den <strong>EDIT-Token</strong> (nur für dich!) kannst du in der
                        Umfrage über den 'EDIT'-Knopf (für 10 Sek.) wieder einblenden.
                    </p>
                </div>

                <div class="flex justify-end mt-4">
                    <button id="close-vote-created-modal-btn"
                        class="py-2 px-6 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700">
                        Verstanden
                    </button>
                </div>
            </div>
        </div>

        <div id="splitEntryModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Eintrag aufsplitten</h3>
                <p class="text-sm text-gray-600 mb-4">Der aktuelle Eintrag wird reduziert, und ein neuer Eintrag für den
                    abgespaltenen Betrag wird erstellt.</p>

                <div class="bg-gray-100 p-3 rounded-lg mb-4">
                    <p class="text-xs text-gray-500">Ursprungssumme (Rest)</p>
                    <p class="text-lg font-bold text-gray-800" id="split-original-amount-display">0,00 €</p>
                </div>

                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Abzuspalter Betrag (€)</label>
                        <input type="number" id="split-amount-input" class="w-full p-2 border rounded-lg font-mono"
                            placeholder="0.00">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Titel für neuen Eintrag</label>
                        <input type="text" id="split-title-input" class="w-full p-2 border rounded-lg"
                            placeholder="z.B. Teil 2">
                    </div>
                </div>

                <div class="flex justify-end gap-2 mt-6">
                    <button id="btn-cancel-split"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Abbrechen</button>
                    <button id="btn-confirm-split"
                        class="px-4 py-2 bg-indigo-600 text-white font-bold rounded hover:bg-indigo-700">Aufteilen</button>
                </div>
            </div>
        </div>


        <div id="adjustAmountModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-xl font-bold text-gray-800">Eintrag korrigieren</h3>
                    <button id="close-adjust-modal"
                        class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                </div>

                <div id="adjust-history-trace"
                    class="mb-4 p-2 bg-gray-50 rounded-lg border border-gray-200 text-xs text-gray-500 hidden">
                    <p class="font-bold text-gray-400 uppercase mb-1">Historie der Gesamtbeträge:</p>
                    <ul id="adjust-history-list" class="list-disc list-inside space-y-0.5"></ul>
                </div>

                <div class="space-y-4">
                    <div class="bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                        <p class="text-xs font-bold text-indigo-800 uppercase mb-2">Betrag & Modus</p>
                        <div class="flex flex-col gap-2 mb-3">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="adjust-mode" value="total"
                                    class="h-4 w-4 text-indigo-600 focus:ring-indigo-500" checked>
                                <span class="text-sm font-bold text-gray-700">Gesamtbetrag ändern</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="adjust-mode" value="remaining"
                                    class="h-4 w-4 text-indigo-600 focus:ring-indigo-500">
                                <span class="text-sm font-bold text-gray-700">Restbetrag ändern</span>
                            </label>
                        </div>
                        <div>
                            <label id="adjust-input-label" class="block text-sm font-bold text-gray-700 mb-1">Neuer
                                Betrag (€)</label>
                            <input type="number" id="adjust-new-amount"
                                class="w-full p-2 border rounded-lg font-mono text-lg transition-colors bg-white"
                                placeholder="0.00" step="0.01">
                        </div>
                    </div>

                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-xs font-bold text-gray-500 uppercase">Positionen</label>
                            <button id="btn-add-adjust-position"
                                class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded hover:bg-indigo-200 font-bold flex items-center gap-1">
                                <span>+</span> Posten
                            </button>
                        </div>
                        <div id="adjust-positions-container" class="space-y-2 mb-2 hidden"></div>
                    </div>

                    <div class="border-t pt-4 mt-4">
                        <p class="text-xs font-bold text-gray-500 uppercase mb-3">Details & Daten</p>

                        <div class="grid grid-cols-1 gap-3">
                            <div>
                                <label class="block text-xs font-bold text-gray-700 mb-1">Grund / Betreff</label>
                                <input type="text" id="adjust-title" class="w-full p-2 border rounded-lg text-sm">
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-gray-700 mb-1">Kategorie</label>
                                    <select id="adjust-category"
                                        class="w-full p-2 border rounded-lg bg-white text-sm"></select>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-700 mb-1">Buchungstyp</label>
                                    <select id="adjust-type" class="w-full p-2 border rounded-lg bg-white text-sm">
                                        <option value="debt">Schuld / Forderung</option>
                                        <option value="transfer">Umbuchung</option>
                                    </select>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-gray-700 mb-1">Startdatum</label>
                                    <input type="date" id="adjust-start-date"
                                        class="w-full p-2 border rounded-lg text-sm bg-white">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-700 mb-1">Fälligkeit</label>
                                    <input type="date" id="adjust-deadline"
                                        class="w-full p-2 border rounded-lg text-sm bg-white">
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-gray-700 mb-1">Rechnungs-Nr.</label>
                                    <input type="text" id="adjust-invoice-nr"
                                        class="w-full p-2 border rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-700 mb-1">Bestell-Nr.</label>
                                    <input type="text" id="adjust-order-nr"
                                        class="w-full p-2 border rounded-lg text-sm">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-100 mt-4">
                        <label class="block text-xs font-bold text-gray-700 mb-1">Änderungsgrund (für Protokoll)</label>
                        <select id="adjust-reason" class="w-full p-2 border rounded-lg bg-white text-sm mb-2">
                            <option value="correction">Korrektur (Tippfehler)</option>
                            <option value="storno">Storno / Rückabwicklung</option>
                            <option value="update">Daten aktualisiert</option>
                            <option value="interest">Zinsen / Gebühren (+)</option>
                            <option value="discount">Erlass / Rabatt (-)</option>
                            <option value="other">Sonstiges</option>
                        </select>
                        <input type="text" id="adjust-note" class="w-full p-2 border rounded-lg text-sm"
                            placeholder="Notiz / Interne Anmerkung...">
                    </div>
                </div>

                <div class="flex justify-end gap-2 mt-6 pt-2 border-t">
                    <button id="btn-cancel-adjust"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Abbrechen</button>
                    <button id="btn-save-adjust"
                        class="px-4 py-2 bg-indigo-600 text-white font-bold rounded hover:bg-indigo-700">Speichern</button>
                </div>
            </div>
        </div>

        <div id="overpaymentModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[60]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm text-center">
                <div class="mb-4 text-yellow-500 flex justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-12 h-12">
                        <path fill-rule="evenodd"
                            d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z"
                            clip-rule="evenodd" />
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Überzahlung erkannt!</h3>
                <p class="text-gray-600 text-sm mb-4">
                    Du hast <span id="overpayment-amount" class="font-bold text-gray-900">0,00 €</span> mehr angegeben
                    als offen ist.<br>
                    Was soll mit dem Rest passieren?
                </p>

                <div class="space-y-3">
                    <button id="btn-op-credit"
                        class="w-full py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 shadow-md flex items-center justify-center gap-2">
                        <span>🏦 Als Guthaben speichern</span>
                    </button>
                    <button id="btn-op-tip"
                        class="w-full py-3 bg-emerald-500 text-white font-bold rounded-lg hover:bg-emerald-600 shadow-md flex items-center justify-center gap-2">
                        <span>☕ Als Trinkgeld (schenken)</span>
                    </button>
                    <button id="btn-op-cancel" class="w-full py-2 text-gray-500 font-semibold hover:text-gray-700">
                        Abbrechen
                    </button>
                </div>
            </div>
        </div>


        <div id="guestView" class="view bg-gray-50 min-h-screen p-4">
            <div class="max-w-md mx-auto bg-white shadow-xl rounded-xl overflow-hidden">
                <div class="bg-indigo-600 p-6 text-white text-center">
                    <h1 class="text-2xl font-bold">Hallo <span id="guest-name-display">Gast</span>!</h1>
                    <p class="text-indigo-100 text-sm mt-1">Hier ist deine aktuelle Übersicht.</p>
                </div>

                <div class="p-6 space-y-6">
                    <div class="text-center p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-1">Offener Gesamtbetrag</p>
                        <p class="text-4xl font-extrabold text-gray-800" id="guest-total-display">0,00 €</p>
                        <p class="text-xs text-gray-500 mt-2" id="guest-status-text">Alles ausgeglichen.</p>
                    </div>

                    <div>
                        <h3 class="font-bold text-gray-700 border-b pb-2 mb-2">Offene Posten</h3>
                        <div id="guest-payment-list" class="space-y-2 max-h-96 overflow-y-auto">
                            <p class="text-center text-gray-400 italic py-4">Keine offenen Einträge.</p>
                        </div>
                    </div>

                    <div class="text-center text-xs text-gray-400 pt-4 border-t">
                        <p>Dies ist ein schreibgeschützter Link.</p>
                        <p>Bitte wende dich bei Fragen an den Ersteller.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="migrationModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[80]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-xl font-bold text-gray-800">Kontakt umwandeln</h3>
                    <button onclick="document.getElementById('migrationModal').style.display='none'"
                        class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                </div>

                <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200 text-sm text-yellow-800 mb-4">
                    <p class="font-bold">Achtung:</p>
                    <p>Alle Zahlungen und Guthaben von <strong id="mig-contact-name">...</strong> werden auf den
                        ausgewählten Benutzer übertragen.</p>
                    <p class="mt-1">Der Kontakt wird danach gelöscht.</p>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Ziel-Benutzer wählen</label>
                        <select id="migration-target-select" class="w-full p-2 border rounded-lg bg-white">
                        </select>
                    </div>
                </div>

                <div class="flex justify-end gap-2 mt-6 pt-2 border-t">
                    <button onclick="document.getElementById('migrationModal').style.display='none'"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Abbrechen</button>
                    <button id="btn-execute-migration"
                        class="px-4 py-2 bg-indigo-600 text-white font-bold rounded hover:bg-indigo-700">Jetzt
                        übertragen</button>
                </div>
            </div>
        </div>
        <div id="categoryOverviewModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[60]">
            <div class="bg-white p-5 rounded-xl shadow-2xl w-full max-w-sm flex flex-col max-h-[80vh]">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-lg font-bold text-gray-800">Alle Kategorien</h3>
                    <button onclick="document.getElementById('categoryOverviewModal').style.display='none'"
                        class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                </div>
                <div id="category-overview-list" class="grid grid-cols-2 gap-2 overflow-y-auto p-1">
                </div>
                <div class="mt-4 pt-2 border-t text-right">
                    <button onclick="document.getElementById('categoryOverviewModal').style.display='none'"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 text-sm font-bold">Schließen</button>
                </div>
            </div>
        </div>
        <div id="paymentHistoryModal"
            class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center p-4 z-[90]">
            <div class="bg-white p-4 rounded-xl shadow-2xl w-full max-w-4xl flex flex-col h-[80vh]">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Transaktions-Verlauf</h3>
                        <p class="text-xs text-gray-500">Visueller Stammbaum der Zahlungen</p>
                    </div>
                    <button onclick="document.getElementById('paymentHistoryModal').style.display='none'"
                        class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                </div>

                <div class="flex-grow overflow-auto bg-gray-50 rounded-lg border border-gray-200 flex justify-center items-center p-4"
                    id="history-graph-container">
                    <p class="text-gray-400">Lade Grafik...</p>
                </div>

                <div class="mt-4 pt-2 border-t text-right">
                    <button onclick="document.getElementById('paymentHistoryModal').style.display='none'"
                        class="px-6 py-2 bg-gray-800 text-white rounded hover:bg-gray-900 font-bold">Schließen</button>
                </div>
            </div>
        </div>

        <div id="pendingTransactionsModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[80]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md flex flex-col max-h-[85vh]">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-xl font-bold text-gray-800">Offene Buchungen</h3>
                    <button onclick="document.getElementById('pendingTransactionsModal').style.display='none'"
                        class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                </div>

                <p class="text-sm text-gray-500 mb-4">Diese Zahlungen warten auf deine Genehmigung.</p>

                <div id="pending-transactions-list" class="space-y-3 overflow-y-auto flex-grow">
                    <p class="text-center text-gray-400 italic">Lade Daten...</p>
                </div>

                <div class="mt-4 pt-2 border-t text-right">
                    <button onclick="document.getElementById('pendingTransactionsModal').style.display='none'"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Schließen</button>
                </div>
            </div>
        </div>

        <div id="sharePaymentModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[80]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md flex flex-col max-h-[85vh]">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-xl font-bold text-gray-800">Zugriff verwalten</h3>
                    <button onclick="document.getElementById('sharePaymentModal').style.display='none'"
                        class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                </div>

                <p class="text-sm text-gray-500 mb-4">Wer darf diesen Eintrag sehen und bearbeiten?</p>

                <div id="share-users-list" class="space-y-2 mb-4 overflow-y-auto flex-grow">
                </div>

                <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Person hinzufügen</label>
                    <select id="share-add-user-select"
                        class="w-full p-2 border rounded-lg bg-white text-sm mb-2"></select>

                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Rechte</label>
                    <select id="share-add-rights-select" class="w-full p-2 border rounded-lg bg-white text-sm mb-3">
                        <option value="view">Nur Ansehen</option>
                        <option value="transact_approve">Zahlen (mit Genehmigung)</option>
                        <option value="transact_full">Vollzugriff (ohne Genehmigung)</option>
                    </select>

                    <button id="btn-share-invite"
                        class="w-full py-2 bg-indigo-600 text-white font-bold rounded hover:bg-indigo-700 text-sm">Einladen</button>
                </div>

                <div class="mt-4 pt-2 border-t">
                    <button id="btn-copy-guest-link"
                        class="w-full py-2 border border-gray-300 text-gray-600 font-bold rounded hover:bg-gray-50 text-sm flex items-center justify-center gap-2">
                        <span>🔗 Link für Gast kopieren</span>
                    </button>
                </div>
            </div>
        </div>

        <div id="splitAdjustmentModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[70]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                <h3 class="text-xl font-bold text-gray-800 mb-2">Betrag anpassen</h3>
                <p class="text-sm text-gray-600 mb-4">Hier kannst du den Anteil für <strong id="adj-target-name"
                        class="text-indigo-700">...</strong> manuell verändern.</p>

                <input type="hidden" id="adj-target-id">

                <div class="space-y-4">
                    <div class="p-3 bg-gray-50 rounded-lg border">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Änderung</label>
                        <div class="flex gap-2 items-center">
                            <select id="adj-direction" class="p-2 border rounded-lg text-sm bg-white">
                                <option value="more">Muss MEHR zahlen (+)</option>
                                <option value="less">Muss WENIGER zahlen (-)</option>
                            </select>
                            <input type="number" id="adj-amount" class="w-24 p-2 border rounded-lg text-right font-bold"
                                placeholder="0.00" step="0.01">
                            <span class="text-gray-600 font-bold">€</span>
                        </div>
                    </div>

                    <div class="p-3 bg-gray-50 rounded-lg border">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Ausgleich durch:</label>

                        <div class="space-y-2">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="adj-distribution" value="all" class="h-4 w-4 text-indigo-600"
                                    checked>
                                <span class="text-sm text-gray-700">Alle anderen (anteilig)</span>
                            </label>

                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="adj-distribution" value="select"
                                    class="h-4 w-4 text-indigo-600">
                                <span class="text-sm text-gray-700">Bestimmte Personen auswählen</span>
                            </label>
                        </div>

                        <div id="adj-manual-status" class="hidden text-xs font-bold text-orange-600 mb-2 text-right">
                            Noch zu verteilen: <span id="adj-remaining-display">0.00</span> €
                        </div>

                        <div id="adj-selection-list"
                            class="hidden mt-2 pl-2 space-y-2 max-h-48 overflow-y-auto border-l-2 border-gray-200">
                        </div>
                    </div>
                </div>

                <div class="flex justify-between mt-6 pt-4 border-t border-gray-100">
                    <button id="btn-delete-adj"
                        class="hidden px-3 py-2 text-red-500 hover:bg-red-50 rounded text-sm font-bold flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                        Löschen
                    </button>

                    <div class="flex gap-2 ml-auto">
                        <button id="btn-cancel-adj"
                            onclick="document.getElementById('splitAdjustmentModal').style.display='none'"
                            class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Abbrechen</button>
                        <button id="btn-apply-adj"
                            class="px-4 py-2 bg-indigo-600 text-white font-bold rounded hover:bg-indigo-700">Speichern</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="resolveTBDModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[70]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                <h3 class="text-xl font-bold text-gray-800 mb-2">Betrag nachtragen</h3>
                <p class="text-sm text-gray-600 mb-4">Gib den Endbetrag ein oder erfasse einzelne Positionen.</p>

                <input type="hidden" id="resolve-tbd-id">

                <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-xs font-bold text-gray-500 uppercase">Positionen (Optional)</label>
                        <button id="btn-add-tbd-position"
                            class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded hover:bg-indigo-200 font-bold flex items-center gap-1">
                            <span>+</span> Posten
                        </button>
                    </div>

                    <div id="tbd-positions-container" class="space-y-2 mb-2 hidden"></div>

                    <div class="flex justify-between items-center pt-2 border-t border-gray-200 gap-2">
                        <span class="text-sm font-bold text-gray-700">Gesamtbetrag:</span>
                        <div class="relative w-1/2">
                            <span class="absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 font-bold">€</span>
                            <input type="number" id="tbd-resolve-amount"
                                class="w-full pl-6 p-1 border border-gray-300 rounded-lg font-mono font-bold text-right text-gray-800 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
                                placeholder="0.00" step="0.01">
                        </div>
                    </div>
                </div>

                <div class="flex justify-end gap-2 mt-4">
                    <button onclick="document.getElementById('resolveTBDModal').style.display='none'"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Abbrechen</button>
                    <button id="btn-save-tbd-resolve"
                        class="px-4 py-2 bg-green-600 text-white font-bold rounded hover:bg-green-700 shadow-md">Speichern</button>
                </div>
            </div>
        </div>
        <div id="guestDetailModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[100]">
            <div class="bg-white p-0 rounded-xl shadow-2xl w-full max-w-lg flex flex-col max-h-[90vh]">
                <div class="p-4 border-b bg-gray-50 rounded-t-xl flex justify-between items-center">
                    <h3 class="text-lg font-bold text-gray-800">Details</h3>
                    <button id="btn-close-guest-modal"
                        class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                </div>

                <div id="guest-detail-content" class="p-4 overflow-y-auto flex-grow text-sm text-gray-600 space-y-4">
                </div>

                <div class="p-3 border-t bg-gray-50 rounded-b-xl text-center text-xs text-gray-400">
                    Nur Lesezugriff
                </div>
            </div>
        </div>
        <div id="futurePaymentsModal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[80]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg flex flex-col max-h-[85vh]">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-xl font-bold text-gray-800">Geplante Zahlungen</h3>
                    <button onclick="document.getElementById('futurePaymentsModal').style.display='none'"
                        class="text-gray-400 hover:text-red-600 font-bold text-2xl">&times;</button>
                </div>

                <div class="bg-indigo-50 p-4 rounded-lg mb-4 border border-indigo-100">
                    <h4 class="font-bold text-indigo-900 mb-2 text-sm uppercase">Übersicht (Zukunft)</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center">
                            <p class="text-xs text-indigo-500">Du wirst schulden</p>
                            <p class="text-lg font-extrabold text-red-600" id="future-debt-sum">0,00 €</p>
                        </div>
                        <div class="text-center border-l border-indigo-200">
                            <p class="text-xs text-indigo-500">Du wirst bekommen</p>
                            <p class="text-lg font-extrabold text-green-600" id="future-credit-sum">0,00 €</p>
                        </div>
                    </div>
                </div>

                <div id="future-payments-list" class="space-y-3 overflow-y-auto flex-grow p-1">
                    <p class="text-center text-gray-400 italic py-4">Keine geplanten Zahlungen.</p>
                </div>

                <div class="mt-4 pt-2 border-t text-right">
                    <button onclick="document.getElementById('futurePaymentsModal').style.display='none'"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 font-bold text-sm">Schließen</button>
                </div>
            </div>
        </div>

        <!-- ========== TICKET SUPPORT MODALS ========== -->
        
        <!-- Ticket Erstellen/Bearbeiten Modal -->
        <div id="ticketModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[70]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="ticketModalTitle" class="text-2xl font-bold text-gray-800">Neues Ticket</h3>
                    <button id="closeTicketModal" class="text-gray-400 hover:text-red-600 font-bold text-3xl leading-none">&times;</button>
                </div>

                <input type="hidden" id="editTicketId">

                <div class="space-y-4">
                    <!-- Betreff -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Betreff *</label>
                        <input type="text" id="ticketSubject" 
                            class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition" 
                            placeholder="z.B. Waschmaschine reparieren">
                    </div>

                    <div class="grid grid-cols-3 gap-4">
                        <!-- Kategorie -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Kategorie *</label>
                            <select id="ticketCategory" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 bg-white">
                                <option value="handwerk">🔨 Handwerk</option>
                                <option value="technik">💻 Technik</option>
                                <option value="haushalt">🏠 Haushalt</option>
                                <option value="einkauf">🛒 Einkauf</option>
                                <option value="erledigungen">📋 Erledigungen</option>
                                <option value="sonstiges">📌 Sonstiges</option>
                            </select>
                        </div>

                        <!-- Priorität -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Priorität *</label>
                            <select id="ticketPriority" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 bg-white">
                                <option value="low">🟢 Niedrig</option>
                                <option value="normal" selected>🟡 Normal</option>
                                <option value="high">🟠 Hoch</option>
                                <option value="urgent">🔴 Dringend</option>
                            </select>
                        </div>

                        <!-- Status (nur beim Bearbeiten) -->
                        <div id="statusFieldContainer" style="display:none;">
                            <label class="block text-sm font-bold text-gray-700 mb-2">Status</label>
                            <select id="ticketStatus" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 bg-white">
                                <option value="open">📝 Offen</option>
                                <option value="in_progress">⚙️ In Arbeit</option>
                                <option value="paused">⏸️ Pausiert</option>
                                <option value="done">✅ Erledigt</option>
                                <option value="reopened">🔄 Wiedergeöffnet</option>
                            </select>
                        </div>
                    </div>

                    <!-- Zugewiesen an -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Zugewiesen an *</label>
                        <select id="ticketAssignedTo" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 bg-white">
                            <option value="">-- Bitte wählen --</option>
                        </select>
                    </div>

                    <!-- Fällig bis -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Fällig bis</label>
                        <input type="date" id="ticketDueDate" 
                            class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500">
                    </div>

                    <!-- Beschreibung -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Beschreibung</label>
                        <textarea id="ticketDescription" rows="4"
                            class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500" 
                            placeholder="Detaillierte Beschreibung der Aufgabe..."></textarea>
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-6 pt-4 border-t">
                    <button id="cancelTicketBtn" class="px-6 py-2.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-bold transition">
                        Abbrechen
                    </button>
                    <button id="saveTicketBtn" class="px-6 py-2.5 bg-gradient-to-r from-purple-600 to-pink-500 text-white font-bold rounded-lg hover:shadow-lg transition">
                        Speichern
                    </button>
                </div>
            </div>
        </div>

        <!-- Ticket Details Modal -->
        <div id="ticketDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[80]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-gray-800">Ticket Details</h3>
                    <button id="closeDetailsModal" class="text-gray-400 hover:text-red-600 font-bold text-3xl leading-none">&times;</button>
                </div>

                <div id="ticketDetailsContent">
                    <!-- Wird dynamisch gefüllt -->
                </div>

                <!-- Interne Notizen (nur für Zugewiesenen) -->
                <div id="internalNotesSection" class="hidden mt-6 pt-4 border-t">
                    <h4 class="text-lg font-bold text-gray-800 mb-3">🔒 Interne Notizen (nur für dich sichtbar)</h4>
                    <div id="notesList" class="space-y-2 mb-3 max-h-40 overflow-y-auto">
                        <!-- Wird dynamisch gefüllt -->
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="newNoteInput" 
                            class="flex-1 p-2 border-2 border-gray-300 rounded-lg" 
                            placeholder="Neue Notiz hinzufügen...">
                        <button id="addNoteBtn" class="px-4 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700">
                            Hinzufügen
                        </button>
                    </div>
                </div>

                <!-- Aktivitätsprotokoll -->
                <div id="activityLogSection" class="mt-6 pt-4 border-t">
                    <h4 class="text-lg font-bold text-gray-800 mb-3">📋 Aktivitätsprotokoll</h4>
                    <div id="activityLog" class="space-y-2 max-h-60 overflow-y-auto bg-gray-50 p-3 rounded-lg">
                        <p class="text-sm text-gray-400 italic">Keine Aktivitäten</p>
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-6 pt-4 border-t">
                    <button onclick="document.getElementById('ticketDetailsModal').style.display='none'" 
                        class="px-6 py-2.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-bold transition">
                        Schließen
                    </button>
                </div>
            </div>
        </div>

        <!-- ========== WERTGUTHABEN MODALS ========== -->
        
        <!-- Modal: Wertguthaben erstellen/bearbeiten -->
        <div id="wertguthabenModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[70]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="wertguthabenModalTitle" class="text-2xl font-bold text-emerald-800">Neues Wertguthaben</h3>
                    <button id="closeWertguthabenModal" class="text-gray-400 hover:text-red-600 font-bold text-3xl leading-none">&times;</button>
                </div>

                <input type="hidden" id="editWertguthabenId">

                <div class="space-y-4">
                    <!-- Eigentümer -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Eigentümer *</label>
                        <div class="flex gap-2">
                            <select id="wgEigentuemer" class="flex-1 p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500 bg-white">
                                <option value="self">-- Aktueller Benutzer --</option>
                                <option value="custom">-- Freie Eingabe --</option>
                            </select>
                        </div>
                        <input type="text" id="wgEigentuemerFrei" placeholder="Freie Eingabe (z.B. externe Person)" 
                            class="hidden w-full mt-2 p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500">
                    </div>

                    <div class="grid grid-cols-3 gap-4">
                        <!-- Typ -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Typ *</label>
                            <select id="wgTyp" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500 bg-white">
                                <option value="gutschein">🎁 Gutschein</option>
                                <option value="guthaben">💳 Guthaben</option>
                                <option value="wertguthaben">🏦 Wertguthaben</option>
                                <option value="wertguthaben_gesetzlich">⚖️ Wertguthaben (gesetzlich)</option>
                                <option value="aktionscode">🏷️ Aktionscode</option>
                            </select>
                        </div>

                        <!-- Status -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Status</label>
                            <select id="wgStatus" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500 bg-white">
                                <option value="aktiv">✅ Aktiv</option>
                                <option value="eingeloest">🎯 Eingelöst</option>
                                <option value="abgelaufen">⏰ Abgelaufen</option>
                                <option value="storniert">❌ Storniert</option>
                                <option value="verschenkt">🎁 Verschenkt</option>
                                <option value="verloren">❓ Verloren</option>
                            </select>
                        </div>

                        <!-- Wert -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Wert (€)</label>
                            <input type="number" id="wgWert" step="0.01" min="0" placeholder="0.00"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <!-- Name -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Name *</label>
                            <input type="text" id="wgName" placeholder="z.B. Amazon, Billa, MediaMarkt"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500">
                        </div>

                        <!-- Unternehmen -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Unternehmen</label>
                            <input type="text" id="wgUnternehmen" placeholder="z.B. Amazon Europe, REWE Österreich"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <!-- Kaufdatum -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Kaufdatum</label>
                            <input type="date" id="wgKaufdatum"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500">
                        </div>

                        <!-- Einlösefrist -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Einlösefrist</label>
                            <input type="date" id="wgEinloesefrist"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500">
                        </div>
                    </div>

                    <!-- Spezielle Felder für Typ: Gutschein -->
                    <div id="gutschein-felder" class="hidden space-y-4 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                        <h4 class="font-bold text-blue-800">🎁 Gutschein-spezifische Felder</h4>
                        
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Ablaufdatum Code</label>
                            <input type="date" id="wgCodeAblauf"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Bedingungen</label>
                            <textarea id="wgBedingungen" rows="3" placeholder="z.B. Mindestbetrag 50€, nur Elektronik-Sortiment, Account-gebunden"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500"></textarea>
                        </div>
                    </div>

                    <!-- Spezielle Felder für Typ: Wertguthaben / Wertguthaben (gesetzlich) -->
                    <div id="wertguthaben-felder" class="hidden space-y-4 p-4 bg-emerald-50 rounded-lg border-2 border-emerald-200">
                        <h4 class="font-bold text-emerald-800">🏦 Wertguthaben-spezifische Felder</h4>
                        
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Ablaufdatum</label>
                            <div class="flex gap-2 mb-2">
                                <button type="button" class="wg-ablauf-quick flex-1 py-2 px-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-bold text-sm" data-years="30">30 Jahre</button>
                                <button type="button" class="wg-ablauf-quick flex-1 py-2 px-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-bold text-sm" data-years="3">3 Jahre</button>
                                <button type="button" class="wg-ablauf-quick flex-1 py-2 px-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-bold text-sm" data-years="unlimited">Unbegrenzt</button>
                            </div>
                            <input type="date" id="wgWertAblauf" placeholder="Oder benutzerdefiniert"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500">
                        </div>
                    </div>

                    <!-- Spezielle Felder für Typ: Aktionscode -->
                    <div id="aktionscode-felder" class="hidden space-y-4 p-4 bg-pink-50 rounded-lg border-2 border-pink-200">
                        <h4 class="font-bold text-pink-800">🏷️ Aktionscode-spezifische Felder</h4>
                        
                        <!-- Rabatt-Typ und Wert -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Rabatt-Typ *</label>
                                <select id="wgRabattTyp" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500 bg-white" onchange="handleRabattTypChange()">
                                    <option value="prozent">% Prozent-Rabatt</option>
                                    <option value="betrag">€ Betrag-Rabatt</option>
                                    <option value="gratis_versand">📦 Gratis Versand</option>
                                    <option value="geschenk">🎁 Gratis Geschenk</option>
                                </select>
                            </div>
                            <div id="rabattWertContainer">
                                <label class="block text-sm font-bold text-gray-700 mb-2">Rabatt-Wert</label>
                                <div class="flex gap-2">
                                    <input type="number" id="wgRabattWert" step="0.01" min="0" placeholder="z.B. 20"
                                        class="flex-1 p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                                    <select id="wgRabattEinheit" class="w-20 p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500 bg-white">
                                        <option value="%">%</option>
                                        <option value="€">€</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Mindestbestellwert und Max-Rabatt -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Mindestbestellwert (€)</label>
                                <input type="number" id="wgMindestbestellwert" step="0.01" min="0" placeholder="z.B. 50.00 (leer = keiner)"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Max. Rabatt (€)</label>
                                <input type="number" id="wgMaxRabatt" step="0.01" min="0" placeholder="z.B. 50.00 (leer = unbegrenzt)"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                            </div>
                        </div>

                        <!-- Gültigkeitszeitraum -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Gültig ab</label>
                                <input type="date" id="wgGueltigAb"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                                <p class="text-xs text-gray-500 mt-1">Leer = unbekannt/sofort</p>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Gültig bis</label>
                                <input type="date" id="wgGueltigBis"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                                <p class="text-xs text-gray-500 mt-1">Leer = unbekannt/unbegrenzt</p>
                            </div>
                        </div>

                        <!-- Einlösungen -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Max. Einlösungen</label>
                                <input type="number" id="wgMaxEinloesungen" min="0" placeholder="z.B. 1 (0 oder leer = unbegrenzt)" onchange="validateEinloesungen()"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Bereits eingelöst</label>
                                <input type="number" id="wgBereitsEingeloest" min="0" value="0" onchange="validateEinloesungen()"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                            </div>
                        </div>

                        <!-- Kontogebunden -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Kontogebunden?</label>
                                <select id="wgKontogebunden" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500 bg-white" onchange="handleKontogebundenChange()">
                                    <option value="nein">Nein</option>
                                    <option value="ja">Ja</option>
                                    <option value="unbekannt">Unbekannt</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Konto / E-Mail</label>
                                <input type="text" id="wgKonto" placeholder="z.B. max@example.com"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                            </div>
                        </div>

                        <!-- Einschränkungen -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Nur für Neukunden?</label>
                                <select id="wgNeukunde" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500 bg-white">
                                    <option value="nein">Nein</option>
                                    <option value="ja">Ja</option>
                                    <option value="unbekannt">Unbekannt</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Kombinierbar?</label>
                                <select id="wgKombinierbar" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500 bg-white">
                                    <option value="ja">Ja</option>
                                    <option value="nein">Nein</option>
                                    <option value="unbekannt">Unbekannt</option>
                                </select>
                            </div>
                        </div>

                        <!-- Kategorien und Ausnahmen -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Gültig für Kategorien</label>
                            <input type="text" id="wgKategorien" placeholder="z.B. Elektronik, Kleidung (leer = alle)"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Ausnahmen / Ausgeschlossen</label>
                            <input type="text" id="wgAusnahmen" placeholder="z.B. Apple-Produkte, Sale-Artikel"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                        </div>

                        <!-- Quelle -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Quelle / Herkunft</label>
                            <input type="text" id="wgQuelle" placeholder="z.B. Newsletter, Influencer XY, Cashback-Portal"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500">
                        </div>
                    </div>

                    <!-- Code, PIN, Seriennummer -->
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Code</label>
                            <input type="text" id="wgCode" placeholder="Gutscheincode"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">PIN</label>
                            <input type="text" id="wgPin" placeholder="PIN"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Seriennummer</label>
                            <input type="text" id="wgSeriennummer" placeholder="Seriennr."
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500">
                        </div>
                    </div>

                    <!-- Benutzerdefinierte Warnung -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Warnung vor Ablauf (Tage)</label>
                        <input type="number" id="wgWarnung" min="0" placeholder="z.B. 30 (leer = Standardwert)"
                            class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500">
                        <p class="text-xs text-gray-500 mt-1">Wenn leer, wird die Standard-Warnung aus den Einstellungen verwendet.</p>
                    </div>

                    <!-- Notizen -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Notizen</label>
                        <textarea id="wgNotizen" rows="3" placeholder="Zusätzliche Informationen..."
                            class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500"></textarea>
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-6 pt-4 border-t">
                    <button id="cancelWertguthabenBtn" class="px-6 py-2.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-bold transition">
                        Abbrechen
                    </button>
                    <button id="saveWertguthabenBtn" class="px-6 py-2.5 bg-gradient-to-r from-emerald-600 to-teal-500 text-white font-bold rounded-lg hover:shadow-lg transition">
                        Speichern
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Wertguthaben Details -->
        <div id="wertguthabenDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[80]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-emerald-800">Wertguthaben Details</h3>
                    <button id="closeWertguthabenDetailsModal" class="text-gray-400 hover:text-red-600 font-bold text-3xl leading-none">&times;</button>
                </div>

                <div id="wertguthabenDetailsContent" class="space-y-4">
                    <!-- Wird dynamisch gefüllt -->
                </div>

                <!-- Transaktions-Historie -->
                <div id="transaktionsHistorie" class="mt-6 pt-6 border-t">
                    <h4 class="text-lg font-bold text-gray-800 mb-3">📊 Transaktions-Historie</h4>
                    <div id="transaktionsList" class="space-y-2 max-h-60 overflow-y-auto">
                        <!-- Wird dynamisch gefüllt -->
                    </div>
                </div>

                <div class="flex justify-between gap-3 mt-6 pt-4 border-t">
                    <button id="addTransaktionBtn" class="px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold transition">
                        💳 Transaktion buchen
                    </button>
                    <div class="flex gap-3">
                        <button id="deleteWertguthabenBtn" class="px-6 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 font-bold transition">
                            Löschen
                        </button>
                        <button id="editWertguthabenDetailsBtn" class="px-6 py-2.5 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-bold transition">
                            Bearbeiten
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal: Wertguthaben Einstellungen -->
        <div id="wertguthabenSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[90]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-emerald-800">⚙️ Standard-Warnungen</h3>
                    <button id="closeWertguthabenSettingsModal" class="text-gray-400 hover:text-red-600 font-bold text-3xl leading-none">&times;</button>
                </div>

                <p class="text-sm text-gray-600 mb-4">
                    Lege fest, wie viele Tage vor Ablauf eine Warnung angezeigt werden soll, wenn bei einem Wertguthaben keine individuelle Warnung eingestellt ist.
                </p>

                <div class="space-y-4">
                    <!-- Gutschein -->
                    <div class="p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-2xl">🎁</span>
                            <label class="block text-sm font-bold text-blue-800">Gutschein</label>
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="number" id="settings-warning-gutschein" min="0" value="14"
                                class="flex-1 p-3 border-2 border-blue-300 rounded-lg focus:border-blue-500 bg-white">
                            <span class="text-sm text-blue-700 font-semibold">Tage</span>
                        </div>
                    </div>

                    <!-- Guthaben -->
                    <div class="p-4 bg-purple-50 rounded-lg border-2 border-purple-200">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-2xl">💳</span>
                            <label class="block text-sm font-bold text-purple-800">Guthaben</label>
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="number" id="settings-warning-guthaben" min="0" value="30"
                                class="flex-1 p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 bg-white">
                            <span class="text-sm text-purple-700 font-semibold">Tage</span>
                        </div>
                    </div>

                    <!-- Wertguthaben -->
                    <div class="p-4 bg-emerald-50 rounded-lg border-2 border-emerald-200">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-2xl">🏦</span>
                            <label class="block text-sm font-bold text-emerald-800">Wertguthaben</label>
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="number" id="settings-warning-wertguthaben" min="0" value="90"
                                class="flex-1 p-3 border-2 border-emerald-300 rounded-lg focus:border-emerald-500 bg-white">
                            <span class="text-sm text-emerald-700 font-semibold">Tage</span>
                        </div>
                    </div>

                    <!-- Wertguthaben (gesetzlich) -->
                    <div class="p-4 bg-yellow-50 rounded-lg border-2 border-yellow-200">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-2xl">⚖️</span>
                            <label class="block text-sm font-bold text-yellow-800">Wertguthaben (gesetzlich)</label>
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="number" id="settings-warning-wertguthaben_gesetzlich" min="0" value="180"
                                class="flex-1 p-3 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 bg-white">
                            <span class="text-sm text-yellow-700 font-semibold">Tage</span>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-6 pt-4 border-t">
                    <button id="cancelWertguthabenSettingsBtn" class="px-6 py-2.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-bold transition">
                        Abbrechen
                    </button>
                    <button id="saveWertguthabenSettingsBtn" class="px-6 py-2.5 bg-emerald-600 text-white font-bold rounded-lg hover:bg-emerald-700 transition">
                        Speichern
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Transaktion buchen -->
        <div id="transaktionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[90]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-2xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-blue-800">💳 Transaktion buchen</h3>
                    <button id="closeTransaktionModal" class="text-gray-400 hover:text-red-600 font-bold text-3xl leading-none">&times;</button>
                </div>

                <input type="hidden" id="transaktionWertguthabenId">

                <div class="space-y-4">
                    <!-- Transaktionstyp -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Typ *</label>
                        <select id="transaktionTyp" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 bg-white">
                            <option value="verwendung">📉 Verwendung (Guthaben einlösen)</option>
                            <option value="gutschrift">📈 Gutschrift (Guthaben aufladen)</option>
                            <option value="einloesung">🎟️ Einlösung (Aktionscode)</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <!-- Betrag (für normale Wertguthaben) -->
                        <div id="transaktionBetragContainer">
                            <label class="block text-sm font-bold text-gray-700 mb-2">Betrag (€) *</label>
                            <input type="number" id="transaktionBetrag" step="0.01" min="0" placeholder="0.00"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500">
                        </div>

                        <!-- Einlösung (für Aktionscode) -->
                        <div id="transaktionEinloesungContainer" class="hidden">
                            <label class="block text-sm font-bold text-gray-700 mb-2">Einlösung buchen</label>
                            <button type="button" id="einloesungVormerkenBtn"
                                class="w-full p-3 bg-pink-600 text-white font-bold rounded-lg hover:bg-pink-700 transition-colors">
                                🎟️ 1x Einlösung vormerken
                            </button>
                            <div id="einloesungVorgemerkt" class="hidden mt-2 p-2 bg-green-100 border border-green-300 rounded-lg">
                                <p class="text-sm text-green-800">✅ 1x Einlösung vorgemerkt</p>
                            </div>
                        </div>

                        <!-- Datum -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Datum *</label>
                            <input type="date" id="transaktionDatum"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <!-- Bestellnummer -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Bestellnummer</label>
                            <input type="text" id="transaktionBestellnr" placeholder="z.B. 123456789"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500">
                        </div>

                        <!-- Rechnungsnummer -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Rechnungsnummer</label>
                            <input type="text" id="transaktionRechnungsnr" placeholder="z.B. RE-2024-001"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500">
                        </div>
                    </div>

                    <!-- Beschreibung -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Beschreibung</label>
                        <textarea id="transaktionBeschreibung" rows="3" placeholder="z.B. Einkauf vom 12.12.2024, 12:00 Uhr..."
                            class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500"></textarea>
                    </div>

                    <!-- Verfügbarer Betrag Anzeige -->
                    <div class="p-4 bg-emerald-50 rounded-lg border-2 border-emerald-200">
                        <p class="text-sm font-bold text-emerald-800">Verfügbares Guthaben:</p>
                        <p class="text-2xl font-bold text-emerald-700" id="transaktionVerfuegbar">0,00 €</p>
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-6 pt-4 border-t">
                    <button id="cancelTransaktionBtn" class="px-6 py-2.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-bold transition">
                        Abbrechen
                    </button>
                    <button id="saveTransaktionBtn" class="px-6 py-2.5 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition">
                        Transaktion buchen
                    </button>
                </div>
            </div>
        </div>

        <div id="lizenzModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[70]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="lizenzModalTitle" class="text-2xl font-bold text-orange-800">Neue Lizenz</h3>
                    <button id="closeLizenzModal" class="text-gray-400 hover:text-red-600 font-bold text-3xl leading-none">&times;</button>
                </div>

                <input type="hidden" id="editLizenzId">

                <div class="space-y-4">
                    <div id="lizenzCopyInfo" style="display:none" class="p-3 bg-yellow-50 border-2 border-yellow-200 rounded-lg">
                        <p class="text-sm font-bold text-yellow-800">Kopie: Beim Speichern wird ein neuer Eintrag erstellt.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Produkt *</label>
                            <select id="lizProduktId" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 bg-white">
                                <option value="">Produkt wählen...</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Kategorie</label>
                            <select id="lizKategorieId" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 bg-white">
                                <option value="">(Keine Kategorie)</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Titel</label>
                        <input type="text" id="lizTitel" placeholder="z.B. Jahresabo / Family / Einmal-Lizenz"
                            class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Version</label>
                            <input type="text" id="lizVersion" placeholder="z.B. 2024 / v1.2.3"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Code / Key</label>
                            <input type="text" id="lizCode" placeholder="Lizenzschlüssel"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Lizenziert an</label>
                            <input type="text" id="lizLizenziertAn" placeholder="z.B. Firma / Konto / Name"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Aktiviert auf</label>
                            <select id="lizAktiviertAufSelect" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 bg-white">
                                <option value="">(Nicht gesetzt)</option>
                            </select>
                            <input type="text" id="lizAktiviertAufFrei" placeholder="Freie Eingabe (z.B. PC 1 / E-Mail)"
                                class="hidden w-full mt-2 p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Kaufdatum</label>
                            <input type="date" id="lizKaufdatum"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Aktivierungsdatum</label>
                            <input type="date" id="lizAktivierungsdatum"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Ablauf</label>
                            <div class="flex gap-2 mb-2">
                                <select id="lizAblaufModus" class="flex-1 p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 bg-white">
                                    <option value="datum">📅 Datum</option>
                                    <option value="tage">⏳ Tage</option>
                                </select>
                                <input type="number" id="lizAblaufTage" min="0" placeholder="Tage"
                                    class="hidden w-32 p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                            </div>
                            <input type="date" id="lizAblaufdatum"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Status</label>
                            <select id="lizStatus" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 bg-white">
                                <option value="aktiv">✅ Aktiv</option>
                                <option value="deaktiviert">⏸️ Deaktiviert</option>
                                <option value="abgelaufen">❌ Abgelaufen</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Volumen</label>
                            <div class="grid grid-cols-3 gap-2">
                                <input type="number" id="lizVolumenGesamt" min="0" placeholder="Gesamt"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                                <input type="number" id="lizVolumenAktiv" min="0" placeholder="Aktiv"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                                <input type="text" id="lizVolumenFrei" placeholder="Frei" readonly
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg bg-gray-100">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Shop</label>
                            <input type="text" id="lizShop" placeholder="z.B. Steam / Microsoft Store"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Beschränkungen</label>
                        <textarea id="lizBeschraenkungen" rows="3" placeholder="z.B. nur Windows / nur EU / nur Privat"
                            class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Notizen</label>
                        <textarea id="lizNotizen" rows="3" placeholder="Zusätzliche Informationen..."
                            class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500"></textarea>
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-6 pt-4 border-t">
                    <button id="cancelLizenzBtn" class="px-6 py-2.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-bold transition">
                        Abbrechen
                    </button>
                    <button id="copyLizenzBtn" style="display:none" class="px-6 py-2.5 bg-orange-500 text-white font-bold rounded-lg hover:bg-orange-600 transition">
                        Kopie erstellen
                    </button>
                    <button id="saveLizenzBtn" class="px-6 py-2.5 bg-orange-600 text-white font-bold rounded-lg hover:bg-orange-700 transition">
                        Speichern
                    </button>
                </div>
            </div>
        </div>

        <div id="lizenzenSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[90]">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-orange-800">⚙️ Lizenzen Einstellungen</h3>
                    <button id="closeLizenzenSettingsModal" class="text-gray-400 hover:text-red-600 font-bold text-3xl leading-none">&times;</button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-4 bg-orange-50 rounded-lg border-2 border-orange-200">
                        <h4 class="font-bold text-orange-800 mb-3">Kategorien</h4>
                        <div class="flex gap-2 mb-3">
                            <input type="text" id="new-lizenz-kategorie-input" placeholder="Neue Kategorie..."
                                class="flex-1 p-2.5 border-2 border-orange-300 rounded-lg focus:border-orange-500 bg-white">
                            <button id="btn-add-lizenz-kategorie" class="px-4 py-2 bg-orange-600 text-white font-bold rounded-lg hover:bg-orange-700">
                                Hinzufügen
                            </button>
                        </div>
                        <div id="lizenzen-kategorien-list" class="space-y-2 max-h-60 overflow-y-auto">
                            <p class="text-sm text-center text-gray-400 italic">Keine Kategorien.</p>
                        </div>
                    </div>

                    <div class="p-4 bg-yellow-50 rounded-lg border-2 border-yellow-200">
                        <h4 class="font-bold text-yellow-800 mb-3">Produkte</h4>
                        <div class="flex gap-2 mb-3">
                            <input type="text" id="new-lizenz-produkt-input" placeholder="Neues Produkt..."
                                class="flex-1 p-2.5 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 bg-white">
                            <button id="btn-add-lizenz-produkt" class="px-4 py-2 bg-yellow-600 text-white font-bold rounded-lg hover:bg-yellow-700">
                                Hinzufügen
                            </button>
                        </div>
                        <div id="lizenzen-produkte-list" class="space-y-2 max-h-60 overflow-y-auto">
                            <p class="text-sm text-center text-gray-400 italic">Keine Produkte.</p>
                        </div>
                    </div>
                </div>

                <div class="mt-6 pt-6 border-t">
                    <div class="flex flex-wrap justify-between items-center gap-3 mb-3">
                        <h4 class="font-bold text-red-800">🗑️ Papierkorb</h4>
                        <div class="flex gap-2">
                            <button id="lizenzen-trash-select-all" class="px-3 py-1.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-bold transition text-sm">
                                Alle auswählen
                            </button>
                            <button id="lizenzen-trash-deselect-all" class="px-3 py-1.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-bold transition text-sm">
                                Alle abwählen
                            </button>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 mb-3">
                        <button id="lizenzen-trash-restore-btn" class="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-bold transition text-sm">
                            Wiederherstellen
                        </button>
                        <button id="lizenzen-trash-delete-btn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-bold transition text-sm">
                            Endgültig löschen
                        </button>
                    </div>

                    <div id="lizenzen-trash-list" class="space-y-2 max-h-60 overflow-y-auto bg-white border-2 border-gray-200 rounded-lg p-2">
                        <p class="text-sm text-center text-gray-400 italic">Papierkorb leer.</p>
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-6 pt-4 border-t">
                    <button id="cancelLizenzenSettingsBtn" class="px-6 py-2.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-bold transition">
                        Schließen
                    </button>
                </div>
            </div>
        </div>


<script type="module" src="haupteingang.js"></script>
<script type="module" src="log-InOut.js"></script>
<script type="module" src="admin_adminfunktionenHome.js"></script>
<script type="module" src="admin_benutzersteuerung.js"></script>
<script type="module" src="admin_genehmigungsprozess.js"></script>
<script type="module" src="admin_protokollHistory.js"></script>
<script type="module" src="admin_rechteverwaltung.js"></script>
<script type="module" src="admin_rollenverwaltung.js"></script>
<script type="module" src="checklist.js"></script>
<script type="module" src="essensberechnung.js"></script>
    <!-- ========== SENDUNG MODAL ========== -->
    <div id="sendungModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-end md:items-center justify-center p-2 sm:p-4 z-[100]">
        <div class="bg-white p-4 sm:p-6 rounded-t-2xl md:rounded-xl shadow-2xl w-full max-w-4xl max-h-[95vh] overflow-y-auto">
            <div class="flex justify-between items-start sm:items-center gap-2 mb-6">
                <h3 id="sendungModalTitle" class="text-2xl font-bold text-amber-800">📦 Neue Sendung</h3>
                <button id="closeSendungModal" class="text-gray-400 hover:text-red-600 font-bold text-3xl leading-none shrink-0">&times;</button>
            </div>

            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Typ <span class="text-red-500">*</span></label>
                        <select id="sendungTyp" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500 bg-white">
                            <option value="empfang">📥 Empfang</option>
                            <option value="versand">📤 Versand</option>
                            <option value="ruecksendung">🔄 Rücksendung</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Status <span class="text-red-500">*</span></label>
                        <div class="relative">
                            <select id="sendungStatus" class="w-full p-3 pr-14 border-2 border-gray-300 rounded-lg focus:border-amber-500 bg-white">
                                <option value="erwartet">⏳ Erwartet</option>
                                <option value="unterwegs">🚚 Unterwegs</option>
                                <option value="zugestellt">✅ Zugestellt</option>
                                <option value="problem">⚠️ Problem</option>
                                <option value="storniert">❌ Storniert</option>
                            </select>
                            <button type="button" id="sendungStatusUnlockBtn" class="hidden absolute right-2 top-1/2 -translate-y-1/2 w-9 h-9 rounded-full border border-amber-300 bg-amber-100 text-amber-800 text-lg font-bold hover:bg-amber-200 transition" title="Manuellen Status entsperren">🔒</button>
                        </div>
                        <div class="mt-2 flex items-center gap-2 flex-wrap">
                            <span id="sendungStatusInfo" class="text-xs font-semibold text-blue-700 bg-blue-50 px-2 py-1 rounded">Automatisch</span>
                            <span id="sendungStatusLockHint" class="text-xs text-gray-600">🔒 Manuell entsperren für Statusänderung.</span>
                            <button type="button" id="sendungResetAutoStatusBtn" class="text-xs font-semibold px-2 py-1 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 transition">Automatik übernehmen</button>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Beschreibung <span class="text-red-500">*</span></label>
                    <input type="text" id="sendungBeschreibung" placeholder="z.B. Laptop von Amazon" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500">
                </div>

                <div id="sendungEmpfangPotOverview" class="hidden"></div>

                <div class="border-2 border-amber-200 rounded-xl p-4 bg-amber-50/40">
                    <div class="flex items-center justify-between flex-wrap gap-2 mb-2">
                        <h4 class="text-sm font-bold text-amber-900">Pakete &amp; Sendungsnummern</h4>
                        <button type="button" id="sendungAddPaketBtn" class="w-full sm:w-auto px-3 py-1.5 rounded-lg bg-amber-500 text-white text-sm font-bold hover:bg-amber-600 transition" title="Weiteres Paket hinzufügen">+ Paket</button>
                    </div>
                    <p class="text-xs text-gray-600 mb-3">Jedes Paket hat eigenen Status, eigene Deadlines und eigene Sendungsnummer(n).</p>

                    <div id="sendungPaketeContainer" class="space-y-3"></div>

                    <datalist id="anbieterList">
                        <option value="DHL">
                        <option value="Hermes">
                        <option value="DPD">
                        <option value="Post Österreich">
                        <option value="UPS">
                        <option value="FedEx">
                        <option value="GLS">
                        <option value="Amazon Logistics">
                    </datalist>
                </div>

                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Priorität</label>
                        <select id="sendungPrioritaet" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500 bg-white">
                            <option value="normal">Normal</option>
                            <option value="hoch">⚡ Hoch</option>
                            <option value="dringend">🚨 Dringend</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Absender</label>
                        <input type="text" id="sendungAbsender" placeholder="Von wem / welchem Shop" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500">
                    </div>

                    <div class="relative">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Empfänger</label>
                        <input type="text" id="sendungEmpfaenger" placeholder="An wen" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500" autocomplete="off">
                        <div id="sendungEmpfaengerSuggestions" class="hidden absolute z-20 mt-1 w-full max-h-48 overflow-y-auto bg-white border border-gray-200 rounded-lg shadow-lg"></div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Bestellnummer</label>
                    <input type="text" id="sendungBestellnummer" placeholder="Order-ID" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Warenwert (€)</label>
                        <input type="number" id="sendungWert" min="0" step="0.01" placeholder="0.00" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Versandkosten (€)</label>
                        <input type="number" id="sendungVersandkosten" min="0" step="0.01" placeholder="0.00" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Inhalt (Liste)</label>
                    <p class="text-xs text-gray-500 mb-2">Menge + Bezeichnung pro Zeile. Enter in Menge springt zur Bezeichnung, Enter in Bezeichnung erstellt die nächste Zeile.</p>
                    <div id="sendungInhaltRows" class="space-y-2"></div>
                    <div class="mt-2">
                        <button type="button" id="sendungAddInhaltRowBtn" class="px-3 py-1.5 rounded-lg bg-gray-200 text-gray-700 text-sm font-bold hover:bg-gray-300 transition">+ Zeile</button>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Notizen</label>
                    <textarea id="sendungNotizen" rows="3" placeholder="Zusätzliche Informationen..." class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500"></textarea>
                </div>

                <div id="sendungErinnerungenSection" class="border-t pt-4">
                    <h4 class="font-bold text-gray-700 mb-3">🔔 Erinnerungen</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex items-center">
                            <input type="checkbox" id="sendungErinnerungenAktiv" class="w-5 h-5 text-amber-500 border-gray-300 rounded focus:ring-amber-500">
                            <label for="sendungErinnerungenAktiv" class="ml-2 text-sm font-bold text-gray-700">Erinnerungen aktivieren</label>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Tage vorher erinnern</label>
                            <select id="sendungErinnerungTageVorher" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500 bg-white" disabled>
                                <option value="1">1 Tag vorher</option>
                                <option value="3">3 Tage vorher</option>
                                <option value="7">7 Tage vorher</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="border-t pt-4" id="ruecksendungSection" style="display:none;">
                    <h4 class="font-bold text-gray-700 mb-3">🔄 Rücksendung</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Rücksendungsfrist</label>
                            <input type="date" id="sendungRuecksendungFrist" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Grund</label>
                            <input type="text" id="sendungRuecksendungGrund" placeholder="Warum zurück?" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500">
                        </div>
                    </div>
                    <div class="mt-3 flex items-center">
                        <input type="checkbox" id="sendungRuecksendeEtikett" class="w-5 h-5 text-amber-500 border-gray-300 rounded focus:ring-amber-500">
                        <label for="sendungRuecksendeEtikett" class="ml-2 text-sm font-bold text-gray-700">Rücksende-Etikett vorhanden</label>
                    </div>
                </div>
            </div>

            <div class="flex flex-wrap justify-end gap-3 mt-6 pt-4 border-t">
                <button id="cancelSendungBtn" style="display:none" class="w-full sm:w-auto px-6 py-2.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-bold transition">
                    Abbrechen
                </button>
                <button id="editSendungBtn" style="display:none" class="w-full sm:w-auto px-6 py-2.5 bg-orange-500 text-white font-bold rounded-lg hover:bg-orange-600 transition">
                    Bearbeiten
                </button>
                <button id="duplicateSendungBtn" style="display:none" class="w-full sm:w-auto px-6 py-2.5 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600 transition">
                    Kopieren
                </button>
                <button id="deleteSendungBtn" style="display:none" class="w-full sm:w-auto px-6 py-2.5 bg-red-500 text-white font-bold rounded-lg hover:bg-red-600 transition">
                    Löschen
                </button>
                <button id="saveSendungBtn" class="w-full sm:w-auto px-6 py-2.5 bg-amber-600 text-white font-bold rounded-lg hover:bg-amber-700 transition">
                    Speichern
                </button>
            </div>
        </div>
    </div>

    <div id="sendungTrackingOptionsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-end md:items-center justify-center p-2 sm:p-4 z-[110]">
        <div class="bg-white rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-lg p-4 sm:p-5">
            <div class="flex items-center justify-between gap-3 mb-4">
                <h3 id="sendungTrackingOptionsTitle" class="text-lg md:text-xl font-bold text-amber-800">Tracking wählen</h3>
                <button id="closeSendungTrackingOptionsModal" type="button" class="text-gray-400 hover:text-red-600 font-bold text-3xl leading-none">&times;</button>
            </div>
            <div id="sendungTrackingOptionsList" class="space-y-3"></div>
        </div>
    </div>

    <div id="sendungInhaltZuordnungModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-end md:items-center justify-center p-3 md:p-4 z-[115]">
        <div class="bg-white rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col">
            <div class="p-4 border-b border-gray-200 flex items-center justify-between gap-3">
                <div>
                    <h3 id="sendungInhaltZuordnungTitle" class="text-base md:text-lg font-bold text-indigo-800">Artikel zuordnen</h3>
                    <p id="sendungInhaltZuordnungHint" class="text-xs text-gray-600">Zuordnung prüfen</p>
                </div>
                <button id="closeSendungInhaltZuordnungModal" type="button" class="text-gray-400 hover:text-red-600 font-bold text-3xl leading-none">&times;</button>
            </div>
            <div id="sendungInhaltZuordnungRows" class="p-4 space-y-3 overflow-y-auto"></div>
            <div class="p-4 border-t border-gray-200 bg-white flex flex-wrap justify-end gap-2">
                <button type="button" id="applySendungInhaltZuordnungBtn" class="w-full sm:w-auto px-4 py-2 rounded-lg bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition">Zuordnung speichern</button>
            </div>
        </div>
    </div>

    <div id="sendungWarenuebernahmeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-end md:items-center justify-center p-3 md:p-4 z-[120]">
        <div class="bg-white rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] overflow-hidden flex flex-col">
            <div class="p-4 border-b border-gray-200 flex items-start sm:items-center justify-between gap-3">
                <div>
                    <h3 id="sendungWarenuebernahmeTitle" class="text-base md:text-lg font-bold text-emerald-800">Warenübernahme</h3>
                    <p id="sendungWarenuebernahmeSubtitle" class="text-xs text-gray-600">Status: Offen</p>
                </div>
                <div class="flex flex-wrap justify-end items-center gap-2">
                    <button id="resetSendungWarenuebernahmeBtn" type="button" class="w-full sm:w-auto px-3 py-1.5 rounded-lg bg-red-100 text-red-700 text-xs font-bold hover:bg-red-200 transition">Warenübernahme zurücksetzen</button>
                    <button id="closeSendungWarenuebernahmeModal" type="button" class="text-gray-400 hover:text-red-600 font-bold text-3xl leading-none">&times;</button>
                </div>
            </div>

            <div id="sendungWarenuebernahmeProblemSection" class="hidden px-4 py-2 border-b border-gray-100 bg-white">
                <div id="sendungWarenuebernahmeProblemList"></div>
            </div>

            <div id="sendungWarenuebernahmeRows" class="p-4 space-y-3 overflow-y-auto"></div>

            <div class="p-4 border-t border-gray-200 bg-white flex flex-wrap justify-end gap-2">
                <button type="button" id="saveSendungWarenuebernahmeBtn" class="w-full sm:w-auto px-4 py-2 rounded-lg bg-emerald-600 text-white font-bold hover:bg-emerald-700 transition">Buchen</button>
            </div>
        </div>
    </div>

<script type="module" src="notfall.js"></script>
<script type="module" src="pushbenachrichtigung.js"></script>
<script type="module" src="terminplaner.js"></script>
<script type="module" src="ticket-support.js"></script>
<script type="module" src="wertguthaben.js"></script>
<script type="module" src="zahlungsverwaltung.js"></script>
<script type="module" src="notizen.js"></script>

<!-- ========== NOTIZEN MODALS ========== -->

<!-- Notiz Viewer Modal (Schreibgeschützt) -->
<div id="notizViewerModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-start z-10">
            <div class="flex-1">
                <h2 id="viewer-notiz-titel" class="text-xl font-bold text-gray-800">Notiz Titel</h2>
                <div class="flex items-center gap-2 mt-2 flex-wrap">
                    <span id="viewer-notiz-status" class="px-3 py-1 rounded-full text-sm font-semibold">Status</span>
                    <span id="viewer-notiz-kategorie" class="px-2 py-1 rounded-full text-xs font-semibold">Kategorie</span>
                    <span id="viewer-notiz-datum" class="text-xs text-gray-500"></span>
                </div>
                <div id="viewer-notiz-share-info" class="mt-2 text-xs text-gray-500 hidden"></div>
            </div>
            <button onclick="window.closeNotizViewer()" class="p-2 hover:bg-gray-100 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        
        <div class="p-4 space-y-4">
            <!-- Gültigkeit -->
            <div class="flex gap-4 text-sm text-gray-600 bg-gray-50 p-3 rounded-lg">
                <div><span class="font-semibold">Gültig ab:</span> <span id="viewer-notiz-gueltig-ab">-</span></div>
                <div><span class="font-semibold">Gültig bis:</span> <span id="viewer-notiz-gueltig-bis">-</span></div>
            </div>
            
            <!-- Inhalt -->
            <div id="viewer-notiz-content" class="space-y-3">
                <!-- Elemente werden hier gerendert -->
            </div>
        </div>
        
        <!-- Aktionen -->
        <div class="sticky bottom-0 bg-white border-t border-gray-200 p-4 flex justify-between">
            <div class="relative">
                <button id="viewer-erweitert-btn" onclick="window.toggleErweitertMenu()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition">
                    ⚙️ Erweitert
                </button>
                <div id="viewer-erweitert-menu" class="hidden absolute bottom-full left-0 mb-2 bg-white border rounded-lg shadow-lg p-2 space-y-1 min-w-[200px]">
                    <button onclick="window.editCurrentNotiz()" class="w-full text-left px-3 py-2 hover:bg-amber-50 rounded font-semibold text-amber-700">✏️ Bearbeiten</button>
                    <button id="viewer-share-notiz-btn" class="w-full text-left px-3 py-2 hover:bg-amber-50 rounded font-semibold text-amber-700">🔗 Teilen</button>
                    <div class="relative">
                        <button id="viewer-weitere-optionen-btn" onclick="window.toggleWeitereOptionenMenu()" class="w-full text-left px-3 py-2 hover:bg-gray-50 rounded font-semibold text-gray-700 flex items-center justify-between">
                            ⋮ Weitere Optionen
                            <span class="text-xs">▶</span>
                        </button>
                        <div id="viewer-weitere-optionen-menu" class="hidden absolute left-full top-0 ml-2 bg-white border rounded-lg shadow-lg p-2 space-y-1 min-w-[200px] z-10">
                            <button id="viewer-delete-notiz-btn" onclick="window.deleteCurrentNotiz()" class="w-full text-left px-3 py-2 hover:bg-red-50 rounded font-semibold text-red-700">🗑️ Notiz löschen</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Notizen Einladungen Modal -->
<div id="notizenEinladungenModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[85vh] overflow-y-auto">
        <div class="sticky top-0 bg-gradient-to-r from-amber-500 to-orange-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
            <h3 class="text-xl font-bold">📬 Notizen-Einladungen</h3>
            <button id="close-notizen-einladungen" class="text-white/80 hover:text-white transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div class="p-6 space-y-6">
            <div>
                <h4 class="text-sm font-bold text-gray-700 mb-2">📥 Posteingang</h4>
                <div id="notizen-einladungen-inbox" class="space-y-2">
                    <p class="text-gray-400 text-sm italic">Keine Einladungen vorhanden.</p>
                </div>
            </div>
            <div>
                <h4 class="text-sm font-bold text-gray-700 mb-2">✅ Aktiv</h4>
                <div id="notizen-einladungen-aktiv" class="space-y-2">
                    <p class="text-gray-400 text-sm italic">Keine aktiven Freigaben.</p>
                </div>
            </div>
            <div>
                <h4 class="text-sm font-bold text-gray-700 mb-2">🚫 Abgelehnt</h4>
                <p class="text-xs text-gray-500 mb-2">Solange eine Ablehnung besteht, kann keine neue Einladung gesendet werden.</p>
                <div id="notizen-einladungen-abgelehnt" class="space-y-2">
                    <p class="text-gray-400 text-sm italic">Keine abgelehnten Einladungen.</p>
                </div>
            </div>
            <div>
                <h4 class="text-sm font-bold text-gray-700 mb-2">📤 Postausgang</h4>
                <div id="notizen-einladungen-postausgang" class="space-y-2">
                    <p class="text-gray-400 text-sm italic">Keine gesendeten Einladungen.</p>
                </div>
            </div>
        </div>
        <div class="sticky bottom-0 bg-gray-100 p-4 rounded-b-2xl flex justify-end">
            <button id="close-notizen-einladungen-footer" class="px-6 py-2 bg-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-400 transition">
                Schließen
            </button>
        </div>
    </div>
</div>

<!-- Notizen Share Modal -->
<div id="notizenShareModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[85vh] overflow-y-auto">
        <div class="sticky top-0 bg-gradient-to-r from-amber-500 to-orange-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
            <h3 id="notizen-share-title" class="text-xl font-bold">🔗 Teilen</h3>
            <button id="close-notizen-share" class="text-white/80 hover:text-white transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div class="p-6 space-y-4">
            <div class="bg-amber-50 border border-amber-200 p-3 rounded-lg">
                <p class="text-xs text-amber-700 font-bold uppercase">Ressource</p>
                <p id="notizen-share-resource" class="text-gray-700 font-semibold">-</p>
                <p id="notizen-share-owner" class="text-xs text-gray-500 hidden"></p>
            </div>
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Empfänger</label>
                <select id="notizen-share-target-user" class="w-full p-3 border-2 border-gray-300 rounded-lg bg-white">
                    <option value="">-- Benutzer auswählen --</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Berechtigung</label>
                <select id="notizen-share-permission" class="w-full p-3 border-2 border-gray-300 rounded-lg bg-white">
                    <option value="read">👀 Nur lesen</option>
                    <option value="write">✏️ Bearbeiten</option>
                </select>
            </div>
            <div class="text-xs text-gray-500 leading-relaxed">
                <p>Hinweis: Bearbeiten erlaubt nur Notiz-Inhalte. Kategorien, Unterkategorien und Eigentümer-Daten bleiben geschützt.</p>
            </div>
            <div id="notizen-share-feedback" class="hidden text-sm"></div>
        </div>
        <div class="sticky bottom-0 bg-gray-100 p-4 rounded-b-2xl flex justify-between items-center">
            <button id="notizen-share-cancel" class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition">
                Abbrechen
            </button>
            <button id="notizen-share-send" class="px-6 py-2 bg-amber-500 text-white font-bold rounded-lg hover:bg-amber-600 transition">
                Einladung senden
            </button>
        </div>
    </div>
</div>

<!-- Notiz Editor Modal -->
<div id="notizEditorModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-gradient-to-r from-amber-500 to-orange-500 p-4 flex justify-between items-center z-10 rounded-t-2xl">
            <h2 class="text-xl font-bold text-white">📝 Notiz bearbeiten</h2>
            <div class="flex gap-2">
                <button id="close-notiz-editor" class="p-2 hover:bg-white/20 rounded-lg text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <div id="notiz-editor-body" class="p-4 space-y-4">
            <div id="notiz-editor-lock-banner" class="hidden bg-amber-50 text-amber-800 border border-amber-200 px-3 py-2 rounded-lg text-sm font-semibold"></div>
            <!-- Basis-Infos -->
            <div class="grid grid-cols-10 gap-4">
                <div class="col-span-7">
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Titel *</label>
                    <input type="text" id="notiz-titel" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500" placeholder="Titel der Notiz">
                </div>
                <div class="col-span-3">
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Status</label>
                    <select id="notiz-status" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500 bg-white">
                        <option value="offen">⭕ Offen</option>
                        <option value="abgeschlossen">✅ Abgeschlossen</option>
                        <option value="info">ℹ️ Info</option>
                    </select>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Kategorie *</label>
                    <select id="notiz-kategorie" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500 bg-white">
                        <option value="">-- Kategorie wählen --</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Unterkategorie</label>
                    <select id="notiz-unterkategorie" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500 bg-white">
                        <option value="">-- Keine --</option>
                    </select>
                </div>
            </div>
            
            <!-- Gültigkeit -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Gültig ab</label>
                    <input type="date" id="notiz-gueltig-ab" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Gültig bis</label>
                    <div class="flex items-center gap-2">
                        <input type="date" id="notiz-gueltig-bis" class="flex-1 p-3 border-2 border-gray-300 rounded-lg focus:border-amber-500">
                        <label class="flex items-center gap-1 text-sm whitespace-nowrap">
                            <input type="checkbox" id="notiz-gueltig-bis-unbegrenzt" class="h-4 w-4" checked>
                            <span>Unbegrenzt</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Elemente Container -->
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Inhalte</label>
                <div id="notiz-elemente-container" class="space-y-3 min-h-[100px]">
                    <!-- Elemente werden hier dynamisch eingefügt -->
                </div>
            </div>
            
            <!-- Element hinzufügen -->
            <div class="bg-gray-50 p-3 rounded-lg">
                <p class="text-sm font-semibold text-gray-600 mb-2">Element hinzufügen:</p>
                <div class="flex flex-wrap gap-2">
                    <button id="add-element-text" class="px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-amber-500 transition text-sm font-semibold">📝 Text</button>
                    <button id="add-element-checkbox" class="px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-amber-500 transition text-sm font-semibold">☑️ Checkpunkte</button>
                    <button id="add-element-list_bullets" class="px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-amber-500 transition text-sm font-semibold">• Liste</button>
                    <button id="add-element-list_numbers" class="px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-amber-500 transition text-sm font-semibold">1. Nummeriert</button>
                    <button id="add-element-password" class="px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-amber-500 transition text-sm font-semibold">🔒 Passwort</button>
                    <button id="add-element-table" class="px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-amber-500 transition text-sm font-semibold">📊 Tabelle</button>
                    <button id="add-element-link" class="px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-amber-500 transition text-sm font-semibold">🔗 Link</button>
                    <button id="add-element-divider" class="px-3 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-amber-500 transition text-sm font-semibold">➖ Trennlinie</button>
                </div>
            </div>
        </div>
        
        <!-- Speichern -->
        <div class="sticky bottom-0 bg-white border-t border-gray-200 p-4">
            <button id="save-notiz-btn" class="w-full py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-lg hover:shadow-lg transition">
                💾 Speichern
            </button>
        </div>
    </div>
</div>

<!-- Kategorien Einstellungen Modal -->
<div id="notizenSettingsModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-gradient-to-r from-amber-500 to-orange-500 p-4 flex justify-between items-center z-10 rounded-t-2xl">
            <h2 class="text-xl font-bold text-white">📁 Kategorien verwalten</h2>
            <button id="close-notizen-settings" class="p-2 hover:bg-white/20 rounded-lg text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        
        <div class="p-4 space-y-4">
            <!-- Neue Kategorie -->
            <div class="bg-amber-50 p-4 rounded-lg border border-amber-200">
                <h3 class="font-bold text-amber-800 mb-3">Neue Kategorie erstellen</h3>
                <div class="flex gap-2">
                    <input type="text" id="new-kategorie-name" class="flex-1 p-2 border-2 border-gray-300 rounded-lg" placeholder="Name der Kategorie">
                    <button id="btn-create-kategorie" class="px-4 py-2 bg-amber-500 text-white font-bold rounded-lg hover:bg-amber-600 transition">
                        + Erstellen
                    </button>
                </div>
            </div>
            
            <!-- Kategorien Liste -->
            <div id="kategorien-settings-list" class="space-y-2">
                <p class="text-center text-gray-400 italic py-4">Keine Kategorien vorhanden.</p>
            </div>
        </div>
    </div>
</div>

</body>

</html>
